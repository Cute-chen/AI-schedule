import{e as te,d as M}from"./index-bcd0f302.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                    *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               */import{_ as ae}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css               *//* empty css                */import{E as f,ag as se,S as le,F as ne,J as oe,G as re,aA as ie,k as de,c as ce,a2 as ue,O as pe,P as _e,p as me,aj as fe,M as ve,ak as ge,ae as ye,d as be,a3 as he,W as Ee,X as ke,_ as xe,T as we}from"./elementPlus-9365ac08.js";import{r as c,X as Re,c as Ce,k as Ve,y as o,z as _,A as s,Q as t,I as a,O as i,u as V,J as N,H as x,M as v,P as Te,a4 as je,L as O}from"./vendor-b2a91a46.js";import"./utils-88d415ea.js";const Ie={class:"referral-management-container"},Me={class:"stats-section"},Se={class:"stat-content"},Be={class:"stat-number"},De={class:"stat-icon"},Le={class:"stat-content"},Pe={class:"stat-number"},ze={class:"stat-icon"},Ae={class:"stat-content"},Fe={class:"stat-number"},Ne={class:"stat-icon"},Oe={class:"stat-content"},Ue={class:"stat-number"},$e={class:"stat-icon"},Je={class:"card-header"},Xe={key:1,class:"text-muted"},qe={key:0,class:"referred-list"},Ge={class:"status-text"},He={key:1,class:"text-muted"},Qe={class:"pending-section"},We={class:"card-header"},Ke={key:0},Ye={class:"referrer-name"},Ze={class:"referrer-email"},et={key:1,class:"text-muted"},tt={key:0,class:"empty-state"},at={__name:"ReferralManagement",setup(st){const S=c("stats"),w=c(!1),h=c(!1),T=c(!1),E=c([]),m=c({employees:[],totalEmployees:0,totalReferrals:0}),u=c([]),k=c(!1),R=c(null),g=Re({reason:""}),j=Ce(()=>u.value.length),U=()=>!m.value.employees||m.value.employees.length===0?0:Math.max(...m.value.employees.map(n=>n.referredCount)),$=n=>{switch(n){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return""}},J=n=>{switch(n){case"approved":return"已通过";case"pending":return"待审核";case"rejected":return"已拒绝";default:return"未知"}},X=n=>new Date(n).toLocaleString("zh-CN"),I=async()=>{try{w.value=!0;const n=await te.getReferralStats();m.value=n.data||{employees:[],totalEmployees:0,totalReferrals:0}}catch(n){console.error("获取推荐统计失败:",n),f.error("获取推荐统计失败")}finally{w.value=!1}},B=async()=>{var n;try{h.value=!0;const e=await M.getPendingRegistrations();u.value=((n=e.data)==null?void 0:n.pendingRegistrations)||[]}catch(e){console.error("获取待审核申请失败:",e),f.error("获取待审核申请失败")}finally{h.value=!1}},q=async n=>{try{await de.confirm("确定要通过这个注册申请吗？","确认操作",{type:"warning"}),E.value.push(n);const e=await M.approveRegistration(n,{action:"approve"});f.success("注册申请已通过");const d=u.value.findIndex(p=>p.id===n);d!==-1&&u.value.splice(d,1),I()}catch(e){e!=="cancel"&&(console.error("审核失败:",e),f.error("审核失败"))}finally{const e=E.value.indexOf(n);e!==-1&&E.value.splice(e,1)}},G=n=>{R.value=n,g.reason="",k.value=!0},H=async()=>{if(!g.reason.trim()){f.error("请输入拒绝原因");return}try{T.value=!0;const n=await M.approveRegistration(R.value.id,{action:"reject",reason:g.reason});f.success("注册申请已拒绝");const e=u.value.findIndex(d=>d.id===R.value.id);e!==-1&&u.value.splice(e,1),k.value=!1}catch(n){console.error("拒绝失败:",n),f.error("拒绝失败")}finally{T.value=!1}};return Ve(()=>{I(),B()}),(n,e)=>{const d=ce,p=ue,C=pe,Q=_e,y=me,r=fe,D=ve,L=ge,P=ye,W=be,K=he,Y=se,z=Ee,A=ke,Z=xe,ee=le,F=we;return o(),_("div",Ie,[e[15]||(e[15]=s("div",{class:"page-header"},[s("div",null,[s("h1",null,"推荐人员管理"),s("p",null,"管理员工推荐关系，审核自助注册申请")])],-1)),t(Y,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=l=>S.value=l),class:"main-tabs"},{default:a(()=>[t(P,{label:"推荐统计",name:"stats"},{default:a(()=>[s("div",Me,[t(Q,{gutter:20,class:"stats-cards"},{default:a(()=>[t(C,{span:6},{default:a(()=>[t(p,{class:"stat-card"},{default:a(()=>[s("div",Se,[s("div",Be,i(m.value.totalEmployees||0),1),e[4]||(e[4]=s("div",{class:"stat-label"},"在职员工",-1))]),s("div",De,[t(d,null,{default:a(()=>[t(V(ne))]),_:1})])]),_:1})]),_:1}),t(C,{span:6},{default:a(()=>[t(p,{class:"stat-card"},{default:a(()=>[s("div",Le,[s("div",Pe,i(m.value.totalReferrals||0),1),e[5]||(e[5]=s("div",{class:"stat-label"},"推荐入职",-1))]),s("div",ze,[t(d,null,{default:a(()=>[t(V(oe))]),_:1})])]),_:1})]),_:1}),t(C,{span:6},{default:a(()=>[t(p,{class:"stat-card"},{default:a(()=>[s("div",Ae,[s("div",Fe,i(j.value),1),e[6]||(e[6]=s("div",{class:"stat-label"},"待审核",-1))]),s("div",Ne,[t(d,null,{default:a(()=>[t(V(re))]),_:1})])]),_:1})]),_:1}),t(C,{span:6},{default:a(()=>[t(p,{class:"stat-card"},{default:a(()=>[s("div",Oe,[s("div",Ue,i(U()),1),e[7]||(e[7]=s("div",{class:"stat-label"},"最多推荐",-1))]),s("div",$e,[t(d,null,{default:a(()=>[t(V(ie))]),_:1})])]),_:1})]),_:1})]),_:1}),t(p,{class:"referral-table-card"},{header:a(()=>[s("div",Je,[e[8]||(e[8]=s("span",null,"员工推荐情况",-1)),t(y,{onClick:I,loading:w.value,icon:"Refresh",circle:""},null,8,["loading"])])]),default:a(()=>[N((o(),x(L,{data:m.value.employees||[],style:{width:"100%"}},{default:a(()=>[t(r,{prop:"name",label:"员工姓名",width:"150"}),t(r,{prop:"email",label:"邮箱",width:"200"}),t(r,{prop:"referredCount",label:"推荐人数",width:"100",align:"center"},{default:a(({row:l})=>[l.referredCount>0?(o(),x(D,{key:0,type:"success"},{default:a(()=>[v(i(l.referredCount),1)]),_:2},1024)):(o(),_("span",Xe,"0"))]),_:1}),t(r,{label:"推荐的员工","min-width":"300"},{default:a(({row:l})=>[l.referredEmployees&&l.referredEmployees.length>0?(o(),_("div",qe,[(o(!0),_(Te,null,je(l.referredEmployees,b=>(o(),x(D,{key:b.id,type:$(b.registration_status),size:"small",style:{margin:"2px"}},{default:a(()=>[v(i(b.name)+" ",1),s("span",Ge,"("+i(J(b.registration_status))+")",1)]),_:2},1032,["type"]))),128))])):(o(),_("span",He,"暂无推荐"))]),_:1})]),_:1},8,["data"])),[[F,w.value]])]),_:1})])]),_:1}),t(P,{name:"pending"},{label:a(()=>[e[9]||(e[9]=s("span",null,"待审核申请",-1)),j.value>0?(o(),x(W,{key:0,value:j.value,class:"tab-badge"},null,8,["value"])):O("",!0)]),default:a(()=>[s("div",Qe,[t(p,null,{header:a(()=>[s("div",We,[e[10]||(e[10]=s("span",null,"待审核的注册申请",-1)),t(y,{onClick:B,loading:h.value,icon:"Refresh",circle:""},null,8,["loading"])])]),default:a(()=>[N((o(),x(L,{data:u.value,style:{width:"100%"}},{default:a(()=>[t(r,{prop:"name",label:"姓名",width:"120"}),t(r,{prop:"email",label:"邮箱",width:"200"}),t(r,{prop:"phone",label:"手机",width:"130"}),t(r,{label:"推荐人",width:"150"},{default:a(({row:l})=>[l.referrer?(o(),_("div",Ke,[s("div",Ye,i(l.referrer.name),1),s("div",Ze,i(l.referrer.email),1)])):(o(),_("span",et,"无推荐人"))]),_:1}),t(r,{prop:"created_at",label:"申请时间",width:"160"},{default:a(({row:l})=>[v(i(X(l.created_at)),1)]),_:1}),t(r,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(y,{type:"success",size:"small",onClick:b=>q(l.id),loading:E.value.includes(l.id)},{default:a(()=>e[11]||(e[11]=[v(" 通过 ",-1)])),_:2,__:[11]},1032,["onClick","loading"]),t(y,{type:"danger",size:"small",onClick:b=>G(l),loading:E.value.includes(l.id)},{default:a(()=>e[12]||(e[12]=[v(" 拒绝 ",-1)])),_:2,__:[12]},1032,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[F,h.value]]),u.value.length===0&&!h.value?(o(),_("div",tt,[t(K,{description:"暂无待审核的注册申请"})])):O("",!0)]),_:1})])]),_:1})]),_:1},8,["modelValue"]),t(ee,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=l=>k.value=l),title:"拒绝注册申请",width:"500px"},{footer:a(()=>[t(y,{onClick:e[2]||(e[2]=l=>k.value=!1)},{default:a(()=>e[13]||(e[13]=[v("取消",-1)])),_:1,__:[13]}),t(y,{type:"danger",onClick:H,loading:T.value},{default:a(()=>e[14]||(e[14]=[v(" 确认拒绝 ",-1)])),_:1,__:[14]},8,["loading"])]),default:a(()=>[t(Z,{model:g,"label-width":"80px"},{default:a(()=>[t(A,{label:"申请人"},{default:a(()=>{var l;return[t(z,{value:(l=R.value)==null?void 0:l.name,disabled:""},null,8,["value"])]}),_:1}),t(A,{label:"拒绝原因",required:""},{default:a(()=>[t(z,{modelValue:g.reason,"onUpdate:modelValue":e[1]||(e[1]=l=>g.reason=l),type:"textarea",rows:4,placeholder:"请输入拒绝原因..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},xt=ae(at,[["__scopeId","data-v-dbf5844e"]]);export{xt as default};
