import"./index-bcd0f302.js";/* empty css               *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import{_ as K}from"./_plugin-vue_export-helper-8da67cfc.js";import{r as w,X as Z,c as q,f as ee,k as te,y as _,z as k,A as u,O as p,Q as o,I as i,M as c,P as z,a4 as A,u as le,C as Q,V as B,L as se,J as ae,R as ne,T as oe,H as x}from"./vendor-b2a91a46.js";import{aB as ie,p as de,c as ue,Y as re,ad as ce,X as me,_ as ve,M as _e}from"./elementPlus-9365ac08.js";import{s as pe}from"./settingsService-87306db1.js";const fe={class:"week-range-selector"},ke={class:"selector-header"},ge={class:"quick-actions"},ye={class:"action-group"},he={class:"action-group"},be={class:"week-grid"},We=["onClick"],Ce={class:"quarter-title"},we={class:"quarter-summary"},xe={key:0,class:"selected-count"},Se={class:"week-list"},De=["onClick"],Ve={class:"week-date"},$e={class:"custom-range"},Ee={class:"selection-summary"},ze={__name:"WeekRangeSelector",props:{title:{type:String,default:"选择适用周期"},modelValue:{type:Array,default:()=>[]},disabledWeeks:{type:Array,default:()=>[]},maxWeeks:{type:Number,default:52}},emits:["update:modelValue","change"],setup(h,{emit:N}){const m=h,S=N,s=w([...m.modelValue]),d=Z({start:null,end:null}),f=w(new Set([1,2,3,4])),g=w(null),R=q(()=>[{id:1,label:"第一季度",weeks:[1,2,3,4,5,6,7,8,9,10,11,12,13]},{id:2,label:"第二季度",weeks:[14,15,16,17,18,19,20,21,22,23,24,25,26]},{id:3,label:"第三季度",weeks:[27,28,29,30,31,32,33,34,35,36,37,38,39]},{id:4,label:"第四季度",weeks:[40,41,42,43,44,45,46,47,48,49,50,51,52]}]),M=l=>{const e=new Set(f.value);e.has(l)?e.delete(l):e.add(l),f.value=e},D=l=>{if(m.disabledWeeks.includes(l))return;const e=s.value.indexOf(l);e>-1?s.value.splice(e,1):s.value.push(l),s.value.sort((t,a)=>t-a),y()},T=(l,e)=>{const t=l.filter(a=>!m.disabledWeeks.includes(a));e?t.forEach(a=>{s.value.includes(a)||s.value.push(a)}):t.forEach(a=>{const v=s.value.indexOf(a);v>-1&&s.value.splice(v,1)}),s.value.sort((a,v)=>a-v),y()},F=l=>{const e=l.filter(t=>!m.disabledWeeks.includes(t));return e.length>0&&e.every(t=>s.value.includes(t))},I=l=>{const e=l.filter(a=>!m.disabledWeeks.includes(a)),t=e.filter(a=>s.value.includes(a)).length;return t>0&&t<e.length},V=l=>l.filter(t=>!m.disabledWeeks.includes(t)).filter(t=>s.value.includes(t)).length,b=(l,e)=>{s.value=[];for(let t=l;t<=e;t++)m.disabledWeeks.includes(t)||s.value.push(t);y()},O=()=>{s.value=[];for(let l=1;l<=m.maxWeeks;l++)m.disabledWeeks.includes(l)||s.value.push(l);y()},L=()=>{s.value=[],y()},U=()=>{f.value=new Set},X=()=>{f.value=new Set([1,2,3,4])},j=()=>{d.start&&d.end&&d.start<=d.end&&b(d.start,d.end)},H=l=>{if(!g.value)return"加载中...";try{const e=new Date(g.value);e.setDate(g.value.getDate()+(l-1)*7);const t=new Date(e);return t.setDate(e.getDate()+6),`${$(e)} - ${$(t)}`}catch(e){return console.error("格式化周日期失败:",e),`第${l}周`}},$=l=>`${l.getMonth()+1}/${l.getDate()}`,J=()=>{if(s.value.length===0)return"";const l=[];let e=s.value[0],t=s.value[0];for(let a=1;a<s.value.length;a++)s.value[a]===t+1?t=s.value[a]:(e===t?l.push(`第${e}周`):l.push(`第${e}-${t}周`),e=t=s.value[a]);return e===t?l.push(`第${e}周`):l.push(`第${e}-${t}周`),l.join(", ")},y=()=>{S("update:modelValue",[...s.value]),S("change",[...s.value])},P=async()=>{try{const l=await pe.getWeekStartDate();g.value=l}catch(l){console.error("加载周设置失败:",l);const e=new Date,t=e.getDay(),a=t===0?6:t-1,v=new Date(e);v.setDate(e.getDate()-a),g.value=v}};return ee(()=>m.modelValue,l=>{s.value=[...l]},{deep:!0}),te(()=>{P()}),(l,e)=>{const t=de,a=ue,v=re,E=ce,W=me,Y=ve,C=_e;return _(),k("div",fe,[u("div",ke,[u("h3",null,p(h.title),1),u("div",ge,[u("div",ye,[o(t,{size:"small",onClick:e[0]||(e[0]=n=>b(1,8))},{default:i(()=>e[6]||(e[6]=[c("1-8周",-1)])),_:1,__:[6]}),o(t,{size:"small",onClick:e[1]||(e[1]=n=>b(9,16))},{default:i(()=>e[7]||(e[7]=[c("9-16周",-1)])),_:1,__:[7]}),o(t,{size:"small",onClick:O},{default:i(()=>e[8]||(e[8]=[c("全选",-1)])),_:1,__:[8]}),o(t,{size:"small",onClick:L},{default:i(()=>e[9]||(e[9]=[c("清空",-1)])),_:1,__:[9]})]),u("div",he,[o(t,{size:"small",onClick:U},{default:i(()=>e[10]||(e[10]=[c("全展开",-1)])),_:1,__:[10]}),o(t,{size:"small",onClick:X},{default:i(()=>e[11]||(e[11]=[c("全折叠",-1)])),_:1,__:[11]})])])]),u("div",be,[(_(!0),k(z,null,A(R.value,n=>(_(),k("div",{key:n.id,class:"quarter-group"},[u("div",{class:"quarter-header",onClick:r=>M(n.id)},[u("div",Ce,[o(a,{class:Q(["collapse-icon",{expanded:!f.value.has(n.id)}])},{default:i(()=>[o(le(ie))]),_:2},1032,["class"]),o(v,{"model-value":F(n.weeks),indeterminate:I(n.weeks),onChange:r=>T(n.weeks,r),onClick:e[2]||(e[2]=B(()=>{},["stop"]))},{default:i(()=>[c(p(n.label),1)]),_:2},1032,["model-value","indeterminate","onChange"])]),u("div",we,[V(n.weeks)>0?(_(),k("span",xe," 已选择 "+p(V(n.weeks))+" / "+p(n.weeks.length)+" 周 ",1)):se("",!0)])],8,We),o(oe,{name:"quarter-collapse"},{default:i(()=>[ae(u("div",Se,[(_(!0),k(z,null,A(n.weeks,r=>(_(),k("div",{key:r,class:Q(["week-item",{selected:s.value.includes(r),disabled:h.disabledWeeks.includes(r)}]),onClick:G=>D(r)},[o(v,{"model-value":s.value.includes(r),disabled:h.disabledWeeks.includes(r),onChange:G=>D(r),onClick:e[3]||(e[3]=B(()=>{},["stop"]))},{default:i(()=>[c(" 第"+p(r)+"周 ",1)]),_:2},1032,["model-value","disabled","onChange"]),u("div",Ve,p(H(r)),1)],10,De))),128))],512),[[ne,!f.value.has(n.id)]])]),_:2},1024)]))),128))]),u("div",$e,[o(Y,{model:d,inline:"",size:"small"},{default:i(()=>[o(W,{label:"自定义范围："},{default:i(()=>[o(E,{modelValue:d.start,"onUpdate:modelValue":e[4]||(e[4]=n=>d.start=n),min:1,max:52,placeholder:"起始周",style:{width:"80px"}},null,8,["modelValue"])]),_:1}),o(W,{label:"-"},{default:i(()=>[o(E,{modelValue:d.end,"onUpdate:modelValue":e[5]||(e[5]=n=>d.end=n),min:d.start||1,max:52,placeholder:"结束周",style:{width:"80px"}},null,8,["modelValue","min"])]),_:1}),o(W,null,{default:i(()=>[o(t,{type:"primary",size:"small",onClick:j,disabled:!d.start||!d.end},{default:i(()=>e[12]||(e[12]=[c(" 应用 ",-1)])),_:1,__:[12]},8,["disabled"])]),_:1})]),_:1},8,["model"])]),u("div",Ee,[s.value.length===0?(_(),x(C,{key:0,type:"info"},{default:i(()=>e[13]||(e[13]=[c("未选择任何周",-1)])),_:1,__:[13]})):s.value.length<=8?(_(),x(C,{key:1,type:"success"},{default:i(()=>[c(" 已选择："+p(J()),1)]),_:1})):(_(),x(C,{key:2,type:"success"},{default:i(()=>[c(" 已选择 "+p(s.value.length)+" 周 ",1)]),_:1}))])])}}},Le=K(ze,[["__scopeId","data-v-adf5f0e0"]]);export{Le as W};
