import{u as ge,e as $,a as ve}from"./index-bcd0f302.js";/* empty css                  *//* empty css                 *//* empty css                   *//* empty css                     *//* empty css                       *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                *//* empty css                 */import{_ as _e}from"./_plugin-vue_export-helper-8da67cfc.js";import{aC as be,r as k,X as K,c as ye,k as ke,al as Y,y as _,z as E,A as o,Q as l,I as s,M as u,J as we,P as Z,a4 as ee,L as W,O as w,H as z,u as O,C as xe}from"./vendor-b2a91a46.js";import{E as v,k as q,c as Ee,p as Ve,W as Ce,a2 as We,a3 as Ae,X as he,a4 as $e,a5 as ze,a6 as Ie,a7 as Ne,_ as Te,S as De,a8 as Se,T as Ue,a9 as Be,aa as te,r as Me,M as Fe}from"./elementPlus-9365ac08.js";import"./utils-88d415ea.js";const Le={class:"employees-container"},Oe={class:"page-header"},qe={class:"employees-grid"},Pe={class:"employee-info"},Re={class:"employee-header"},je={class:"employee-avatar"},He={class:"employee-details"},Qe={class:"employee-name"},Xe={class:"employee-email"},Ge={key:0,class:"employee-phone"},Je={key:1,class:"employee-position"},Ke={class:"employee-status"},Ye={class:"employee-actions"},Ze={class:"action-group primary-actions"},et={class:"action-group secondary-actions"},tt={key:0,class:"empty-state"},lt={class:"batch-delete-dialog-content"},at={class:"quick-select-buttons"},st={__name:"index",setup(ot){be();const P=ge(),T=k(!1),D=k(!1),x=k([]),I=k(""),V=k(!1),b=k(null),A=k(!1),h=k(null),S=k(!1),m=K({name:"",email:"",password:"",phone:"",role:"employee",status:"active"}),le={name:[{required:!0,message:"请输入员工姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{validator:(a,e,d)=>{!b.value&&!e?d():e&&e.length<6?d(new Error("密码长度不能少于6位")):d()},trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"}],role:[{required:!0,message:"请选择员工角色",trigger:"change"}]},U=k(),c=K({targetWeeks:[],targetAbsoluteWeeks:[],targetWeeksText:""}),R=ye(()=>{if(!I.value)return x.value;const a=I.value.toLowerCase();return x.value.filter(e=>{var d,f;return((d=e.name)==null?void 0:d.toLowerCase().includes(a))||((f=e.email)==null?void 0:f.toLowerCase().includes(a))})}),B=a=>P.userInfo&&a.id===P.userInfo.id,ae=()=>{},se=async()=>{try{T.value=!0;const a=await $.getEmployees({size:1e3});x.value=a.data||[],console.log("员工管理页面加载成功:",x.value.length,"个员工")}catch(a){console.error("获取员工列表失败:",a),v.error("获取员工列表失败"),x.value=[]}finally{T.value=!1}},oe=a=>{b.value=a,Object.assign(m,{name:a.name,email:a.email,password:"",phone:a.phone||"",role:a.role||"employee",status:a.status}),V.value=!0},ne=async a=>{if(B(a)&&a.status==="active"){v.warning("不能停用自己的账户");return}const e=a.status==="active"?"inactive":"active",d=e==="active"?"启用":"停用";try{await q.confirm(`确定要${d}员工"${a.name}"吗？`,`${d}员工`,{type:"warning"}),await $.updateEmployee(a.id,{status:e}),a.status=e,v.success(`员工已${d}`)}catch(f){f!=="cancel"&&(console.error("更新员工状态失败:",f),v.error(`${d}失败`))}},re=async a=>{try{await q.confirm(`确定要删除员工“${a.name}”吗？
此操作不可撤销！`,"删除员工",{type:"error",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await $.deleteEmployee(a.id);const e=x.value.findIndex(d=>d.id===a.id);e!==-1&&x.value.splice(e,1),v.success("员工已删除")}catch(e){e!=="cancel"&&(console.error("删除员工失败:",e),v.error("删除失败"))}},ie=async()=>{var a;try{if(await((a=U.value)==null?void 0:a.validate()),D.value=!0,b.value)await $.updateEmployee(b.value.id,m),Object.assign(b.value,m),v.success("员工信息已更新");else{const e=await $.createEmployee(m);x.value.unshift(e.data),v.success("员工添加成功")}j()}catch(e){console.error("提交失败:",e),v.error("操作失败，请重试")}finally{D.value=!1}},j=()=>{var a;V.value=!1,b.value=null,Object.assign(m,{name:"",email:"",password:"",phone:"",role:"employee",status:"active"}),(a=U.value)==null||a.resetFields()},ue=a=>{h.value=a,A.value=!0,F()},H=()=>{const a=c.targetWeeksText.trim();if(!a){c.targetWeeks=[],c.targetAbsoluteWeeks=[];return}try{const e=new Set,d=new Set,f=a.split(",").map(n=>n.trim()).filter(n=>n);for(const n of f)if(n.includes("-")){const r=n.lastIndexOf("-");let i,y;if(n.startsWith("-"))if(r===0){const p=parseInt(n);if(!isNaN(p)&&p>=-12&&p<=12&&p!==0){const g=p;e.add(g),d.add(p)}continue}else i=parseInt(n.substring(0,r)),y=parseInt(n.substring(r+1));else{const p=n.split("-");i=parseInt(p[0]),y=parseInt(p[1])}if(isNaN(i)||isNaN(y))continue;const L=Math.min(i,y),N=Math.max(i,y);for(let p=L;p<=N;p++)if(p>=-12&&p<=12&&p!==0){let g;p<0?g=p:g=p-1,e.add(g),d.add(p)}}else{const r=parseInt(n);if(!isNaN(r)&&r>=-12&&r<=12&&r!==0){let i;r<0?i=r:i=r-1,e.add(i),d.add(r)}}c.targetWeeks=Array.from(e).sort((n,r)=>n-r),c.targetAbsoluteWeeks=Array.from(d).sort((n,r)=>n-r)}catch(e){console.error("解析批量删除目标周次失败:",e),c.targetWeeks=[],c.targetAbsoluteWeeks=[]}},M=a=>{c.targetWeeksText=a,H()},F=()=>{c.targetWeeks=[],c.targetAbsoluteWeeks=[],c.targetWeeksText=""},de=async()=>{var a,e,d;if(!c.targetAbsoluteWeeks||c.targetAbsoluteWeeks.length===0){v.warning("请选择要删除的周次范围");return}if(!h.value){v.warning("请选择员工");return}try{S.value=!0;const f=c.targetAbsoluteWeeks.map(i=>i<0?`前${Math.abs(i)}周`:i===1?"当前周":`第${i}周`).join("、");await q.confirm(`确定要删除员工"${h.value.name}"在以下周次的所有空闲时间记录吗？

周次：${f}

⚠️ 此操作无法恢复`,"确认删除",{type:"warning",dangerouslyUseHTMLString:!0});const n={weekOffsets:c.targetWeeks},r=await ve.batchDeleteEmployeeAvailabilityByWeeks(h.value.id,n);r.success?(v.success(`批量删除完成：删除了${r.data.deletedCount}条空闲时间记录`),A.value=!1,F(),r.data.failedCount>0&&((a=r.data.errors)==null?void 0:a.length)>0&&setTimeout(()=>{const i=r.data.errors.slice(0,3).map(y=>y.message).join("；");v.warning(`部分删除失败：${i}${r.data.errors.length>3?"...":""}`)},1e3)):v.error(r.message||"批量删除失败")}catch(f){f!=="cancel"&&(console.error("批量删除员工空闲时间失败:",f),v.error(((d=(e=f.response)==null?void 0:e.data)==null?void 0:d.message)||"批量删除员工空闲时间失败"))}finally{S.value=!1}};return ke(()=>{se()}),(a,e)=>{const d=Y("Plus"),f=Ee,n=Ve,r=Y("Search"),i=Ce,y=We,L=Me,N=Fe,p=Ae,g=he,Q=$e,ce=ze,X=Ie,pe=Ne,G=Te,J=De,me=Se,fe=Ue;return _(),E("div",Le,[o("div",Oe,[e[17]||(e[17]=o("div",null,[o("h1",null,"员工管理"),o("p",null,"管理员工基本信息，添加新员工或更新现有员工状态")],-1)),l(n,{type:"primary",onClick:e[0]||(e[0]=t=>V.value=!0),size:"large"},{default:s(()=>[l(f,null,{default:s(()=>[l(d)]),_:1}),e[16]||(e[16]=u(" 添加员工 ",-1))]),_:1,__:[16]})]),l(y,{class:"search-card"},{default:s(()=>[l(i,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=t=>I.value=t),placeholder:"搜索员工姓名或邮箱...",clearable:"",onInput:ae,class:"search-input"},{prefix:s(()=>[l(f,null,{default:s(()=>[l(r)]),_:1})]),_:1},8,["modelValue"])]),_:1}),we((_(),E("div",qe,[(_(!0),E(Z,null,ee(R.value,t=>(_(),z(y,{key:t.id,class:xe(["employee-card",{inactive:t.status!=="active"}])},{default:s(()=>[o("div",Pe,[o("div",Re,[o("div",je,[l(L,{size:50,src:t.avatar},{default:s(()=>{var C;return[u(w(((C=t.name)==null?void 0:C.charAt(0))||"?"),1)]}),_:2},1032,["src"])]),o("div",He,[o("h3",Qe,w(t.name),1),o("p",Xe,w(t.email),1),t.phone?(_(),E("p",Ge,w(t.phone),1)):W("",!0),t.role?(_(),E("p",Je," 角色："+w(t.role==="admin"?"管理员":"员工"),1)):W("",!0)]),o("div",Ke,[l(N,{type:t.status==="active"?"success":"warning",size:"large"},{default:s(()=>[u(w(t.status==="active"?"在职":"停用"),1)]),_:2},1032,["type"])])])]),o("div",Ye,[o("div",Ze,[l(n,{size:"small",type:"primary",icon:O(Be),onClick:C=>oe(t),disabled:t.status!=="active",class:"action-btn"},{default:s(()=>e[18]||(e[18]=[u(" 编辑 ",-1)])),_:2,__:[18]},1032,["icon","onClick","disabled"]),l(n,{size:"small",type:t.status==="active"?"warning":"success",icon:t.status==="active"?"Pause":"VideoPlay",onClick:C=>ne(t),disabled:B(t)&&t.status==="active",class:"action-btn",title:B(t)&&t.status==="active"?"不能停用自己的账户":""},{default:s(()=>[u(w(t.status==="active"?"停用":"启用"),1)]),_:2},1032,["type","icon","onClick","disabled","title"])]),o("div",et,[l(n,{size:"small",type:"warning",plain:"",icon:O(te),onClick:C=>ue(t),disabled:t.status!=="active",class:"action-btn secondary-btn",title:"批量删除空闲时间"},{default:s(()=>e[19]||(e[19]=[u(" 批删时间 ",-1)])),_:2,__:[19]},1032,["icon","onClick","disabled"]),l(n,{size:"small",type:"danger",plain:"",icon:O(te),onClick:C=>re(t),disabled:t.status!=="inactive",class:"action-btn danger-btn",title:"删除员工"},{default:s(()=>e[20]||(e[20]=[u(" 删除 ",-1)])),_:2,__:[20]},1032,["icon","onClick","disabled"])])])]),_:2},1032,["class"]))),128)),R.value.length===0?(_(),E("div",tt,[l(p,{description:"暂无员工数据"},{default:s(()=>[l(n,{type:"primary",onClick:e[2]||(e[2]=t=>V.value=!0)},{default:s(()=>e[21]||(e[21]=[u(" 添加第一个员工 ",-1)])),_:1,__:[21]})]),_:1})])):W("",!0)])),[[fe,T.value]]),l(J,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=t=>V.value=t),title:b.value?"编辑员工信息":"添加新员工",width:"500px"},{footer:s(()=>[l(n,{onClick:j,size:"large"},{default:s(()=>e[25]||(e[25]=[u("取消",-1)])),_:1,__:[25]}),l(n,{type:"primary",onClick:ie,loading:D.value,size:"large"},{default:s(()=>[u(w(b.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:s(()=>[l(G,{model:m,rules:le,ref_key:"employeeFormRef",ref:U,"label-width":"80px","label-position":"top"},{default:s(()=>[l(g,{label:"员工姓名",prop:"name"},{default:s(()=>[l(i,{modelValue:m.name,"onUpdate:modelValue":e[3]||(e[3]=t=>m.name=t),placeholder:"请输入员工姓名",size:"large"},null,8,["modelValue"])]),_:1}),l(g,{label:"邮箱地址",prop:"email"},{default:s(()=>[l(i,{modelValue:m.email,"onUpdate:modelValue":e[4]||(e[4]=t=>m.email=t),type:"email",placeholder:"用于接收排班通知",size:"large"},null,8,["modelValue"])]),_:1}),b.value?W("",!0):(_(),z(g,{key:0,label:"初始密码",prop:"password"},{default:s(()=>[l(i,{modelValue:m.password,"onUpdate:modelValue":e[5]||(e[5]=t=>m.password=t),type:"password",placeholder:"请输入初始密码（至少6位）",size:"large","show-password":""},null,8,["modelValue"]),e[22]||(e[22]=o("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," 如果不填写，系统将自动设置为默认密码：123456 ",-1))]),_:1,__:[22]})),l(g,{label:"手机号码",prop:"phone"},{default:s(()=>[l(i,{modelValue:m.phone,"onUpdate:modelValue":e[6]||(e[6]=t=>m.phone=t),placeholder:"请输入手机号码",size:"large"},null,8,["modelValue"])]),_:1}),l(g,{label:"角色 *",prop:"role"},{default:s(()=>[l(ce,{modelValue:m.role,"onUpdate:modelValue":e[7]||(e[7]=t=>m.role=t),placeholder:"请选择员工角色",size:"large",style:{width:"100%"}},{default:s(()=>[l(Q,{label:"普通员工",value:"employee"}),l(Q,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),b.value?(_(),z(g,{key:1,label:"状态",prop:"status"},{default:s(()=>[l(pe,{modelValue:m.status,"onUpdate:modelValue":e[8]||(e[8]=t=>m.status=t)},{default:s(()=>[l(X,{label:"active"},{default:s(()=>e[23]||(e[23]=[u("在职",-1)])),_:1,__:[23]}),l(X,{label:"inactive"},{default:s(()=>e[24]||(e[24]=[u("停用",-1)])),_:1,__:[24]})]),_:1},8,["modelValue"])]),_:1})):W("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(J,{modelValue:A.value,"onUpdate:modelValue":e[15]||(e[15]=t=>A.value=t),title:"批量删除员工空闲时间",width:"700px"},{footer:s(()=>[l(n,{onClick:e[14]||(e[14]=t=>A.value=!1)},{default:s(()=>e[31]||(e[31]=[u("取消",-1)])),_:1,__:[31]}),l(n,{type:"danger",onClick:de,loading:S.value,disabled:!c.targetAbsoluteWeeks.length},{default:s(()=>e[32]||(e[32]=[u(" 确认删除空闲时间 ",-1)])),_:1,__:[32]},8,["loading","disabled"])]),default:s(()=>[o("div",lt,[l(me,{title:"批量删除员工空闲时间说明",type:"warning",closable:!1,"show-icon":""},{default:s(()=>e[26]||(e[26]=[o("div",{class:"batch-delete-help"},[o("p",null,[o("strong",null,"功能说明：")]),o("ul",null,[o("li",null,"删除指定员工在某些周次的所有空闲时间记录"),o("li",null,"支持删除单个周次或周次范围")]),o("p",null,[o("strong",null,"输入格式：")]),o("ul",null,[o("li",null,[o("strong",null,"单个周次："),u("1（删除第1周，即当前周）")]),o("li",null,[o("strong",null,"多个周次："),u("1,3,5（删除第1、3、5周）")]),o("li",null,[o("strong",null,"周次范围："),u("2-6（删除第2周到第6周）")]),o("li",null,[o("strong",null,"过去的周："),u("-1,-2（删除前1周、前2周）")]),o("li",null,[o("strong",null,"混合输入："),u("1,3-5,7（删除第1、3-5、7周）")])])],-1)])),_:1}),l(G,{model:c,style:{"margin-top":"20px"}},{default:s(()=>[l(g,{label:"目标员工"},{default:s(()=>{var t;return[l(i,{value:(t=h.value)==null?void 0:t.name,disabled:""},null,8,["value"])]}),_:1}),l(g,{label:"目标周次",required:""},{default:s(()=>[l(i,{modelValue:c.targetWeeksText,"onUpdate:modelValue":e[10]||(e[10]=t=>c.targetWeeksText=t),type:"textarea",rows:3,placeholder:"请输入要删除的周次，如：1,2-4,6",onInput:H},null,8,["modelValue"]),o("div",at,[l(n,{size:"small",onClick:e[11]||(e[11]=t=>M("1"))},{default:s(()=>e[27]||(e[27]=[u("当前周",-1)])),_:1,__:[27]}),l(n,{size:"small",onClick:e[12]||(e[12]=t=>M("1-4"))},{default:s(()=>e[28]||(e[28]=[u("前4周",-1)])),_:1,__:[28]}),l(n,{size:"small",onClick:e[13]||(e[13]=t=>M("1-8"))},{default:s(()=>e[29]||(e[29]=[u("前8周",-1)])),_:1,__:[29]}),l(n,{size:"small",onClick:F},{default:s(()=>e[30]||(e[30]=[u("清空",-1)])),_:1,__:[30]})])]),_:1}),c.targetAbsoluteWeeks.length>0?(_(),z(g,{key:0},{label:s(()=>[o("span",null,"将要删除的周次 ("+w(c.targetAbsoluteWeeks.length)+"个周次)",1)]),default:s(()=>[(_(!0),E(Z,null,ee(c.targetAbsoluteWeeks,t=>(_(),z(N,{key:t,style:{margin:"2px"},type:"danger"},{default:s(()=>[u(w(t<0?`前${Math.abs(t)}周`:t===1?"当前周":`第${t}周`),1)]),_:2},1024))),128))]),_:1})):W("",!0)]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},Vt=_e(st,[["__scopeId","data-v-77e4fb21"]]);export{Vt as default};
