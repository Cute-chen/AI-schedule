import{a as z,e as vt}from"./index-bcd0f302.js";/* empty css                  *//* empty css                    *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css               *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                          *//* empty css                       */import{_ as yt}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                 *//* empty css                       *//* empty css                        *//* empty css                *//* empty css                  */import{r as b,X as ae,c as _t,f as ze,k as kt,y as c,z as k,A as s,Q as a,I as o,u as O,M as m,O as _,P as C,a4 as $,J as Oe,H as E,L as R,C as we,V as be}from"./vendor-b2a91a46.js";import{o as wt,s as bt,U as Pe,F as St,ao as Vt,B as ht,C as Dt,E as p,k as Se,c as Tt,p as It,M as xt,a4 as Wt,a5 as At,a2 as Ct,a6 as $t,a7 as Et,a8 as Ut,X as qt,ap as Mt,af as zt,aq as Ot,W as Pt,_ as Bt,S as Ft,aj as Nt,ak as Rt,ar as Yt,ad as jt,ac as Ht,ae as Lt,ag as Qt,T as Gt,a9 as Xt,aa as Jt,Y as Kt}from"./elementPlus-9365ac08.js";import{W as Be}from"./WeekRangeSelector-08a2a9b6.js";import{s as Ve}from"./settingsService-87306db1.js";import"./utils-88d415ea.js";const Zt={class:"availability-container"},el={class:"page-header"},tl={class:"header-actions"},ll={class:"selector-header"},al={class:"selector-title"},ol={class:"selector-stats"},sl={class:"selector-content"},nl={class:"main-selector"},il={class:"employee-option all-employees"},rl={style:{display:"flex","align-items":"center",gap:"10px",padding:"5px 0"}},dl={style:{width:"28px",height:"28px","border-radius":"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",display:"flex","align-items":"center","justify-content":"center","font-weight":"600","font-size":"12px","flex-shrink":"0"}},ul={style:{flex:"1","min-width":"0"}},ml={style:{"font-weight":"600",color:"#303133","font-size":"14px","line-height":"1.2"}},cl={style:{"font-size":"12px",color:"#909399","line-height":"1.2","margin-top":"2px"}},pl={key:0,style:{"margin-left":"8px","font-size":"11px",background:"#f0f2f5",padding:"1px 4px","border-radius":"8px"}},fl={key:0,style:{"flex-shrink":"0"}},gl={class:"week-selector-header"},vl={class:"selector-mode"},yl={key:0,class:"week-nav"},_l={class:"current-week"},kl={key:1,class:"week-range-controls"},wl={key:0,class:"range-info"},bl={class:"calendar-grid"},Sl={class:"calendar-header"},Vl={class:"day-name"},hl={class:"day-date"},Dl={class:"time-cell"},Tl={class:"time-name"},Il={class:"time-period"},xl={class:"required-people"},Wl=["onClick"],Al={class:"status-content"},Cl={class:"employees-list"},$l={class:"employee-info"},El={class:"employee-name"},Ul={class:"priority-star"},ql={class:"employee-actions"},Ml={class:"timeslot-manager"},zl={class:"manager-header"},Ol={class:"batch-availability-panel"},Pl={class:"time-slot-scheduler"},Bl={class:"weekday-timeslots"},Fl={class:"weekday-header"},Nl={key:0,class:"timeslot-selection"},Rl={class:"batch-delete-section"},Yl={class:"quick-select-buttons"},jl={__name:"index",setup(Hl){const ue=b(!1),P=b(!1),B=b([]),me=b([]),Y=b([]),U=b(""),x=b(new Date),Q=b(!1),G=b(!1),ce=b(!1),X=b(!1),F=b(null),Fe=b(!1),J=b(!1),j=b(!1),q=b("week"),I=b([]),he=b("batch"),pe=["周日","周一","周二","周三","周四","周五","周六"],S=ae({employeeId:"",dateRange:[],timeSlots:[],priority:3,notes:""}),V=ae({id:"",employeeId:"",timeSlotId:"",date:"",priority:3,notes:""}),h=ae({name:"",startTime:"",endTime:"",requiredPeople:1,isActive:!0}),Ne={name:[{required:!0,message:"请输入时间段名称",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],requiredPeople:[{required:!0,message:"请输入需要人数",trigger:"blur"}]},fe=b(),f=ae({employeeIds:[],weeks:[],weekdaySelections:[{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]}],priority:3,notes:""}),w=ae({targetWeeks:[],targetAbsoluteWeeks:[],targetWeeksText:""}),oe=b([]);_t(()=>f.employeeIds.length===0||f.weeks.length===0?!1:f.weekdaySelections.some(e=>e.enabled&&e.timeSlotIds.length>0));const N=async()=>{try{let l;if(q.value==="week")l=await K(x.value);else if(q.value==="range"&&I.value.length>0){const i=new Date().getFullYear(),n=Math.min(...I.value);l=await ne(i,n)}else l=await K(x.value);const e=[];for(let i=0;i<7;i++){const n=new Date(l);n.setDate(l.getDate()+i),e.push({date:n,name:["周日","周一","周二","周三","周四","周五","周六"][n.getDay()]})}oe.value=e}catch(l){console.error("计算周天数失败:",l),oe.value=[]}},H=b(null),ge=b(""),se=async()=>{try{ge.value=await Re(x.value)}catch(l){console.error("更新周范围文本失败:",l),ge.value=Z(x.value)}},K=async l=>{try{return await Ve.calculateWeekStart(l)}catch(e){console.error("计算周开始日期失败:",e);const i=new Date(l),n=i.getDay(),u=i.getDate()-n+(n===0?-6:1);return new Date(i.setDate(u))}},ne=async(l,e)=>{try{H.value||(H.value=await Ve.getWeekStartDate());const i=new Date(H.value);return i.setDate(H.value.getDate()+(e-1)*7),i}catch(i){console.error("获取周开始日期失败:",i);const u=new Date(l,0,1).getDay(),r=u===1?0:u===0?1:8-u,d=new Date(l,0,1+r),M=new Date(l,0,4)<d?new Date(d.getTime()+7*24*60*60*1e3):d,A=new Date(M);return A.setDate(M.getDate()+(e-1)*7),A}},Re=async l=>{try{const e=await K(l),i=new Date(e);return i.setDate(e.getDate()+6),`${Z(e)} - ${Z(i)}`}catch(e){return console.error("格式化周范围失败:",e),Z(l)}},Z=l=>l.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}),Ye=l=>{const e=new Date;return l.toDateString()===e.toDateString()},je=async()=>{const l=new Date(x.value);l.setDate(l.getDate()-7),x.value=l,await N(),await se()},He=async()=>{const l=new Date(x.value);l.setDate(l.getDate()+7),x.value=l,await N(),await se()},Le=async()=>{x.value=new Date,await N(),await se()},Qe=l=>{f.weekdaySelections[l].enabled||(f.weekdaySelections[l].timeSlotIds=[])},ie=(l,e)=>{const i=e.toISOString().split("T")[0];return me.value.filter(n=>n.timeSlotId===l&&n.date===i)},Ge=(l,e)=>ie(l,e).length===0?"empty":"has-availability",De=(l,e,i)=>ie(l,e).some(u=>u.employeeId===i),Xe=(l,e)=>{if(!U.value){p.warning("请先选择员工");return}if(De(l,e,U.value)){const u=ie(l,e).find(r=>r.employeeId===U.value);u&&Ie(u)}else Te(l,e)},Te=(l,e)=>{if(!U.value){p.warning("请先选择员工");return}Je(U.value,l,e)},Je=async(l,e,i)=>{try{const n=i.toISOString().split("T")[0],u={employeeId:l,timeSlotId:e,date:n,priority:3,notes:""},r=await z.createAvailability(u);me.value.push(r.data),p.success("已添加空闲时间")}catch(n){console.error("添加失败:",n),p.error("添加失败")}},Ke=()=>{W()},Ze=async()=>{if(!S.employeeId){p.warning("请选择员工");return}if(!S.dateRange.length){p.warning("请选择日期范围");return}if(!S.timeSlots.length){p.warning("请选择时间段");return}try{P.value=!0;const l={employeeId:S.employeeId,startDate:S.dateRange[0],endDate:S.dateRange[1],timeSlotIds:S.timeSlots,priority:S.priority,notes:S.notes};console.log("快速添加-发送的数据:",l),console.log("选择的日期范围:",S.dateRange),await z.batchCreateAvailability(l),Q.value=!1,W(),p.success("批量添加成功")}catch(l){console.error("批量添加失败:",l),p.error("批量添加失败")}finally{P.value=!1}},et=l=>{V.id=l.id,V.employeeId=l.employeeId,V.timeSlotId=l.timeSlotId,V.date=l.date,V.priority=l.priority||3,V.notes=l.notes||"",G.value=!0},tt=async()=>{try{P.value=!0;const l={priority:V.priority,notes:V.notes};await z.updateAvailability(V.id,l),G.value=!1,await W(),p.success("修改成功")}catch(l){console.error("修改失败:",l),p.error("修改失败")}finally{P.value=!1}},Ie=async l=>{var e;try{await Se.confirm(`确认删除员工"${(e=l.employee)==null?void 0:e.name}"的空闲时间吗？`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await z.deleteAvailability(l.id),await W(),p.success("删除成功")}catch(i){i!=="cancel"&&(console.error("删除失败:",i),p.error("删除失败"))}},lt=l=>{F.value=l,Object.assign(h,{name:l.name,startTime:l.startTime,endTime:l.endTime,requiredPeople:l.requiredPeople,isActive:l.isActive}),X.value=!0},at=async l=>{try{await Se.confirm(`确认删除时间段"${l.name}"吗？如果有关联的空闲时间记录，将停用该时间段。`,"确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await z.deleteTimeSlot(l.id),await ve(),await W(),p.success("时间段删除成功")}catch(e){e!=="cancel"&&(console.error("删除时间段失败:",e),p.error("删除失败"))}},ot=async()=>{var l;try{await((l=fe.value)==null?void 0:l.validate()),P.value=!0;const e={name:h.name,startTime:h.startTime,endTime:h.endTime,dayOfWeek:null,requiredPeople:h.requiredPeople,isActive:h.isActive};F.value?(await z.updateTimeSlot(F.value.id,e),p.success("时间段更新成功")):(await z.createTimeSlot(e),p.success("时间段创建成功")),xe(),await ve(),await W()}catch(e){console.error("时间段操作失败:",e),p.error("操作失败")}finally{P.value=!1}},xe=()=>{var l;X.value=!1,F.value=null,Object.assign(h,{name:"",startTime:"",endTime:"",requiredPeople:1,isActive:!0}),(l=fe.value)==null||l.resetFields()},st=async()=>{Q.value=!0,B.value.length===0&&await We()},We=async()=>{var l;try{const e=await vt.getEmployees({size:1e3});B.value=((l=e.data)==null?void 0:l.data)||e.data||[],console.log("员工列表加载成功:",B.value.length,"个员工")}catch(e){console.error("获取员工列表失败:",e),p.error("获取员工列表失败"),B.value=[]}},ve=async()=>{try{const l=await z.getTimeSlots();Y.value=l.data||[]}catch(l){console.error("获取时间段失败:",l),Y.value=[{id:1,name:"早班",startTime:"09:00",endTime:"13:00",requiredPeople:2},{id:2,name:"中班",startTime:"13:00",endTime:"17:00",requiredPeople:2},{id:3,name:"晚班",startTime:"17:00",endTime:"21:00",requiredPeople:1}]}},W=async()=>{try{ue.value=!0;const l={};if(U.value&&(l.employeeId=U.value),q.value==="week"){const i=await K(x.value),n=new Date(i);n.setDate(i.getDate()+6),l.startDate=i.toISOString().split("T")[0],l.endDate=n.toISOString().split("T")[0]}else if(q.value==="range"&&I.value.length>0){const i=new Date().getFullYear(),n=Math.min(...I.value),u=Math.max(...I.value),r=await ne(i,n),d=await ne(i,u),v=new Date(d);v.setDate(d.getDate()+6),l.startDate=r.toISOString().split("T")[0],l.endDate=v.toISOString().split("T")[0]}else{const i=await K(x.value),n=new Date(i);n.setDate(i.getDate()+6),l.startDate=i.toISOString().split("T")[0],l.endDate=n.toISOString().split("T")[0]}const e=await z.getAvailabilities(l);me.value=e.data||[]}catch(l){console.error("获取可用性数据失败:",l)}finally{ue.value=!1}},nt=async()=>{q.value==="range"&&(I.value=[]),await N(),await W()},it=async l=>{I.value=l,q.value==="range"&&(await N(),await W())},rt=async()=>{const l=[];if(f.employeeIds.length===0&&l.push("目标员工"),f.weeks.length===0&&l.push("目标周期"),f.weekdaySelections.some(i=>i.enabled&&i.timeSlotIds.length>0)||l.push("至少一个星期几的时间段"),l.length>0){p.warning(`请先选择：${l.join("、")}`);return}await dt()},dt=async()=>{if(f.employeeIds.length===0){p.warning("请选择员工");return}if(f.weeks.length===0){p.warning("请选择目标周期");return}if(!f.weekdaySelections.some(e=>e.enabled&&e.timeSlotIds.length>0)){p.warning("请至少为一个星期几选择时间段");return}try{j.value=!0;const e=[],i=new Date().getFullYear();console.log("开始计算具体的空闲时间安排:",f.weeks,f.weekdaySelections);for(const r of f.weeks)try{const d=await ne(i,r);console.log(`第${r}周开始日期:`,d,`星期${d.getDay()}`);for(let v=0;v<7;v++){const M=f.weekdaySelections[v];if(M.enabled&&M.timeSlotIds.length>0){const A=new Date(d);console.log(`选择的dayIndex=${v}(${pe[v]}), weekStart=${d.toDateString()}(星期${d.getDay()})`);const y=d.getDay();let g=v-y;g<0&&(g+=7),A.setDate(d.getDate()+g);const re=A.toISOString().split("T")[0];console.log(`目标日期: ${A.toDateString()}(星期${A.getDay()})`);for(const ee of M.timeSlotIds)e.push({date:re,timeSlotId:ee,weekNumber:r,dayOfWeek:v,dayName:pe[v]})}}}catch(d){console.error(`计算第${r}周日期失败:`,d),p.error(`计算第${r}周日期失败`);return}if(e.length===0){p.warning("没有生成任何空闲时间记录，请检查选择");return}console.log("生成的空闲时间记录:",e);let n=0;const u=f.employeeIds.length*e.length;for(const r of f.employeeIds)for(const d of e)try{const v={employeeId:r,timeSlotId:d.timeSlotId,date:d.date,priority:f.priority,notes:f.notes};await z.createAvailability(v),n++,console.log(`创建空闲时间记录: ${d.dayName} ${d.date} 时间段${d.timeSlotId}`)}catch(v){console.error("创建空闲时间记录失败:",d,v)}n===u?p.success(`批量设置空闲时间完成，共创建了 ${n} 条记录`):n>0?p.warning(`部分创建成功，共创建了 ${n}/${u} 条记录`):p.error("批量设置空闲时间失败，没有创建任何记录"),J.value=!1,W()}catch(e){console.error("批量设置空闲时间失败:",e),p.error("批量设置空闲时间失败")}finally{j.value=!1}},ut=()=>{Object.assign(f,{employeeIds:[],weeks:[],weekdaySelections:[{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]},{enabled:!1,timeSlotIds:[]}],priority:3,notes:""})},Ae=()=>{const l=w.targetWeeksText.trim();if(!l){w.targetWeeks=[],w.targetAbsoluteWeeks=[];return}try{const e=new Set,i=new Set,n=l.split(",").map(u=>u.trim()).filter(u=>u);for(const u of n)if(u.includes("-")){const r=u.lastIndexOf("-");let d,v;if(u.startsWith("-"))if(r===0){const y=parseInt(u);if(!isNaN(y)&&y>=-12&&y<=12&&y!==0){const g=y;e.add(g),i.add(y)}continue}else d=parseInt(u.substring(0,r)),v=parseInt(u.substring(r+1));else{const y=u.split("-");d=parseInt(y[0]),v=parseInt(y[1])}if(isNaN(d)||isNaN(v))continue;const M=Math.min(d,v),A=Math.max(d,v);for(let y=M;y<=A;y++)if(y>=-12&&y<=12&&y!==0){let g;y<0?g=y:g=y-1,e.add(g),i.add(y)}}else{const r=parseInt(u);if(!isNaN(r)&&r>=-12&&r<=12&&r!==0){let d;r<0?d=r:d=r-1,e.add(d),i.add(r)}}w.targetWeeks=Array.from(e).sort((u,r)=>u-r),w.targetAbsoluteWeeks=Array.from(i).sort((u,r)=>u-r)}catch(e){console.error("解析批量删除目标周次失败:",e),w.targetWeeks=[],w.targetAbsoluteWeeks=[]}},ye=l=>{w.targetWeeksText=l,Ae()},mt=async()=>{var l,e,i;if(!w.targetAbsoluteWeeks||w.targetAbsoluteWeeks.length===0){p.warning("请选择要删除的周次范围");return}try{j.value=!0;const n=w.targetAbsoluteWeeks.map(d=>d<0?`前${Math.abs(d)}周`:d===1?"当前周":`第${d}周`).join("、");await Se.confirm(`确定要删除以下周次的所有员工的所有空闲时间记录吗？

周次：${n}

⚠️ 此操作无法恢复`,"确认删除",{type:"warning",dangerouslyUseHTMLString:!0});const u={weekOffsets:w.targetWeeks},r=await z.batchDeleteAllAvailabilityByWeeks(u);r.success?(p.success(`批量删除完成：删除了${r.data.deletedCount}条空闲时间记录`),J.value=!1,_e(),await W(),r.data.failedCount>0&&((l=r.data.errors)==null?void 0:l.length)>0&&setTimeout(()=>{const d=r.data.errors.slice(0,3).map(v=>v.message).join("；");p.warning(`部分删除失败：${d}${r.data.errors.length>3?"...":""}`)},1e3)):p.error(r.message||"批量删除失败")}catch(n){n!=="cancel"&&(console.error("批量删除所有员工空闲时间失败:",n),p.error(((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"批量删除空闲时间失败"))}finally{j.value=!1}},_e=()=>{w.targetWeeks=[],w.targetAbsoluteWeeks=[],w.targetWeeksText=""};return ze(x,async()=>{await W()}),ze([q,I],async()=>{await N()},{deep:!0}),kt(async()=>{if(!H.value)try{H.value=await Ve.getWeekStartDate()}catch(l){console.error("加载系统周设置失败:",l)}await We(),await ve(),await N(),await se(),await W()}),(l,e)=>{const i=Tt,n=It,u=xt,r=Wt,d=At,v=Ct,M=$t,A=Et,y=Ut,g=qt,re=Mt,ee=Kt,Ce=zt,ke=Ot,de=Pt,te=Bt,le=Ft,L=Nt,ct=Rt,$e=Yt,pt=jt,Ee=Ht,Ue=Lt,ft=Qt,qe=Gt;return c(),k("div",Zt,[s("div",el,[e[38]||(e[38]=s("div",null,[s("h1",null,"空闲时间管理"),s("p",null,"智能管理员工空闲时间，支持批量操作和模板化管理")],-1)),s("div",tl,[a(n,{onClick:e[0]||(e[0]=t=>J.value=!0),type:"success"},{default:o(()=>[a(i,null,{default:o(()=>[a(O(wt))]),_:1}),e[35]||(e[35]=m(" 批量操作 ",-1))]),_:1,__:[35]}),a(n,{onClick:e[1]||(e[1]=t=>ce.value=!0)},{default:o(()=>[a(i,null,{default:o(()=>[a(O(bt))]),_:1}),e[36]||(e[36]=m(" 时间段管理 ",-1))]),_:1,__:[36]}),a(n,{type:"primary",onClick:st},{default:o(()=>[a(i,null,{default:o(()=>[a(O(Pe))]),_:1}),e[37]||(e[37]=m(" 快速添加 ",-1))]),_:1,__:[37]})])]),a(v,{class:"employee-selector"},{default:o(()=>[s("div",ll,[s("div",al,[a(i,null,{default:o(()=>[a(O(St))]),_:1}),e[39]||(e[39]=s("span",null,"员工选择",-1))]),s("div",ol,[a(u,{type:"info",size:"small"},{default:o(()=>[m(" 共 "+_(B.value.length)+" 名员工 ",1)]),_:1})])]),s("div",sl,[s("div",nl,[e[41]||(e[41]=s("div",{class:"selector-label"},"当前员工：",-1)),a(d,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=t=>U.value=t),placeholder:"选择要管理空闲时间的员工",size:"large",filterable:"",clearable:"",onChange:Ke,class:"employee-select"},{default:o(()=>[a(r,{label:"所有员工",value:""},{default:o(()=>[s("div",il,[a(i,null,{default:o(()=>[a(O(Vt))]),_:1}),e[40]||(e[40]=s("div",{class:"employee-info"},[s("div",{class:"employee-name"},"所有员工"),s("div",{class:"employee-desc"},"查看所有员工的空闲时间")],-1))])]),_:1}),(c(!0),k(C,null,$(B.value,t=>(c(),E(r,{key:t.id,label:`${t.name} - ${t.email}`,value:t.id},{default:o(()=>[s("div",rl,[s("div",dl,_(t.name.charAt(0)),1),s("div",ul,[s("div",ml,_(t.name),1),s("div",cl,[m(_(t.email)+" ",1),t.role?(c(),k("span",pl,_(t.role),1)):R("",!0)])]),t.isActive!==void 0?(c(),k("div",fl,[a(u,{type:t.isActive?"success":"info",size:"small"},{default:o(()=>[m(_(t.isActive?"在职":"离职"),1)]),_:2},1032,["type"])])):R("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),_:1}),a(v,{class:"week-range-selector"},{default:o(()=>[s("div",gl,[s("div",vl,[a(A,{modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=t=>q.value=t),onChange:nt},{default:o(()=>[a(M,{label:"week"},{default:o(()=>e[42]||(e[42]=[m("单周视图",-1)])),_:1,__:[42]}),a(M,{label:"range"},{default:o(()=>e[43]||(e[43]=[m("周期视图",-1)])),_:1,__:[43]})]),_:1},8,["modelValue"])]),q.value==="week"?(c(),k("div",yl,[a(n,{onClick:je,icon:O(ht),size:"small"},{default:o(()=>e[44]||(e[44]=[m("上一周",-1)])),_:1,__:[44]},8,["icon"]),s("div",_l,[s("h3",null,_(ge.value||"加载中..."),1),a(n,{onClick:Le,size:"small",type:"primary",link:""},{default:o(()=>e[45]||(e[45]=[m("回到本周",-1)])),_:1,__:[45]})]),a(n,{onClick:He,icon:O(Dt),size:"small"},{default:o(()=>e[46]||(e[46]=[m("下一周",-1)])),_:1,__:[46]},8,["icon"])])):(c(),k("div",kl,[a(Be,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t),title:"选择查看的周期范围","max-weeks":16,onChange:it},null,8,["modelValue"])]))])]),_:1}),Oe((c(),E(v,{class:"availability-calendar"},{default:o(()=>[q.value==="range"&&I.value.length>0?(c(),k("div",wl,[a(y,{title:`正在显示第${Math.min(...I.value)}-${Math.max(...I.value)}周的数据 (显示第${Math.min(...I.value)}周的界面)`,type:"info","show-icon":"",closable:!1,class:"mb-16"},null,8,["title"])])):R("",!0),s("div",bl,[s("div",Sl,[e[47]||(e[47]=s("div",{class:"time-cell"},"时间段",-1)),(c(!0),k(C,null,$(oe.value,t=>(c(),k("div",{key:t.date,class:we(["day-cell",{today:Ye(t.date)}])},[s("div",Vl,_(t.name),1),s("div",hl,_(Z(t.date)),1)],2))),128))]),(c(!0),k(C,null,$(Y.value,t=>(c(),k("div",{key:t.id,class:"time-row"},[s("div",Dl,[s("div",Tl,_(t.name),1),s("div",Il,_(t.startTime)+" - "+_(t.endTime),1),s("div",xl,"需要"+_(t.requiredPeople)+"人",1)]),(c(!0),k(C,null,$(oe.value,T=>(c(),k("div",{key:`${t.id}-${T.date}`,class:"availability-cell",onClick:D=>Xe(t.id,T.date)},[s("div",{class:we(["availability-status",Ge(t.id,T.date)])},[s("div",Al,[s("div",Cl,[(c(!0),k(C,null,$(ie(t.id,T.date),D=>{var Me;return c(),k("div",{key:D.id,class:we(["employee-item",`priority-${D.priority||1}`])},[s("div",$l,[s("span",El,_((Me=D.employee)==null?void 0:Me.name),1),s("span",Ul,_("★".repeat(D.priority||1)),1)]),s("div",ql,[a(n,{class:"action-btn edit-btn",size:"small",type:"primary",onClick:be(gt=>et(D),["stop"]),title:"编辑"},{default:o(()=>[a(i,null,{default:o(()=>[a(O(Xt))]),_:1})]),_:2},1032,["onClick"]),a(n,{class:"action-btn delete-btn",size:"small",type:"danger",onClick:be(gt=>Ie(D),["stop"]),title:"删除"},{default:o(()=>[a(i,null,{default:o(()=>[a(O(Jt))]),_:1})]),_:2},1032,["onClick"])])],2)}),128))]),U.value&&!De(t.id,T.date,U.value)?(c(),E(n,{key:0,class:"add-btn",size:"small",type:"primary",onClick:be(D=>Te(t.id,T.date),["stop"])},{default:o(()=>e[48]||(e[48]=[m(" + ",-1)])),_:2,__:[48]},1032,["onClick"])):R("",!0)])],2)],8,Wl))),128))]))),128))])]),_:1})),[[qe,ue.value]]),a(le,{modelValue:Q.value,"onUpdate:modelValue":e[11]||(e[11]=t=>Q.value=t),title:"快速添加空闲时间",width:"600px"},{footer:o(()=>[a(n,{onClick:e[10]||(e[10]=t=>Q.value=!1)},{default:o(()=>e[49]||(e[49]=[m("取消",-1)])),_:1,__:[49]}),a(n,{type:"primary",onClick:Ze,loading:P.value},{default:o(()=>e[50]||(e[50]=[m(" 批量添加 ",-1)])),_:1,__:[50]},8,["loading"])]),default:o(()=>[a(te,{model:S,"label-width":"100px"},{default:o(()=>[a(g,{label:"员工",required:""},{default:o(()=>[a(d,{modelValue:S.employeeId,"onUpdate:modelValue":e[5]||(e[5]=t=>S.employeeId=t),style:{width:"100%"}},{default:o(()=>[(c(!0),k(C,null,$(B.value,t=>(c(),E(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"日期范围",required:""},{default:o(()=>[a(re,{modelValue:S.dateRange,"onUpdate:modelValue":e[6]||(e[6]=t=>S.dateRange=t),type:"daterange","range-separator":"到","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(g,{label:"时间段",required:""},{default:o(()=>[a(Ce,{modelValue:S.timeSlots,"onUpdate:modelValue":e[7]||(e[7]=t=>S.timeSlots=t)},{default:o(()=>[(c(!0),k(C,null,$(Y.value,t=>(c(),E(ee,{key:t.id,label:t.id},{default:o(()=>[m(_(t.name)+" ("+_(t.startTime)+" - "+_(t.endTime)+") ",1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"优先级"},{default:o(()=>[a(ke,{modelValue:S.priority,"onUpdate:modelValue":e[8]||(e[8]=t=>S.priority=t),"show-text":""},null,8,["modelValue"])]),_:1}),a(g,{label:"备注"},{default:o(()=>[a(de,{modelValue:S.notes,"onUpdate:modelValue":e[9]||(e[9]=t=>S.notes=t),type:"textarea",rows:2,placeholder:"可选：添加备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(le,{modelValue:ce.value,"onUpdate:modelValue":e[13]||(e[13]=t=>ce.value=t),title:"时间段管理",width:"800px"},{default:o(()=>[s("div",Ml,[s("div",zl,[a(n,{type:"primary",onClick:e[12]||(e[12]=t=>X.value=!0)},{default:o(()=>[a(i,null,{default:o(()=>[a(O(Pe))]),_:1}),e[51]||(e[51]=m(" 添加时间段 ",-1))]),_:1,__:[51]})]),Oe((c(),E(ct,{data:Y.value},{default:o(()=>[a(L,{prop:"name",label:"时间段名称",width:"120"}),a(L,{prop:"startTime",label:"开始时间",width:"100"}),a(L,{prop:"endTime",label:"结束时间",width:"100"}),a(L,{prop:"requiredPeople",label:"需要人数",width:"100",align:"center"}),a(L,{prop:"isActive",label:"状态",width:"80",align:"center"},{default:o(({row:t})=>[a(u,{type:t.isActive?"success":"warning"},{default:o(()=>[m(_(t.isActive?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),a(L,{label:"操作",width:"160",align:"center"},{default:o(({row:t})=>[a(n,{size:"small",onClick:T=>lt(t)},{default:o(()=>e[52]||(e[52]=[m("编辑",-1)])),_:2,__:[52]},1032,["onClick"]),a(n,{size:"small",type:"danger",onClick:T=>at(t)},{default:o(()=>e[53]||(e[53]=[m("删除",-1)])),_:2,__:[53]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[qe,Fe.value]])])]),_:1},8,["modelValue"]),a(le,{modelValue:X.value,"onUpdate:modelValue":e[19]||(e[19]=t=>X.value=t),title:F.value?"编辑时间段":"添加时间段",width:"500px"},{footer:o(()=>[a(n,{onClick:xe},{default:o(()=>e[56]||(e[56]=[m("取消",-1)])),_:1,__:[56]}),a(n,{type:"primary",onClick:ot,loading:P.value},{default:o(()=>[m(_(F.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:o(()=>[a(te,{model:h,rules:Ne,ref_key:"timeSlotFormRef",ref:fe,"label-width":"100px"},{default:o(()=>[a(g,{label:"时间段名称",prop:"name"},{default:o(()=>[a(de,{modelValue:h.name,"onUpdate:modelValue":e[14]||(e[14]=t=>h.name=t),placeholder:"如：早班、中班、晚班"},null,8,["modelValue"])]),_:1}),a(g,{label:"开始时间",prop:"startTime"},{default:o(()=>[a($e,{modelValue:h.startTime,"onUpdate:modelValue":e[15]||(e[15]=t=>h.startTime=t),format:"HH:mm","value-format":"HH:mm",placeholder:"选择开始时间"},null,8,["modelValue"])]),_:1}),a(g,{label:"结束时间",prop:"endTime"},{default:o(()=>[a($e,{modelValue:h.endTime,"onUpdate:modelValue":e[16]||(e[16]=t=>h.endTime=t),format:"HH:mm","value-format":"HH:mm",placeholder:"选择结束时间"},null,8,["modelValue"])]),_:1}),a(g,{label:"需要人数",prop:"requiredPeople"},{default:o(()=>[a(pt,{modelValue:h.requiredPeople,"onUpdate:modelValue":e[17]||(e[17]=t=>h.requiredPeople=t),min:1,max:10},null,8,["modelValue"])]),_:1}),F.value?(c(),E(g,{key:0,label:"状态",prop:"isActive"},{default:o(()=>[a(A,{modelValue:h.isActive,"onUpdate:modelValue":e[18]||(e[18]=t=>h.isActive=t)},{default:o(()=>[a(Ee,{label:!0},{default:o(()=>e[54]||(e[54]=[m("启用",-1)])),_:1,__:[54]}),a(Ee,{label:!1},{default:o(()=>e[55]||(e[55]=[m("停用",-1)])),_:1,__:[55]})]),_:1},8,["modelValue"])]),_:1})):R("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(le,{modelValue:G.value,"onUpdate:modelValue":e[25]||(e[25]=t=>G.value=t),title:"编辑空闲时间",width:"500px"},{footer:o(()=>[a(n,{onClick:e[24]||(e[24]=t=>G.value=!1)},{default:o(()=>e[57]||(e[57]=[m("取消",-1)])),_:1,__:[57]}),a(n,{type:"primary",onClick:tt,loading:P.value},{default:o(()=>e[58]||(e[58]=[m(" 保存修改 ",-1)])),_:1,__:[58]},8,["loading"])]),default:o(()=>[a(te,{model:V,"label-width":"100px"},{default:o(()=>[a(g,{label:"员工"},{default:o(()=>[a(d,{modelValue:V.employeeId,"onUpdate:modelValue":e[20]||(e[20]=t=>V.employeeId=t),disabled:"",style:{width:"100%"}},{default:o(()=>[(c(!0),k(C,null,$(B.value,t=>(c(),E(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"日期"},{default:o(()=>[a(re,{modelValue:V.date,"onUpdate:modelValue":e[21]||(e[21]=t=>V.date=t),type:"date",disabled:"","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(g,{label:"优先级"},{default:o(()=>[a(ke,{modelValue:V.priority,"onUpdate:modelValue":e[22]||(e[22]=t=>V.priority=t),"show-text":""},null,8,["modelValue"])]),_:1}),a(g,{label:"备注"},{default:o(()=>[a(de,{modelValue:V.notes,"onUpdate:modelValue":e[23]||(e[23]=t=>V.notes=t),type:"textarea",rows:3,placeholder:"可选：添加备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(le,{modelValue:J.value,"onUpdate:modelValue":e[34]||(e[34]=t=>J.value=t),title:"批量空闲时间操作",width:"800px","close-on-click-modal":!1},{default:o(()=>[s("div",Ol,[a(ft,{modelValue:he.value,"onUpdate:modelValue":e[33]||(e[33]=t=>he.value=t)},{default:o(()=>[a(Ue,{label:"批量设置",name:"batch"},{default:o(()=>[a(te,{model:f,"label-width":"100px"},{default:o(()=>[a(g,{label:"目标员工"},{default:o(()=>[a(d,{modelValue:f.employeeIds,"onUpdate:modelValue":e[26]||(e[26]=t=>f.employeeIds=t),multiple:"",placeholder:"选择员工"},{default:o(()=>[(c(!0),k(C,null,$(B.value,t=>(c(),E(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"目标周期"},{default:o(()=>[a(Be,{modelValue:f.weeks,"onUpdate:modelValue":e[27]||(e[27]=t=>f.weeks=t),title:"选择要设置空闲时间的周期"},null,8,["modelValue"])]),_:1}),a(g,{label:"时间段安排"},{default:o(()=>[s("div",Pl,[e[59]||(e[59]=s("p",{class:"scheduler-tip"},"为每个星期几选择对应的时间段：",-1)),s("div",Bl,[(c(),k(C,null,$(pe,(t,T)=>s("div",{key:T,class:"weekday-group"},[s("div",Fl,[a(ee,{modelValue:f.weekdaySelections[T].enabled,"onUpdate:modelValue":D=>f.weekdaySelections[T].enabled=D,onChange:D=>Qe(T)},{default:o(()=>[m(_(t),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),f.weekdaySelections[T].enabled?(c(),k("div",Nl,[a(Ce,{modelValue:f.weekdaySelections[T].timeSlotIds,"onUpdate:modelValue":D=>f.weekdaySelections[T].timeSlotIds=D},{default:o(()=>[(c(!0),k(C,null,$(Y.value,D=>(c(),E(ee,{key:D.id,label:D.id,size:"small"},{default:o(()=>[m(_(D.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):R("",!0)])),64))])])]),_:1}),a(g,{label:"优先级"},{default:o(()=>[a(ke,{modelValue:f.priority,"onUpdate:modelValue":e[28]||(e[28]=t=>f.priority=t),"show-text":""},null,8,["modelValue"])]),_:1}),a(g,null,{default:o(()=>[a(n,{type:"primary",onClick:rt,loading:j.value},{default:o(()=>e[60]||(e[60]=[m(" 批量设置空闲时间 ",-1)])),_:1,__:[60]},8,["loading"]),a(n,{onClick:ut},{default:o(()=>e[61]||(e[61]=[m("重置",-1)])),_:1,__:[61]})]),_:1})]),_:1},8,["model"])]),_:1}),a(Ue,{label:"按周删除",name:"delete"},{default:o(()=>[s("div",Rl,[a(y,{title:"按周次批量删除空闲时间",type:"warning",closable:!1,"show-icon":""},{default:o(()=>e[62]||(e[62]=[s("div",{class:"batch-delete-help"},[s("p",null,[s("strong",null,"功能说明：")]),s("ul",null,[s("li",null,"删除指定周次的所有员工的所有空闲时间记录"),s("li",null,"支持删除单个周次或周次范围"),s("li",null,"此操作不可恢复，请谨慎操作")]),s("p",null,[s("strong",null,"输入格式：")]),s("ul",null,[s("li",null,[s("strong",null,"单个周次："),m("1（删除第1周，即当前周）")]),s("li",null,[s("strong",null,"多个周次："),m("1,3,5（删除第1、3、5周）")]),s("li",null,[s("strong",null,"周次范围："),m("2-6（删除第2周到第6周）")]),s("li",null,[s("strong",null,"过去的周："),m("-1,-2（删除前1周、前2周）")]),s("li",null,[s("strong",null,"混合输入："),m("1,3-5,7（删除第1、3-5、7周）")])])],-1)])),_:1}),a(te,{model:w,"label-width":"100px",style:{"margin-top":"20px"}},{default:o(()=>[a(g,{label:"目标周次",required:""},{default:o(()=>[a(de,{modelValue:w.targetWeeksText,"onUpdate:modelValue":e[29]||(e[29]=t=>w.targetWeeksText=t),type:"textarea",rows:3,placeholder:"请输入要删除的周次，如：1,2-4,6",onInput:Ae},null,8,["modelValue"]),s("div",Yl,[a(n,{size:"small",onClick:e[30]||(e[30]=t=>ye("1"))},{default:o(()=>e[63]||(e[63]=[m("当前周",-1)])),_:1,__:[63]}),a(n,{size:"small",onClick:e[31]||(e[31]=t=>ye("1-4"))},{default:o(()=>e[64]||(e[64]=[m("前4周",-1)])),_:1,__:[64]}),a(n,{size:"small",onClick:e[32]||(e[32]=t=>ye("1-8"))},{default:o(()=>e[65]||(e[65]=[m("前8周",-1)])),_:1,__:[65]}),a(n,{size:"small",onClick:_e},{default:o(()=>e[66]||(e[66]=[m("清空",-1)])),_:1,__:[66]})])]),_:1}),w.targetAbsoluteWeeks.length>0?(c(),E(g,{key:0},{label:o(()=>[s("span",null,"将要删除的周次 ("+_(w.targetAbsoluteWeeks.length)+"个周次)",1)]),default:o(()=>[(c(!0),k(C,null,$(w.targetAbsoluteWeeks,t=>(c(),E(u,{key:t,style:{margin:"2px"},type:"danger"},{default:o(()=>[m(_(t<0?`前${Math.abs(t)}周`:t===1?"当前周":`第${t}周`),1)]),_:2},1024))),128))]),_:1})):R("",!0),a(g,null,{default:o(()=>[a(n,{type:"danger",onClick:mt,loading:j.value,disabled:!w.targetAbsoluteWeeks.length},{default:o(()=>e[67]||(e[67]=[m(" 批量删除空闲时间 ",-1)])),_:1,__:[67]},8,["loading","disabled"]),a(n,{onClick:_e},{default:o(()=>e[68]||(e[68]=[m("重置",-1)])),_:1,__:[68]})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},wa=yt(jl,[["__scopeId","data-v-3721dfaf"]]);export{wa as default};
