import{u as be,s as Ce,e as xe,a as Ie}from"./index-bcd0f302.js";/* empty css                  *//* empty css                   *//* empty css                             *//* empty css                *//* empty css               */import{_ as We}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                *//* empty css               */import{aC as Ee,r as f,c as Me,f as Ne,k as Pe,y as r,z as _,A as t,O as i,u as m,Q as o,I as l,J as ze,H as se,M as p,P as C,a4 as x,L as I,C as J}from"./vendor-b2a91a46.js";import{M as Re,N as $e,P as Oe,a2 as qe,S as Ve,T as Ae,B as Be,C as Le,I as Fe,H as Ue,al as He,D as Qe,E as Ge,c as Je,p as Ye,O as je,Q as Ke,R as Xe,U as de}from"./elementPlus-9365ac08.js";import{s as re}from"./settingsService-87306db1.js";import"./utils-88d415ea.js";const Ze={class:"employee-dashboard-container"},et={class:"welcome-section"},tt={class:"welcome-text"},st={class:"today-info"},at={class:"last-update"},ot={class:"section-header"},lt={class:"header-actions"},nt={class:"current-week-info"},it={class:"week-range"},ct={class:"week-number"},dt={class:"schedule-calendar desktop-view"},rt={class:"calendar-header"},ut={class:"day-name"},_t={class:"day-date"},vt={class:"time-cell"},mt={class:"time-name"},pt={class:"time-period"},ht={class:"required-people"},ft={class:"schedule-content"},yt=["onClick"],gt={class:"employee-info"},wt={class:"employee-name"},Dt={key:0,class:"my-badge"},kt={key:0,class:"vacancy-slot"},St={class:"schedule-list mobile-view"},Tt={class:"day-info"},bt={class:"day-name"},Ct={class:"day-date"},xt={class:"day-status"},It={class:"my-shifts"},Wt={class:"total-shifts"},Et={class:"day-time-slots"},Mt={class:"slot-header"},Nt={class:"slot-info"},Pt={class:"slot-name"},zt={class:"slot-time"},Rt={class:"slot-status"},$t={class:"slot-employees"},Ot=["onClick"],qt={key:0,class:"me-badge"},Vt={key:0,class:"add-employee-chip"},At={class:"schedule-summary"},Bt={class:"summary-item"},Lt={class:"value"},Ft={class:"summary-item"},Ut={class:"value success"},Ht={class:"summary-item"},Qt={class:"value primary"},Gt={class:"summary-item"},Jt={class:"value"},Yt={class:"quick-actions"},jt={class:"action-content"},Kt={class:"action-icon"},Xt={class:"action-content"},Zt={class:"action-icon"},es={class:"action-content"},ts={class:"action-icon"},ss={class:"action-content"},as={class:"action-icon"},os={key:0,class:"schedule-detail"},ls={__name:"Dashboard",setup(ns){const ue=Ee(),D=be(),Y=f(!1),ae=f("æœªæ›´æ–°"),k=f([]),M=f([]),S=f([]),T=f(new Date),N=f(!1),y=f(null),j=f(1),P=f([]),K=f("åŠ è½½ä¸­..."),X=f("åŠ è½½ä¸­..."),L=Me(()=>{const s=S.value.reduce((c,d)=>c+d.requiredPeople*7,0),e=k.value.length,n=k.value.filter(c=>{var d,b;return((d=c.employee)==null?void 0:d.id)===((b=D.userInfo)==null?void 0:b.id)}).length;return{total:s,assigned:e,myShifts:n,completionRate:s>0?Math.round(e/s*100):0}}),Z=async s=>{try{return await re.calculateWeekStart(s)}catch(e){console.error("è®¡ç®—å‘¨å¼€å§‹æ—¥æœŸå¤±è´¥:",e);const n=new Date(s),c=n.getDay(),d=n.getDate()-c+(c===0?-6:1);return new Date(n.setDate(d))}},_e=s=>s.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),F=s=>s.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}),oe=async s=>{try{const e=await Z(s),n=new Date(e);return n.setDate(e.getDate()+6),`${F(e)} - ${F(n)}`}catch(e){return console.error("æ ¼å¼åŒ–å‘¨èŒƒå›´å¤±è´¥:",e),"åŠ è½½ä¸­..."}},U=async()=>{try{const s=await Z(T.value),e=[];for(let n=0;n<7;n++){const c=new Date(s);c.setDate(s.getDate()+n),e.push({date:c,name:["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][c.getDay()]})}P.value=e}catch(s){console.error("è®¡ç®—å‘¨å¤©æ•°å¤±è´¥:",s),P.value=[]}},ve=async s=>{try{const e=await re.getWeekStartDate(),n=new Date(s),c=Math.floor((n-e)/(1e3*60*60*24)),d=Math.floor(c/7)+1;return Math.max(1,d)}catch(e){console.error("è®¡ç®—å‘¨æ¬¡å¤±è´¥:",e);const n=s.getFullYear(),c=new Date(n,0,1),d=Math.floor((s-c)/(24*60*60*1e3));return Math.ceil((d+c.getDay()+1)/7)}},ee=async()=>{try{j.value=await ve(T.value)}catch(s){console.error("æ›´æ–°å½“å‰å‘¨æ¬¡å¤±è´¥:",s),j.value=1}},H=async()=>{try{K.value=await oe(T.value)}catch(s){console.error("æ›´æ–°å‘¨èŒƒå›´æ–‡æœ¬å¤±è´¥:",s),K.value="åŠ è½½å¤±è´¥"}},me=async()=>{try{X.value=await oe(new Date)}catch(s){console.error("æ›´æ–°ä»Šå¤©å‘¨èŒƒå›´æ–‡æœ¬å¤±è´¥:",s),X.value="åŠ è½½å¤±è´¥"}},le=s=>{const e=new Date;return s.toDateString()===e.toDateString()},pe=()=>{const s=new Date().getHours();return s<6?"å¤œæ·±äº†ï¼Œæ³¨æ„ä¼‘æ¯":s<12?"ä¸Šåˆå¥½":s<14?"ä¸­åˆå¥½":s<18?"ä¸‹åˆå¥½":"æ™šä¸Šå¥½"},Q=(s,e)=>{const n=e.toISOString().split("T")[0];return k.value.filter(c=>c.time_slot_id===s&&c.schedule_date===n)},he=s=>{const e=s.toISOString().split("T")[0];return k.value.filter(n=>n.schedule_date===e)},fe=s=>{const e=s.toISOString().split("T")[0];return k.value.filter(n=>{var c,d;return n.schedule_date===e&&((c=n.employee)==null?void 0:c.id)===((d=D.userInfo)==null?void 0:d.id)})},z=(s,e)=>{const n=S.value.find(d=>d.id===s);if(!n)return 0;const c=Q(s,e).length;return Math.max(0,n.requiredPeople-c)},ye=async()=>{const s=new Date(T.value);s.setDate(s.getDate()-7),T.value=s,await ee(),await U(),await H()},ge=async()=>{const s=new Date(T.value);s.setDate(s.getDate()+7),T.value=s,await ee(),await U(),await H()},ne=s=>{y.value=s,N.value=!0},we=()=>{N.value=!1,ue.push("/employee/shift-requests")},De=()=>{Ge.info("å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­")},ke=async()=>{await Promise.all([ie(),ce()]),await te()},te=async()=>{var s;try{Y.value=!0;const e=await Z(T.value),n=e.toISOString().split("T")[0],c=new Date(e);c.setDate(e.getDate()+6);const d={dateRange:[n,c.toISOString().split("T")[0]]},g=(await Ce.getSchedules(d)).data,G=((s=g.data)==null?void 0:s.data)||g.data||[];k.value=G.map(h=>{const w=M.value.find(R=>R.id===h.employee_id),W=S.value.find(R=>R.id===h.time_slot_id);return console.log("æŽ’ç­æ•°æ®å…³è”:",{schedule:h.id,employee_id:h.employee_id,employee:w==null?void 0:w.name,time_slot_id:h.time_slot_id,timeSlot:W==null?void 0:W.name}),{...h,employee:w,timeSlot:W}}),console.log("æŽ’ç­æ•°æ®å¤„ç†å®Œæˆ:",{total:k.value.length,employees:M.value.length,timeSlots:S.value.length,sample:k.value[0]})}catch(e){console.error("èŽ·å–æŽ’ç­æ•°æ®å¤±è´¥:",e),k.value=[]}finally{Y.value=!1,ae.value=new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}},ie=async()=>{var s;try{const e=await xe.getEmployees();console.log("å‘˜å·¥APIå“åº”:",e);const n=e.data;M.value=((s=n.data)==null?void 0:s.data)||n.data||n||[],console.log("å‘˜å·¥æ•°æ®å¤„ç†ç»“æžœ:",M.value)}catch(e){console.error("èŽ·å–å‘˜å·¥åˆ—è¡¨å¤±è´¥:",e),M.value=[]}},ce=async()=>{var s;try{const e=await Ie.getTimeSlots();console.log("æ—¶é—´æ®µAPIå“åº”:",e);const n=e.data;S.value=((s=n.data)==null?void 0:s.data)||n.data||n||[],console.log("æ—¶é—´æ®µæ•°æ®å¤„ç†ç»“æžœ:",S.value)}catch(e){console.error("èŽ·å–æ—¶é—´æ®µæ•°æ®å¤±è´¥:",e),S.value=[]}};return Ne(T,async()=>{await U(),await H(),await te()}),Pe(async()=>{await Promise.all([ie(),ce()]),await ee(),await U(),await H(),await me(),await te()}),(s,e)=>{const n=Re,c=$e,d=Je,b=Ye,g=je,G=Oe,h=qe,w=Ke,W=Xe,R=Ve,Se=Ae;return r(),_("div",Ze,[t("div",et,[t("div",tt,[t("h1",null,"ðŸ‘‹ æ¬¢è¿Žï¼Œ"+i(m(D).username)+"ï¼",1),t("p",null,"ä»Šå¤©æ˜¯ "+i(_e(new Date))+"ï¼Œ"+i(pe()),1)]),t("div",st,[o(n,{type:"success",size:"large"},{default:l(()=>[p(i(X.value),1)]),_:1}),t("div",at,[o(c,{type:"info",size:"small"},{default:l(()=>[p(" æ•°æ®æ›´æ–°: "+i(ae.value),1)]),_:1})])])]),ze((r(),se(h,{class:"schedule-overview"},{header:l(()=>[t("div",ot,[e[6]||(e[6]=t("div",{class:"header-content"},[t("h2",null,"ðŸ“… å€¼ç­è¡¨"),t("p",null,"æŸ¥çœ‹å®Œæ•´çš„æŽ’ç­å®‰æŽ’ï¼Œæ‚¨çš„æŽ’ç­ä¼šç‰¹åˆ«æ ‡æ³¨")],-1)),t("div",lt,[o(b,{size:"small",onClick:ye},{default:l(()=>[o(d,null,{default:l(()=>[o(m(Be))]),_:1}),e[4]||(e[4]=p(" ä¸Šå‘¨ ",-1))]),_:1,__:[4]}),t("div",nt,[t("div",it,i(K.value),1),t("div",ct,[o(n,{type:"primary",size:"small"},{default:l(()=>[p("ç¬¬"+i(j.value)+"å‘¨",1)]),_:1})])]),o(b,{size:"small",onClick:ge},{default:l(()=>[e[5]||(e[5]=p(" ä¸‹å‘¨ ",-1)),o(d,null,{default:l(()=>[o(m(Le))]),_:1})]),_:1,__:[5]})])])]),default:l(()=>[t("div",dt,[t("div",rt,[e[7]||(e[7]=t("div",{class:"time-cell"},"æ—¶é—´æ®µ",-1)),(r(!0),_(C,null,x(P.value,a=>(r(),_("div",{key:a.date,class:J(["day-cell",{today:le(a.date)}])},[t("div",ut,i(a.name),1),t("div",_t,i(F(a.date)),1)],2))),128))]),(r(!0),_(C,null,x(S.value,a=>(r(),_("div",{key:a.id,class:"time-row"},[t("div",vt,[t("div",mt,i(a.name),1),t("div",pt,i(a.startTime)+" - "+i(a.endTime),1),t("div",ht,"éœ€è¦"+i(a.requiredPeople)+"äºº",1)]),(r(!0),_(C,null,x(P.value,u=>(r(),_("div",{key:`${a.id}-${u.date}`,class:"schedule-cell"},[t("div",ft,[(r(!0),_(C,null,x(Q(a.id,u.date),v=>{var E,$,O,q,V,A,B;return r(),_("div",{key:v.id,class:J(["scheduled-employee",{"my-schedule":((E=v.employee)==null?void 0:E.id)===(($=m(D).userInfo)==null?void 0:$.id),"other-schedule":((O=v.employee)==null?void 0:O.id)!==((q=m(D).userInfo)==null?void 0:q.id)}]),onClick:Te=>ne(v)},[t("div",gt,[t("span",wt,i((V=v.employee)==null?void 0:V.name),1),((A=v.employee)==null?void 0:A.id)===((B=m(D).userInfo)==null?void 0:B.id)?(r(),_("span",Dt,"æˆ‘")):I("",!0)])],10,yt)}),128)),z(a.id,u.date)>0?(r(),_("div",kt,[o(d,null,{default:l(()=>[o(m(de))]),_:1}),t("span",null,"è¿˜éœ€"+i(z(a.id,u.date))+"äºº",1)])):I("",!0)])]))),128))]))),128))]),t("div",St,[(r(!0),_(C,null,x(P.value,a=>(r(),_("div",{key:a.date,class:"day-schedule"},[t("div",{class:J(["day-header",{today:le(a.date)}])},[t("div",Tt,[t("span",bt,i(a.name),1),t("span",Ct,i(F(a.date)),1)]),t("div",xt,[t("div",It,"æˆ‘çš„: "+i(fe(a.date).length),1),t("div",Wt,"æ€»è®¡: "+i(he(a.date).length),1)])],2),t("div",Et,[(r(!0),_(C,null,x(S.value,u=>(r(),_("div",{key:u.id,class:"time-slot-card"},[t("div",Mt,[t("div",Nt,[t("div",Pt,i(u.name),1),t("div",zt,i(u.startTime)+" - "+i(u.endTime),1)]),t("div",Rt,[o(n,{type:z(u.id,a.date)===0?"success":"warning",size:"small"},{default:l(()=>[p(i(Q(u.id,a.date).length)+"/"+i(u.requiredPeople),1)]),_:2},1032,["type"])])]),t("div",$t,[(r(!0),_(C,null,x(Q(u.id,a.date),v=>{var E,$,O,q,V,A,B;return r(),_("div",{key:v.id,class:J(["employee-chip",{"my-chip":((E=v.employee)==null?void 0:E.id)===(($=m(D).userInfo)==null?void 0:$.id),"other-chip":((O=v.employee)==null?void 0:O.id)!==((q=m(D).userInfo)==null?void 0:q.id)}]),onClick:Te=>ne(v)},[p(i((V=v.employee)==null?void 0:V.name)+" ",1),((A=v.employee)==null?void 0:A.id)===((B=m(D).userInfo)==null?void 0:B.id)?(r(),_("span",qt,"æˆ‘")):I("",!0)],10,Ot)}),128)),z(u.id,a.date)>0?(r(),_("div",Vt,[o(d,null,{default:l(()=>[o(m(de))]),_:1}),t("span",null,"+"+i(z(u.id,a.date)),1)])):I("",!0)])]))),128))])]))),128))]),t("div",At,[o(G,{gutter:16},{default:l(()=>[o(g,{xs:12,sm:6,span:6},{default:l(()=>[t("div",Bt,[e[8]||(e[8]=t("span",{class:"label"},"æ€»ç­æ¬¡",-1)),t("span",Lt,i(L.value.total),1)])]),_:1}),o(g,{xs:12,sm:6,span:6},{default:l(()=>[t("div",Ft,[e[9]||(e[9]=t("span",{class:"label"},"å·²å®‰æŽ’",-1)),t("span",Ut,i(L.value.assigned),1)])]),_:1}),o(g,{xs:12,sm:6,span:6},{default:l(()=>[t("div",Ht,[e[10]||(e[10]=t("span",{class:"label"},"æˆ‘çš„ç­æ¬¡",-1)),t("span",Qt,i(L.value.myShifts),1)])]),_:1}),o(g,{xs:12,sm:6,span:6},{default:l(()=>[t("div",Gt,[e[11]||(e[11]=t("span",{class:"label"},"å®ŒæˆçŽ‡",-1)),t("span",Jt,i(L.value.completionRate)+"%",1)])]),_:1})]),_:1})])]),_:1})),[[Se,Y.value]]),t("div",Yt,[o(G,{gutter:20},{default:l(()=>[o(g,{xs:12,sm:6,span:6},{default:l(()=>[o(h,{class:"action-card",onClick:e[0]||(e[0]=a=>s.$router.push("/employee/shift-requests")),shadow:"hover"},{default:l(()=>[t("div",jt,[t("div",Kt,[o(d,null,{default:l(()=>[o(m(Fe))]),_:1})]),e[12]||(e[12]=t("div",{class:"action-info"},[t("div",{class:"action-title"},"ç”³è¯·è°ƒç­"),t("div",{class:"action-desc"},"æäº¤è°ƒç­ç”³è¯·")],-1))])]),_:1})]),_:1}),o(g,{xs:12,sm:6,span:6},{default:l(()=>[o(h,{class:"action-card",onClick:e[1]||(e[1]=a=>s.$router.push("/employee/availability")),shadow:"hover"},{default:l(()=>[t("div",Xt,[t("div",Zt,[o(d,null,{default:l(()=>[o(m(Ue))]),_:1})]),e[13]||(e[13]=t("div",{class:"action-info"},[t("div",{class:"action-title"},"ç©ºé—²æ—¶é—´"),t("div",{class:"action-desc"},"ç®¡ç†æˆ‘çš„ç©ºé—²æ—¶é—´")],-1))])]),_:1})]),_:1}),o(g,{xs:12,sm:6,span:6},{default:l(()=>[o(h,{class:"action-card",onClick:De,shadow:"hover"},{default:l(()=>[t("div",es,[t("div",ts,[o(d,null,{default:l(()=>[o(m(He))]),_:1})]),e[14]||(e[14]=t("div",{class:"action-info"},[t("div",{class:"action-title"},"å¯¼å‡ºæˆ‘çš„æŽ’ç­"),t("div",{class:"action-desc"},"ä¸‹è½½ä¸ªäººæŽ’ç­è¡¨")],-1))])]),_:1})]),_:1}),o(g,{xs:12,sm:6,span:6},{default:l(()=>[o(h,{class:"action-card",onClick:ke,shadow:"hover"},{default:l(()=>[t("div",ss,[t("div",as,[o(d,null,{default:l(()=>[o(m(Qe))]),_:1})]),e[15]||(e[15]=t("div",{class:"action-info"},[t("div",{class:"action-title"},"åˆ·æ–°æ•°æ®"),t("div",{class:"action-desc"},"æ›´æ–°æœ€æ–°ä¿¡æ¯")],-1))])]),_:1})]),_:1})]),_:1})]),o(R,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=a=>N.value=a),title:"æŽ’ç­è¯¦æƒ…",width:"500px"},{footer:l(()=>{var a,u,v;return[o(b,{onClick:e[2]||(e[2]=E=>N.value=!1)},{default:l(()=>e[16]||(e[16]=[p("å…³é—­",-1)])),_:1,__:[16]}),((u=(a=y.value)==null?void 0:a.employee)==null?void 0:u.id)===((v=m(D).userInfo)==null?void 0:v.id)?(r(),se(b,{key:0,type:"primary",onClick:we},{default:l(()=>e[17]||(e[17]=[p(" ç”³è¯·è°ƒç­ ",-1)])),_:1,__:[17]})):I("",!0)]}),default:l(()=>[y.value?(r(),_("div",os,[o(W,{column:2,border:""},{default:l(()=>[o(w,{label:"å‘˜å·¥å§“å"},{default:l(()=>{var a;return[p(i((a=y.value.employee)==null?void 0:a.name),1)]}),_:1}),o(w,{label:"è§’è‰²"},{default:l(()=>{var a;return[p(i(((a=y.value.employee)==null?void 0:a.role)==="admin"?"ç®¡ç†å‘˜":"å‘˜å·¥"),1)]}),_:1}),o(w,{label:"æŽ’ç­æ—¥æœŸ"},{default:l(()=>[p(i(y.value.schedule_date),1)]),_:1}),o(w,{label:"æ—¶é—´æ®µ"},{default:l(()=>{var a;return[p(i((a=y.value.timeSlot)==null?void 0:a.name),1)]}),_:1}),o(w,{label:"å·¥ä½œæ—¶é—´",span:2},{default:l(()=>{var a,u;return[p(i((a=y.value.timeSlot)==null?void 0:a.startTime)+" - "+i((u=y.value.timeSlot)==null?void 0:u.endTime),1)]}),_:1}),y.value.notes?(r(),se(w,{key:0,label:"å¤‡æ³¨",span:2},{default:l(()=>[p(i(y.value.notes),1)]),_:1})):I("",!0)]),_:1})])):I("",!0)]),_:1},8,["modelValue"])])}}},ws=We(ls,[["__scopeId","data-v-332369d1"]]);export{ws as default};
