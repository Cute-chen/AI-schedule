import{b as h,e as pe}from"./index-bcd0f302.js";/* empty css                  *//* empty css                   *//* empty css                 *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                *//* empty css               *//* empty css                *//* empty css                     */import{_ as ce}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                       */import{G as me,as as _e,h as ge,at as fe,E as p,k as M,a4 as ve,a5 as ye,X as be,ap as Te,p as ke,_ as he,c as Ee,a2 as xe,O as Se,P as we,aj as Ce,M as Ve,aq as ze,ak as De,au as Re,Q as je,R as qe,W as Ie,S as Be,T as Ue}from"./elementPlus-9365ac08.js";import{r as z,X as B,k as Ae,y as d,z as c,A as n,Q as t,I as a,P as Me,a4 as $e,M as i,O as r,u as U,J as Pe,H as E,L as D}from"./vendor-b2a91a46.js";import"./utils-88d415ea.js";const Fe={class:"shift-requests-container"},Ne={class:"filter-bar"},Oe={class:"stats-cards"},Le={class:"stats-content"},Ye={class:"stats-number"},He={class:"stats-content"},Qe={class:"stats-number"},Xe={class:"stats-content"},Ge={class:"stats-number"},Je={class:"stats-content"},We={class:"stats-number"},Ke={key:0},Ze={key:1,class:"text-gray"},et={key:0},tt={key:1},at={key:0},lt={key:1},st={key:0,class:"request-detail"},ot={class:"text-gray"},nt={key:0},rt={key:1},it={key:0},dt={key:1},ut={key:0,class:"action-section"},pt={__name:"index",setup(ct){const A=z(!1),$=z([]),x=z([]),S=z(!1),o=z(null),v=B({status:"",employeeId:"",dateRange:[]}),k=B({note:""}),_=B({current:1,size:10,total:0}),C=B({pending:0,approved:0,rejected:0,total:0}),P=s=>({leave:"请假",swap:"调班",overtime:"加班",change:"换班",cancel:"放弃值班"})[s]||s,F=s=>({leave:"warning",swap:"success",overtime:"danger",change:"info",cancel:"danger"})[s]||"",N=s=>({pending:"待审核",approved:"已批准",rejected:"已拒绝"})[s]||s,O=s=>({pending:"warning",approved:"success",rejected:"danger"})[s]||"",f=async()=>{var s,e;A.value=!0;try{const g=await h.getShiftRequests({page:_.current,size:_.size,...v});$.value=((s=g.data)==null?void 0:s.data)||[],_.total=((e=g.data)==null?void 0:e.total)||0}catch{p.error("获取班次请求列表失败")}finally{A.value=!1}},w=async()=>{try{const s=await h.getStats();Object.assign(C,s.data||{})}catch{}},H=async()=>{try{console.log("开始获取员工列表...");const s=await pe.getEmployees({size:1e3});console.log("员工API响应:",s),s.success&&s.data?(x.value=Array.isArray(s.data)?s.data:[],console.log("管理员视图员工列表加载成功:",x.value.length,"个员工")):(console.error("获取员工列表失败 - 接口返回:",s),x.value=[],p.error(s.message||"获取员工列表失败")),x.value.length===0&&console.warn("员工列表为空，请检查后端数据")}catch(s){console.error("获取员工列表失败 - 网络错误:",s),x.value=[],p.error("获取员工列表失败: "+(s.message||"网络错误"))}},Q=()=>{_.current=1,f()},X=()=>{Object.assign(v,{status:"",employeeId:"",dateRange:[]}),_.current=1,f()},G=s=>{o.value=s,k.note="",S.value=!0},J=async s=>{try{await M.confirm("确定要批准该请求吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.approveRequest(s.id,{note:"批准"}),p.success("批准成功"),f(),w()}catch(e){e!=="cancel"&&p.error("批准失败")}},W=async s=>{try{const{value:e}=await M.prompt("请输入拒绝原因","拒绝请求",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入拒绝原因"});await h.rejectRequest(s.id,{note:e}),p.success("已拒绝请求"),f(),w()}catch(e){e!=="cancel"&&p.error("操作失败")}},K=async()=>{try{await h.approveRequest(o.value.id,{note:k.note}),p.success("批准成功"),S.value=!1,f(),w()}catch{p.error("批准失败")}},Z=async()=>{try{if(!k.note.trim()){p.warning("请输入拒绝原因");return}await h.rejectRequest(o.value.id,{note:k.note}),p.success("已拒绝请求"),S.value=!1,f(),w()}catch{p.error("操作失败")}},ee=async s=>{var e,g;try{const b={pending:"待审核",approved:"已批准",rejected:"已拒绝",cancelled:"已撤销"},T=s.status==="approved"?`确定要删除编号 ${s.id} 的调班申请吗？
注意：该申请已经批准并生效，删除后将无法恢复！`:`确定要删除编号 ${s.id} 的${b[s.status]||""}调班申请吗？删除后将无法恢复。`;await M.confirm(T,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger",dangerouslyUseHTMLString:!1}),await h.deleteRequest(s.id),p.success("删除成功"),f(),w()}catch(b){b!=="cancel"&&p.error("删除失败: "+(((g=(e=b.response)==null?void 0:e.data)==null?void 0:g.message)||b.message))}},te=s=>{_.size=s,f()},ae=s=>{_.current=s,f()};return Ae(()=>{f(),H(),w()}),(s,e)=>{const g=ve,b=ye,T=be,le=Te,y=ke,L=he,R=Ee,j=xe,q=Se,se=we,m=Ce,I=Ve,Y=ze,oe=De,ne=Re,u=je,re=qe,ie=Ie,de=Be,ue=Ue;return d(),c("div",Fe,[e[29]||(e[29]=n("div",{class:"page-header"},[n("h1",null,"班次请求管理")],-1)),n("div",Ne,[t(L,{inline:!0,model:v},{default:a(()=>[t(T,{label:"状态"},{default:a(()=>[t(b,{modelValue:v.status,"onUpdate:modelValue":e[0]||(e[0]=l=>v.status=l),placeholder:"请选择状态",clearable:"",style:{width:"140px"}},{default:a(()=>[t(g,{label:"待审核",value:"pending"}),t(g,{label:"已批准",value:"approved"}),t(g,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"申请人"},{default:a(()=>[t(b,{modelValue:v.employeeId,"onUpdate:modelValue":e[1]||(e[1]=l=>v.employeeId=l),placeholder:"请选择员工",clearable:"",style:{width:"160px"}},{default:a(()=>[(d(!0),c(Me,null,$e(x.value,l=>(d(),E(g,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"申请日期"},{default:a(()=>[t(le,{modelValue:v.dateRange,"onUpdate:modelValue":e[2]||(e[2]=l=>v.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(T,null,{default:a(()=>[t(y,{type:"primary",onClick:Q},{default:a(()=>e[9]||(e[9]=[i("搜索",-1)])),_:1,__:[9]}),t(y,{onClick:X},{default:a(()=>e[10]||(e[10]=[i("重置",-1)])),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),n("div",Oe,[t(se,{gutter:20},{default:a(()=>[t(q,{span:6},{default:a(()=>[t(j,{class:"stats-card pending"},{default:a(()=>[n("div",Le,[n("div",Ye,r(C.pending),1),e[11]||(e[11]=n("div",{class:"stats-label"},"待审核",-1))]),t(R,{class:"stats-icon"},{default:a(()=>[t(U(me))]),_:1})]),_:1})]),_:1}),t(q,{span:6},{default:a(()=>[t(j,{class:"stats-card approved"},{default:a(()=>[n("div",He,[n("div",Qe,r(C.approved),1),e[12]||(e[12]=n("div",{class:"stats-label"},"已批准",-1))]),t(R,{class:"stats-icon"},{default:a(()=>[t(U(_e))]),_:1})]),_:1})]),_:1}),t(q,{span:6},{default:a(()=>[t(j,{class:"stats-card rejected"},{default:a(()=>[n("div",Xe,[n("div",Ge,r(C.rejected),1),e[13]||(e[13]=n("div",{class:"stats-label"},"已拒绝",-1))]),t(R,{class:"stats-icon"},{default:a(()=>[t(U(ge))]),_:1})]),_:1})]),_:1}),t(q,{span:6},{default:a(()=>[t(j,{class:"stats-card total"},{default:a(()=>[n("div",Je,[n("div",We,r(C.total),1),e[14]||(e[14]=n("div",{class:"stats-label"},"总计",-1))]),t(R,{class:"stats-icon"},{default:a(()=>[t(U(fe))]),_:1})]),_:1})]),_:1})]),_:1})]),Pe((d(),E(oe,{data:$.value,border:""},{default:a(()=>[t(m,{prop:"id",label:"ID",width:"80"}),t(m,{prop:"employee.name",label:"申请人",width:"100"}),t(m,{label:"调班对象",width:"100"},{default:a(({row:l})=>[l.targetEmployee?(d(),c("span",Ke,r(l.targetEmployee.name),1)):(d(),c("span",Ze,"-"))]),_:1}),t(m,{prop:"type",label:"请求类型",width:"100"},{default:a(({row:l})=>[t(I,{type:F(l.type)},{default:a(()=>[i(r(P(l.type)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"originalDate",label:"原班次日期",width:"120"}),t(m,{label:"原班次时间段",width:"150"},{default:a(({row:l})=>[l.originalTimeSlot?(d(),c("div",et,[i(r(l.originalTimeSlot.name),1),e[15]||(e[15]=n("br",null,null,-1)),n("small",null,r(l.originalTimeSlot.startTime)+" - "+r(l.originalTimeSlot.endTime),1)])):(d(),c("span",tt,"-"))]),_:1}),t(m,{prop:"requestedDate",label:"请求日期",width:"120"}),t(m,{label:"目标时间段",width:"150"},{default:a(({row:l})=>[l.targetTimeSlot?(d(),c("div",at,[i(r(l.targetTimeSlot.name),1),e[16]||(e[16]=n("br",null,null,-1)),n("small",null,r(l.targetTimeSlot.startTime)+" - "+r(l.targetTimeSlot.endTime),1)])):(d(),c("span",lt,"-"))]),_:1}),t(m,{prop:"reason",label:"申请原因","show-overflow-tooltip":""}),t(m,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(I,{type:O(l.status)},{default:a(()=>[i(r(N(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"urgency",label:"紧急程度",width:"120"},{default:a(({row:l})=>[t(Y,{modelValue:l.urgency,"onUpdate:modelValue":V=>l.urgency=V,disabled:"","show-score":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{prop:"createdAt",label:"申请时间",width:"160"}),t(m,{label:"操作",width:"260",fixed:"right"},{default:a(({row:l})=>[t(y,{size:"small",onClick:V=>G(l)},{default:a(()=>e[17]||(e[17]=[i("查看",-1)])),_:2,__:[17]},1032,["onClick"]),l.status==="pending"?(d(),E(y,{key:0,size:"small",type:"success",onClick:V=>J(l)},{default:a(()=>e[18]||(e[18]=[i(" 批准 ",-1)])),_:2,__:[18]},1032,["onClick"])):D("",!0),l.status==="pending"?(d(),E(y,{key:1,size:"small",type:"danger",onClick:V=>W(l)},{default:a(()=>e[19]||(e[19]=[i(" 拒绝 ",-1)])),_:2,__:[19]},1032,["onClick"])):D("",!0),t(y,{size:"small",type:"danger",plain:"",onClick:V=>ee(l)},{default:a(()=>e[20]||(e[20]=[i(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,A.value]]),t(ne,{"current-page":_.current,"onUpdate:currentPage":e[3]||(e[3]=l=>_.current=l),"page-size":_.size,"onUpdate:pageSize":e[4]||(e[4]=l=>_.size=l),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"]),t(de,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=l=>S.value=l),title:"请求详情",width:"700px"},{footer:a(()=>[t(y,{onClick:e[7]||(e[7]=l=>S.value=!1)},{default:a(()=>e[28]||(e[28]=[i("关闭",-1)])),_:1,__:[28]})]),default:a(()=>[o.value?(d(),c("div",st,[t(re,{column:2,border:""},{default:a(()=>[t(u,{label:"请求ID"},{default:a(()=>[i(r(o.value.id),1)]),_:1}),t(u,{label:"申请人"},{default:a(()=>{var l;return[i(r((l=o.value.employee)==null?void 0:l.name),1)]}),_:1}),o.value.targetEmployee?(d(),E(u,{key:0,label:"调班对象"},{default:a(()=>[n("div",null,[n("strong",null,r(o.value.targetEmployee.name),1),e[21]||(e[21]=n("br",null,null,-1)),n("small",ot,r(o.value.targetEmployee.position),1)])]),_:1})):(d(),E(u,{key:1,label:"调班对象"},{default:a(()=>e[22]||(e[22]=[n("span",{class:"text-gray"},"无指定对象",-1)])),_:1,__:[22]})),t(u,{label:"请求类型"},{default:a(()=>[t(I,{type:F(o.value.type)},{default:a(()=>[i(r(P(o.value.type)),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"原班次日期"},{default:a(()=>[i(r(o.value.originalDate),1)]),_:1}),t(u,{label:"原班次时间段"},{default:a(()=>[o.value.originalTimeSlot?(d(),c("div",nt,[i(r(o.value.originalTimeSlot.name),1),e[23]||(e[23]=n("br",null,null,-1)),n("small",null,r(o.value.originalTimeSlot.startTime)+" - "+r(o.value.originalTimeSlot.endTime),1)])):(d(),c("span",rt,"-"))]),_:1}),t(u,{label:"请求日期"},{default:a(()=>[i(r(o.value.requestedDate),1)]),_:1}),t(u,{label:"目标时间段"},{default:a(()=>[o.value.targetTimeSlot?(d(),c("div",it,[i(r(o.value.targetTimeSlot.name),1),e[24]||(e[24]=n("br",null,null,-1)),n("small",null,r(o.value.targetTimeSlot.startTime)+" - "+r(o.value.targetTimeSlot.endTime),1)])):(d(),c("span",dt,"-"))]),_:1}),t(u,{label:"紧急程度"},{default:a(()=>[t(Y,{modelValue:o.value.urgency,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.urgency=l),disabled:"","show-score":""},null,8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(I,{type:O(o.value.status)},{default:a(()=>[i(r(N(o.value.status)),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"申请时间",span:2},{default:a(()=>[i(r(o.value.createdAt),1)]),_:1}),t(u,{label:"申请原因",span:2},{default:a(()=>[i(r(o.value.reason),1)]),_:1}),o.value.responseNote?(d(),E(u,{key:2,label:"审核备注",span:2},{default:a(()=>[i(r(o.value.responseNote),1)]),_:1})):D("",!0)]),_:1}),o.value.status==="pending"?(d(),c("div",ut,[e[27]||(e[27]=n("h3",null,"审核操作",-1)),t(L,{model:k,"label-width":"80px"},{default:a(()=>[t(T,{label:"审核备注"},{default:a(()=>[t(ie,{modelValue:k.note,"onUpdate:modelValue":e[6]||(e[6]=l=>k.note=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),t(T,null,{default:a(()=>[t(y,{type:"success",onClick:K},{default:a(()=>e[25]||(e[25]=[i("批准",-1)])),_:1,__:[25]}),t(y,{type:"danger",onClick:Z},{default:a(()=>e[26]||(e[26]=[i("拒绝",-1)])),_:1,__:[26]})]),_:1})]),_:1},8,["model"])])):D("",!0)])):D("",!0)]),_:1},8,["modelValue"])])}}},It=ce(pt,[["__scopeId","data-v-99d0b050"]]);export{It as default};
