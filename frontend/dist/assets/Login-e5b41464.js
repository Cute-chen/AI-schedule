import{u as E}from"./index-bcd0f302.js";/* empty css                     */import{_ as I}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                *//* empty css                    *//* empty css                 */import{aC as U,r as c,X as F,k as z,y as g,z as _,A as l,Q as s,I as r,M as f,a5 as B}from"./vendor-b2a91a46.js";import{C as q}from"./Captcha-8c4565ef.js";import{E as h,W as A,X as M,Y as N,Z as T,p as K,_ as S}from"./elementPlus-9365ac08.js";import"./utils-88d415ea.js";const X={class:"login-container"},P={class:"login-box"},Q={class:"login-options"},W={key:0},Y={key:1},Z={class:"register-link"},j={__name:"Login",setup(D){const t=U(),n=E(),b=c(),u=c(),m=c(!1),o=F({email:"",password:"",captcha:"",remember:!1}),w={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:4,message:"验证码必须为4位",trigger:"blur"}]},y=async()=>{var d;try{if(await b.value.validate(),!u.value.validate()){h.error("验证码错误，请重新输入"),u.value.refresh(),o.captcha="";return}m.value=!0;const e=await n.login({email:o.email,password:o.password,remember:o.remember});console.log("Login response:",e),console.log("User store after login:",{isAuthenticated:n.isAuthenticated,userInfo:n.userInfo,token:n.token}),h.success("登录成功");const i=(d=n.userInfo)==null?void 0:d.role;console.log("User role for redirect:",i),i==="admin"?(console.log("Redirecting to admin dashboard"),await t.push("/admin/dashboard")):i==="employee"?(console.log("Redirecting to employee dashboard"),await t.push("/employee/dashboard")):(console.log("Redirecting to root path for role determination"),await t.push("/"))}catch(e){console.error("Login failed:",e),h.error(e.message||"登录失败"),u.value.refresh(),o.captcha=""}finally{m.value=!1}},k=d=>{console.log("验证码已刷新:",d)},V=()=>{t.push("/forgot-password")},R=()=>{t.push("/register")};return z(()=>{n.isLoggedIn&&t.push("/")}),(d,e)=>{const i=A,p=M,x=N,v=T,L=K,C=S;return g(),_("div",X,[l("div",P,[e[8]||(e[8]=l("div",{class:"login-header"},[l("h2",{class:"login-title"},"排班管理系统"),l("p",{class:"login-subtitle"},"智能排班，高效管理")],-1)),s(C,{ref_key:"loginFormRef",ref:b,model:o,rules:w,class:"login-form",onKeyup:B(y,["enter"])},{default:r(()=>[s(p,{prop:"email"},{default:r(()=>[s(i,{modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=a=>o.email=a),placeholder:"请输入邮箱","prefix-icon":"User",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),s(p,{prop:"password"},{default:r(()=>[s(i,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=a=>o.password=a),type:"password",placeholder:"请输入密码","prefix-icon":"Lock",size:"large","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),s(p,{prop:"captcha"},{default:r(()=>[s(q,{ref_key:"captchaRef",ref:u,modelValue:o.captcha,"onUpdate:modelValue":e[2]||(e[2]=a=>o.captcha=a),onRefresh:k},null,8,["modelValue"])]),_:1}),s(p,null,{default:r(()=>[l("div",Q,[s(x,{modelValue:o.remember,"onUpdate:modelValue":e[3]||(e[3]=a=>o.remember=a)},{default:r(()=>e[4]||(e[4]=[f("记住我",-1)])),_:1,__:[4]},8,["modelValue"]),s(v,{type:"primary",onClick:V},{default:r(()=>e[5]||(e[5]=[f("忘记密码？",-1)])),_:1,__:[5]})])]),_:1}),s(p,null,{default:r(()=>[s(L,{loading:m.value,type:"primary",size:"large",class:"login-button",onClick:y},{default:r(()=>[m.value?(g(),_("span",Y,"登录中...")):(g(),_("span",W,"登录"))]),_:1},8,["loading"])]),_:1}),l("div",Z,[e[7]||(e[7]=l("span",null,"还没有账户？",-1)),s(v,{type:"primary",onClick:R},{default:r(()=>e[6]||(e[6]=[f("员工自助注册",-1)])),_:1,__:[6]})])]),_:1},8,["model"])])])}}},le=I(j,[["__scopeId","data-v-a9b9e423"]]);export{le as default};
