import{e as L,d as q}from"./index-bcd0f302.js";/* empty css                     *//* empty css                */import{_ as A}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                    *//* empty css                 */import{aC as N,r as f,X as $,y as m,z as _,A as d,Q as l,I as s,H as y,u as h,L as x,O as M,M as b,a5 as T}from"./vendor-b2a91a46.js";import{$ as K,a0 as X,a1 as D,E as p,W as H,X as O,c as Q,Y as S,p as W,Z as Y,_ as Z}from"./elementPlus-9365ac08.js";import{C as j}from"./Captcha-8c4565ef.js";import"./utils-88d415ea.js";const G={class:"register-container"},J={class:"register-box"},ee={key:0,class:"referrer-info"},re={class:"referrer-name"},ae={class:"register-agreement"},le={key:0},se={key:1},oe={class:"login-link"},te={__name:"Register",setup(ne){const V=N(),E=f(),c=f(),g=f(!1),v=f(!1),n=f(null),i=f(null),r=$({name:"",email:"",password:"",confirmPassword:"",phone:"",referrerEmail:"",captcha:"",agreement:!1}),k={name:[{required:!0,message:"请输入您的姓名",trigger:"blur"},{min:2,max:50,message:"姓名长度应在2-50个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请设置密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{validator:(t,e,a)=>{e===""?a(new Error("请确认密码")):e!==r.password?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],referrerEmail:[{validator:(t,e,a)=>{e?n.value===!1?a(new Error("推荐人不存在或无效")):n.value===null?a(new Error("请等待推荐人验证")):a():a(new Error("请输入推荐人邮箱"))},trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:4,message:"验证码必须为4位",trigger:"blur"}],agreement:[{validator:(t,e,a)=>{e?a():a(new Error("请同意公司排班管理规定"))},trigger:"change"}]},C=async()=>{const t=r.referrerEmail.trim();if(!t){n.value=null,i.value=null;return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){n.value=!1,i.value=null;return}if(t===r.email.trim()){p.warning("不能填写自己的邮箱作为推荐人"),n.value=!1,i.value=null;return}try{v.value=!0,n.value=null,i.value=null;const a=await L.validateReferrer({email:t});a.success&&a.data.valid?(n.value=!0,i.value=a.data.employee,p.success(`推荐人验证成功：${a.data.employee.name}`)):(n.value=!1,i.value=null,p.error(a.message||"推荐人不存在或无效"))}catch(a){console.error("验证推荐人失败:",a),n.value=!1,i.value=null,p.error("推荐人验证失败，请重试")}finally{v.value=!1}},R=async()=>{try{if(await E.value.validate(),!c.value.validate()){p.error("验证码错误，请重新输入"),c.value.refresh(),r.captcha="";return}g.value=!0;const t=await q.selfRegister({name:r.name,email:r.email,password:r.password,phone:r.phone,referrerEmail:r.referrerEmail});p.success("注册申请提交成功！请等待管理员审核。"),setTimeout(()=>{V.push("/login")},3e3)}catch(t){console.error("Registration failed:",t),p.error(t.message||"注册失败，请重试"),c.value.refresh(),r.captcha=""}finally{g.value=!1}},U=t=>{console.log("验证码已刷新:",t)},P=()=>{V.push("/login")};return(t,e)=>{const a=H,u=O,w=Q,z=S,I=W,B=Y,F=Z;return m(),_("div",G,[d("div",J,[e[11]||(e[11]=d("div",{class:"register-header"},[d("h2",{class:"register-title"},"员工自助注册"),d("p",{class:"register-subtitle"},"通过同事推荐加入排班系统")],-1)),l(F,{ref_key:"registerFormRef",ref:E,model:r,rules:k,class:"register-form",onKeyup:T(R,["enter"])},{default:s(()=>[l(u,{prop:"name"},{default:s(()=>[l(a,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=o=>r.name=o),placeholder:"请输入您的真实姓名","prefix-icon":"User",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{prop:"email"},{default:s(()=>[l(a,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=o=>r.email=o),type:"email",placeholder:"请输入邮箱地址","prefix-icon":"Message",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{prop:"password"},{default:s(()=>[l(a,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=o=>r.password=o),type:"password",placeholder:"请设置登录密码（至少6位）","prefix-icon":"Lock",size:"large","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{prop:"confirmPassword"},{default:s(()=>[l(a,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=o=>r.confirmPassword=o),type:"password",placeholder:"请确认登录密码","prefix-icon":"Lock",size:"large","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{prop:"phone"},{default:s(()=>[l(a,{modelValue:r.phone,"onUpdate:modelValue":e[4]||(e[4]=o=>r.phone=o),placeholder:"请输入手机号码","prefix-icon":"Phone",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{prop:"referrerEmail"},{default:s(()=>[l(a,{modelValue:r.referrerEmail,"onUpdate:modelValue":e[5]||(e[5]=o=>r.referrerEmail=o),type:"email",placeholder:"请输入推荐人邮箱地址","prefix-icon":"UserFilled",size:"large",clearable:"",onBlur:C},{suffix:s(()=>[v.value?(m(),y(w,{key:0,class:"is-loading"},{default:s(()=>[l(h(K))]),_:1})):n.value===!0?(m(),y(w,{key:1,color:"#67c23a"},{default:s(()=>[l(h(X))]),_:1})):n.value===!1?(m(),y(w,{key:2,color:"#f56c6c"},{default:s(()=>[l(h(D))]),_:1})):x("",!0)]),_:1},8,["modelValue"]),i.value?(m(),_("div",ee,[d("span",re,"推荐人："+M(i.value.name),1)])):x("",!0)]),_:1}),l(u,{prop:"captcha"},{default:s(()=>[l(j,{ref_key:"captchaRef",ref:c,modelValue:r.captcha,"onUpdate:modelValue":e[6]||(e[6]=o=>r.captcha=o),onRefresh:U},null,8,["modelValue"])]),_:1}),l(u,null,{default:s(()=>[d("div",ae,[l(z,{modelValue:r.agreement,"onUpdate:modelValue":e[7]||(e[7]=o=>r.agreement=o)},{default:s(()=>e[8]||(e[8]=[b(" 我已阅读并同意遵守公司排班管理规定 ",-1)])),_:1,__:[8]},8,["modelValue"])])]),_:1}),l(u,null,{default:s(()=>[l(I,{loading:g.value,type:"primary",size:"large",class:"register-button",onClick:R},{default:s(()=>[g.value?(m(),_("span",se,"提交中...")):(m(),_("span",le,"提交注册申请"))]),_:1},8,["loading"])]),_:1}),d("div",oe,[e[10]||(e[10]=d("span",null,"已有账户？",-1)),l(B,{type:"primary",onClick:P},{default:s(()=>e[9]||(e[9]=[b("返回登录",-1)])),_:1,__:[9]})])]),_:1},8,["model"])])])}}},Ve=A(te,[["__scopeId","data-v-1f9c96a9"]]);export{Ve as default};
