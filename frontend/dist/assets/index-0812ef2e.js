import{s as Q,e as Ot,a as Mt}from"./index-bcd0f302.js";/* empty css                  *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                       *//* empty css                        *//* empty css                        *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css                *//* empty css               */import{_ as at}from"./_plugin-vue_export-helper-8da67cfc.js";import{r as D,X as Ae,k as st,S as Ut,y as f,z as S,Q as l,I as a,A as s,u as N,M as c,P as j,a4 as R,H as L,L as M,O as g,J as ot,f as Te,c as G,al as Ce,C as tt,V as Oe}from"./vendor-b2a91a46.js";import{G as zt,ab as Nt,V as jt,U as Rt,E as v,k as le,c as nt,p as rt,X as it,ac as Bt,a7 as dt,a4 as Pt,a5 as Ft,ad as ut,W as ct,Y as qt,_ as pt,ae as Lt,af as Ht,ag as Qt,ah as Gt,M as mt,ai as ft,aj as Jt,ak as Xt,z as Yt,a2 as _t,T as gt,o as Kt,al as Zt,L as el,am as tl,aa as ll,K as Qe,B as al,C as sl,a8 as ol,a6 as nl,S as rl,an as il,r as dl}from"./elementPlus-9365ac08.js";import{s as Ge}from"./settingsService-87306db1.js";/* empty css                  *//* empty css                        *//* empty css                    *//* empty css                    *//* empty css                          *//* empty css                  *//* empty css                 */import{W as lt}from"./WeekRangeSelector-08a2a9b6.js";import"./utils-88d415ea.js";const ul={class:"batch-operation-panel"},cl={class:"panel-header"},pl={class:"operation-tabs"},ml={class:"batch-schedule"},fl={key:0},_l={key:1},gl={key:2},vl={class:"batch-adjust"},yl={class:"type-description"},kl={class:"adjustment-rules"},wl={class:"rule-header"},bl={class:"rule-index"},hl={class:"rule-content"},Sl={class:"from-section"},Wl={class:"arrow-section"},xl={class:"to-section"},Dl={key:0,class:"rule-warning"},Al={key:0,class:"operation-progress"},$l={class:"progress-header"},Vl={class:"progress-details"},Il={key:0},El={key:1,class:"error-message"},Tl={class:"history-list"},Cl={__name:"BatchOperationPanel",props:{employees:{type:Array,default:()=>[]},timeSlots:{type:Array,default:()=>[]},scheduleTemplates:{type:Array,default:()=>[]}},emits:["operationStarted","operationCompleted"],setup(ce,{emit:$e}){const ae=$e,se=D("schedule"),V=D(!1),X=D(!1),P=D(!1),W=D(null),U=D([]),k=Ae({weeks:[],mode:"template",templateId:"",sourceWeek:null,strategy:"fair",requirements:"",overwriteExisting:!1}),x=Ae({weeks:[],type:"single",validationOptions:["checkConflicts","checkAvailability"],adjustments:[{fromEmployee:"",fromTimeSlot:"",toEmployee:"",toTimeSlot:""}]}),pe=p=>{},we=async()=>{if(k.weeks.length===0){v.warning("è¯·é€‰æ‹©ç›®æ ‡å‘¨æœŸ");return}if(k.mode==="template"&&!k.templateId){v.warning("è¯·é€‰æ‹©æ¨¡æ¿");return}if(k.mode==="copy"&&!k.sourceWeek){v.warning("è¯·è¾“å…¥æºå‘¨æ¬¡");return}try{V.value=!0;let p="",i={};k.mode==="template"?(p="/api/schedules/batch-advanced",i={weeks:k.weeks,templateId:k.templateId,overwriteExisting:k.overwriteExisting}):k.mode==="copy"?(p="/api/schedules/copy",i={sourceWeek:k.sourceWeek,targetWeeks:k.weeks,overwrite:k.overwriteExisting}):k.mode==="ai"&&(p="/api/schedules/auto-schedule",i={weeks:k.weeks,strategy:k.strategy,requirements:k.requirements}),W.value={operation_name:"æ‰¹é‡æ’ç­",target_weeks:k.weeks,status:"processing",progress:0},_e(),v.success("æ‰¹é‡æ’ç­å·²å¯åŠ¨"),ae("operationStarted",W.value)}catch{v.error("å¯åŠ¨æ‰¹é‡æ’ç­å¤±è´¥")}finally{V.value=!1}},Y=async()=>{var J,z;if(x.weeks.length===0){v.warning("è¯·é€‰æ‹©ç›®æ ‡å‘¨æœŸ");return}const p=x.adjustments.filter(A=>ne(A));if(p.length===0){v.warning("è¯·é…ç½®è‡³å°‘ä¸€æ¡æœ‰æ•ˆçš„è°ƒç­è§„åˆ™");return}if(x.adjustments.some(A=>!ne(A)&&(A.fromEmployee||A.fromTimeSlot||A.toEmployee||A.toTimeSlot))){v.warning("å­˜åœ¨æ— æ•ˆçš„è°ƒç­è§„åˆ™ï¼Œè¯·æ£€æŸ¥åé‡è¯•");return}try{await le.confirm(`ç¡®å®šè¦å¯¹ ${x.weeks.length} ä¸ªå‘¨æœŸæ‰§è¡Œ ${p.length} æ¡è°ƒç­è§„åˆ™å—ï¼Ÿ

è°ƒç­ç±»å‹ï¼š${H(x.type)}`,"ç¡®è®¤æ‰¹é‡è°ƒç­",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"})}catch{return}try{V.value=!0;const A={weeks:x.weeks,type:x.type,validationOptions:x.validationOptions,adjustments:p.map(C=>({fromEmployee:C.fromEmployee,fromTimeSlot:C.fromTimeSlot,toEmployee:C.toEmployee,toTimeSlot:C.toTimeSlot}))};W.value={operation_name:`æ‰¹é‡è°ƒç­ (${x.type})`,target_weeks:x.weeks,status:"processing",progress:0},_e(),v.success(`æ‰¹é‡è°ƒç­å·²å¯åŠ¨ï¼Œå°†å¤„ç† ${p.length} æ¡è§„åˆ™`),ae("operationStarted",W.value)}catch(A){console.error("æ‰¹é‡è°ƒç­å¤±è´¥:",A),v.error(((z=(J=A.response)==null?void 0:J.data)==null?void 0:z.message)||"å¯åŠ¨æ‰¹é‡è°ƒç­å¤±è´¥")}finally{V.value=!1}},me=()=>{x.adjustments.push({fromEmployee:"",fromTimeSlot:"",toEmployee:"",toTimeSlot:""})},K=p=>{x.adjustments.splice(p,1)},fe=()=>{Object.assign(k,{weeks:[],mode:"template",templateId:"",sourceWeek:null,strategy:"fair",requirements:"",overwriteExisting:!1})},oe=()=>{Object.assign(x,{weeks:[],type:"single",validationOptions:["checkConflicts","checkAvailability"],adjustments:[{fromEmployee:"",fromTimeSlot:"",toEmployee:"",toTimeSlot:""}]})},H=p=>({single:"å•æ¬¡è°ƒç­ï¼šå°†æŒ‡å®šå‘˜å·¥ä»ä¸€ä¸ªæ—¶é—´æ®µè°ƒæ•´åˆ°å¦ä¸€ä¸ªæ—¶é—´æ®µ",swap:"å‘˜å·¥äº’æ¢ï¼šä¸¤ä¸ªå‘˜å·¥ä¹‹é—´äº¤æ¢æ—¶é—´æ®µ",replace:"æ‰¹é‡æ›¿æ¢ï¼šå°†æŸä¸ªå‘˜å·¥åœ¨æŒ‡å®šæ—¶é—´æ®µçš„æ‰€æœ‰ç­æ¬¡æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå‘˜å·¥",pattern:"æ¨¡å¼è°ƒæ•´ï¼šæ ¹æ®é¢„è®¾æ¨¡å¼æ‰¹é‡è°ƒæ•´å¤šä¸ªå‘˜å·¥çš„ç­æ¬¡"})[p]||"",ne=p=>p.fromEmployee||p.fromTimeSlot,Ve=p=>!p.fromEmployee&&!p.fromTimeSlot?"è¯·è‡³å°‘é€‰æ‹©æºå‘˜å·¥æˆ–æºæ—¶é—´æ®µ":p.fromEmployee===p.toEmployee&&p.fromTimeSlot===p.toTimeSlot?"æºå’Œç›®æ ‡ä¸èƒ½ç›¸åŒ":x.type==="swap"&&(!p.toEmployee||!p.toTimeSlot)?"äº’æ¢æ¨¡å¼éœ€è¦æŒ‡å®šå®Œæ•´çš„ç›®æ ‡å‘˜å·¥å’Œæ—¶é—´æ®µ":"",_e=()=>{let p=0;const i=setInterval(()=>{p+=Math.random()*20,p>=100?(p=100,W.value.status="completed",W.value.progress=100,W.value.result_summary={total:56,created:52,skipped:4},clearInterval(i),ae("operationCompleted",W.value)):W.value.progress=Math.round(p)},500)},be=async()=>{try{P.value=!0,U.value=[]}catch{v.error("è·å–æ“ä½œå†å²å¤±è´¥")}finally{P.value=!1}},he=p=>{le.alert(JSON.stringify(p,null,2),"æ“ä½œè¯¦æƒ…",{customClass:"operation-details-dialog"})},ge=p=>({pending:"info",processing:"warning",completed:"success",failed:"danger"})[p]||"info",I=p=>({pending:"ç­‰å¾…ä¸­",processing:"å¤„ç†ä¸­",completed:"å·²å®Œæˆ",failed:"å·²å¤±è´¥"})[p]||p,b=p=>p?`æ€»è®¡: ${p.total}, æˆåŠŸ: ${p.created||p.success}, è·³è¿‡: ${p.skipped||p.failed}`:"",h=p=>new Date(p).toLocaleString("zh-CN");return st(()=>{be()}),Ut(()=>{}),(p,i)=>{const J=nt,z=rt,A=it,C=Bt,re=dt,F=Pt,q=Ft,Me=ut,Ue=ct,Z=qt,ie=pt,ve=Lt,ee=Ht,ze=Qt,Se=Gt,de=mt,Ie=ft,te=Jt,Ne=Xt,je=Yt,Re=_t,Be=gt;return f(),S("div",ul,[l(Re,null,{header:a(()=>[s("div",cl,[i[14]||(i[14]=s("span",null,"æ‰¹é‡æ“ä½œ",-1)),l(z,{size:"small",onClick:i[0]||(i[0]=m=>X.value=!X.value)},{default:a(()=>[l(J,null,{default:a(()=>[l(N(zt))]),_:1}),i[13]||(i[13]=c(" æ“ä½œå†å² ",-1))]),_:1,__:[13]})])]),default:a(()=>[s("div",pl,[l(ze,{modelValue:se.value,"onUpdate:modelValue":i[11]||(i[11]=m=>se.value=m),onTabClick:pe},{default:a(()=>[l(ve,{label:"æ‰¹é‡æ’ç­",name:"schedule"},{default:a(()=>[s("div",ml,[l(ie,{model:k,"label-width":"100px"},{default:a(()=>[l(A,{label:"ç›®æ ‡å‘¨æœŸ"},{default:a(()=>[l(lt,{modelValue:k.weeks,"onUpdate:modelValue":i[1]||(i[1]=m=>k.weeks=m),title:"é€‰æ‹©è¦æ’ç­çš„å‘¨æœŸ"},null,8,["modelValue"])]),_:1}),l(A,{label:"æ’ç­æ¨¡å¼"},{default:a(()=>[l(re,{modelValue:k.mode,"onUpdate:modelValue":i[2]||(i[2]=m=>k.mode=m)},{default:a(()=>[l(C,{label:"template"},{default:a(()=>i[15]||(i[15]=[c("ä½¿ç”¨æ¨¡æ¿",-1)])),_:1,__:[15]}),l(C,{label:"copy"},{default:a(()=>i[16]||(i[16]=[c("å¤åˆ¶ç°æœ‰æ’ç­",-1)])),_:1,__:[16]}),l(C,{label:"ai"},{default:a(()=>i[17]||(i[17]=[c("AIæ™ºèƒ½æ’ç­",-1)])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1}),k.mode==="template"?(f(),S("div",fl,[l(A,{label:"é€‰æ‹©æ¨¡æ¿"},{default:a(()=>[l(q,{modelValue:k.templateId,"onUpdate:modelValue":i[3]||(i[3]=m=>k.templateId=m),placeholder:"é€‰æ‹©æ’ç­æ¨¡æ¿"},{default:a(()=>[(f(!0),S(j,null,R(ce.scheduleTemplates,m=>(f(),L(F,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):M("",!0),k.mode==="copy"?(f(),S("div",_l,[l(A,{label:"æºå‘¨æ¬¡"},{default:a(()=>[l(Me,{modelValue:k.sourceWeek,"onUpdate:modelValue":i[4]||(i[4]=m=>k.sourceWeek=m),min:1,max:52,placeholder:"è¦å¤åˆ¶çš„å‘¨æ¬¡"},null,8,["modelValue"])]),_:1})])):M("",!0),k.mode==="ai"?(f(),S("div",gl,[l(A,{label:"æ’ç­ç­–ç•¥"},{default:a(()=>[l(q,{modelValue:k.strategy,"onUpdate:modelValue":i[5]||(i[5]=m=>k.strategy=m)},{default:a(()=>[l(F,{label:"å…¬å¹³åˆ†é…",value:"fair"}),l(F,{label:"ä¼˜å…ˆçº§ä¼˜å…ˆ",value:"priority"}),l(F,{label:"ç»éªŒä¼˜åŒ–",value:"experience"})]),_:1},8,["modelValue"])]),_:1}),l(A,{label:"ç‰¹æ®Šè¦æ±‚"},{default:a(()=>[l(Ue,{modelValue:k.requirements,"onUpdate:modelValue":i[6]||(i[6]=m=>k.requirements=m),type:"textarea",rows:3,placeholder:"å¯é€‰ï¼šæè¿°ç‰¹æ®Šæ’ç­è¦æ±‚"},null,8,["modelValue"])]),_:1})])):M("",!0),l(A,{label:"è¦†ç›–è®¾ç½®"},{default:a(()=>[l(Z,{modelValue:k.overwriteExisting,"onUpdate:modelValue":i[7]||(i[7]=m=>k.overwriteExisting=m)},{default:a(()=>i[18]||(i[18]=[c(" è¦†ç›–å·²å­˜åœ¨çš„æ’ç­ ",-1)])),_:1,__:[18]},8,["modelValue"])]),_:1}),l(A,null,{default:a(()=>[l(z,{type:"primary",onClick:we,loading:V.value},{default:a(()=>i[19]||(i[19]=[c(" å¼€å§‹æ‰¹é‡æ’ç­ ",-1)])),_:1,__:[19]},8,["loading"]),l(z,{onClick:fe},{default:a(()=>i[20]||(i[20]=[c("é‡ç½®",-1)])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])])]),_:1}),l(ve,{label:"æ‰¹é‡è°ƒç­",name:"adjust"},{default:a(()=>[s("div",vl,[l(ie,{model:x,"label-width":"100px"},{default:a(()=>[l(A,{label:"ç›®æ ‡å‘¨æœŸ"},{default:a(()=>[l(lt,{modelValue:x.weeks,"onUpdate:modelValue":i[8]||(i[8]=m=>x.weeks=m),title:"é€‰æ‹©è¦è°ƒç­çš„å‘¨æœŸ"},null,8,["modelValue"])]),_:1}),l(A,{label:"è°ƒç­ç±»å‹"},{default:a(()=>[l(re,{modelValue:x.type,"onUpdate:modelValue":i[9]||(i[9]=m=>x.type=m)},{default:a(()=>[l(C,{label:"single"},{default:a(()=>i[21]||(i[21]=[c("å•æ¬¡è°ƒç­",-1)])),_:1,__:[21]}),l(C,{label:"swap"},{default:a(()=>i[22]||(i[22]=[c("å‘˜å·¥äº’æ¢",-1)])),_:1,__:[22]}),l(C,{label:"replace"},{default:a(()=>i[23]||(i[23]=[c("æ‰¹é‡æ›¿æ¢",-1)])),_:1,__:[23]}),l(C,{label:"pattern"},{default:a(()=>i[24]||(i[24]=[c("æ¨¡å¼è°ƒæ•´",-1)])),_:1,__:[24]})]),_:1},8,["modelValue"]),s("div",yl,g(H(x.type)),1)]),_:1}),l(A,{label:"è°ƒç­è§„åˆ™"},{default:a(()=>[s("div",kl,[(f(!0),S(j,null,R(x.adjustments,(m,ye)=>(f(),S("div",{key:ye,class:"rule-item"},[s("div",wl,[s("span",bl,"è§„åˆ™ "+g(ye+1),1),l(z,{size:"small",type:"danger",text:"",onClick:$=>K(ye),disabled:x.adjustments.length<=1},{default:a(()=>i[25]||(i[25]=[c(" åˆ é™¤ ",-1)])),_:2,__:[25]},1032,["onClick","disabled"])]),s("div",hl,[s("div",Sl,[i[26]||(i[26]=s("label",null,"è°ƒå‡º:",-1)),l(q,{modelValue:m.fromEmployee,"onUpdate:modelValue":$=>m.fromEmployee=$,placeholder:"é€‰æ‹©å‘˜å·¥",clearable:""},{default:a(()=>[(f(!0),S(j,null,R(ce.employees,$=>(f(),L(F,{key:$.id,label:$.name,value:$.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),i[27]||(i[27]=s("span",{class:"connector"},"åœ¨",-1)),l(q,{modelValue:m.fromTimeSlot,"onUpdate:modelValue":$=>m.fromTimeSlot=$,placeholder:"é€‰æ‹©æ—¶é—´æ®µ",clearable:""},{default:a(()=>[(f(!0),S(j,null,R(ce.timeSlots,$=>(f(),L(F,{key:$.id,label:$.name,value:$.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),s("div",Wl,[l(J,{class:"arrow-icon"},{default:a(()=>[l(N(Nt))]),_:1})]),s("div",xl,[i[28]||(i[28]=s("label",null,"è°ƒå…¥:",-1)),l(q,{modelValue:m.toEmployee,"onUpdate:modelValue":$=>m.toEmployee=$,placeholder:"é€‰æ‹©å‘˜å·¥",clearable:""},{default:a(()=>[(f(!0),S(j,null,R(ce.employees,$=>(f(),L(F,{key:$.id,label:$.name,value:$.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),i[29]||(i[29]=s("span",{class:"connector"},"åœ¨",-1)),l(q,{modelValue:m.toTimeSlot,"onUpdate:modelValue":$=>m.toTimeSlot=$,placeholder:"é€‰æ‹©æ—¶é—´æ®µ",clearable:""},{default:a(()=>[(f(!0),S(j,null,R(ce.timeSlots,$=>(f(),L(F,{key:$.id,label:$.name,value:$.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),ne(m)?M("",!0):(f(),S("div",Dl,[l(J,null,{default:a(()=>[l(N(jt))]),_:1}),s("span",null,g(Ve(m)),1)]))]))),128)),l(z,{size:"small",type:"primary",onClick:me},{default:a(()=>[l(J,null,{default:a(()=>[l(N(Rt))]),_:1}),i[30]||(i[30]=c(" æ·»åŠ è°ƒç­è§„åˆ™ ",-1))]),_:1,__:[30]})])]),_:1}),l(A,{label:"éªŒè¯é€‰é¡¹"},{default:a(()=>[l(ee,{modelValue:x.validationOptions,"onUpdate:modelValue":i[10]||(i[10]=m=>x.validationOptions=m)},{default:a(()=>[l(Z,{label:"checkConflicts"},{default:a(()=>i[31]||(i[31]=[c("æ£€æŸ¥æ—¶é—´å†²çª",-1)])),_:1,__:[31]}),l(Z,{label:"checkAvailability"},{default:a(()=>i[32]||(i[32]=[c("æ£€æŸ¥å‘˜å·¥ç©ºé—²æ—¶é—´",-1)])),_:1,__:[32]}),l(Z,{label:"allowOverride"},{default:a(()=>i[33]||(i[33]=[c("å…è®¸å¼ºåˆ¶è°ƒç­",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1}),l(A,null,{default:a(()=>[l(z,{type:"primary",onClick:Y,loading:V.value},{default:a(()=>i[34]||(i[34]=[c(" å¼€å§‹æ‰¹é‡è°ƒç­ ",-1)])),_:1,__:[34]},8,["loading"]),l(z,{onClick:oe},{default:a(()=>i[35]||(i[35]=[c("é‡ç½®",-1)])),_:1,__:[35]})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])]),W.value?(f(),S("div",Al,[l(Se),s("div",$l,[s("h4",null,g(W.value.operation_name),1),l(de,{type:ge(W.value.status)},{default:a(()=>[c(g(I(W.value.status)),1)]),_:1},8,["type"])]),l(Ie,{percentage:W.value.progress,status:W.value.status==="failed"?"exception":void 0},null,8,["percentage","status"]),s("div",Vl,[s("p",null,"ç›®æ ‡å‘¨æœŸ: "+g(W.value.target_weeks.join(", ")),1),W.value.result_summary?(f(),S("p",Il," ç»“æœ: "+g(b(W.value.result_summary)),1)):M("",!0),W.value.error_message?(f(),S("p",El," é”™è¯¯: "+g(W.value.error_message),1)):M("",!0)])])):M("",!0),l(je,{modelValue:X.value,"onUpdate:modelValue":i[12]||(i[12]=m=>X.value=m),title:"æ‰¹é‡æ“ä½œå†å²",size:"60%"},{default:a(()=>[s("div",Tl,[ot((f(),L(Ne,{data:U.value},{default:a(()=>[l(te,{prop:"operation_name",label:"æ“ä½œåç§°"}),l(te,{prop:"target_weeks",label:"ç›®æ ‡å‘¨æœŸ",width:"200"},{default:a(({row:m})=>[c(g(m.target_weeks.join(", ")),1)]),_:1}),l(te,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:a(({row:m})=>[l(de,{type:ge(m.status),size:"small"},{default:a(()=>[c(g(I(m.status)),1)]),_:2},1032,["type"])]),_:1}),l(te,{prop:"progress",label:"è¿›åº¦",width:"120"},{default:a(({row:m})=>[l(Ie,{percentage:m.progress,"show-text":!1},null,8,["percentage"])]),_:1}),l(te,{prop:"created_at",label:"åˆ›å»ºæ—¶é—´",width:"180"},{default:a(({row:m})=>[c(g(h(m.created_at)),1)]),_:1}),l(te,{label:"æ“ä½œ",width:"100"},{default:a(({row:m})=>[l(z,{size:"small",onClick:ye=>he(m)},{default:a(()=>i[36]||(i[36]=[c("æŸ¥çœ‹",-1)])),_:2,__:[36]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Be,P.value]])])]),_:1},8,["modelValue"])]),_:1})])}}},Ol=at(Cl,[["__scopeId","data-v-79d5adfb"]]);const Ml={class:"schedules-container"},Ul={class:"page-header"},zl={class:"header-actions"},Nl={class:"week-nav"},jl={class:"current-week"},Rl={class:"week-stats"},Bl={class:"calendar-header-controls"},Pl={class:"controls"},Fl={class:"calendar-grid"},ql={class:"calendar-header"},Ll={class:"day-name"},Hl={class:"day-date"},Ql={class:"time-cell"},Gl={class:"time-name"},Jl={class:"time-period"},Xl={class:"required-people"},Yl=["onDrop"],Kl={class:"schedule-content"},Zl=["onDragstart","onClick"],ea={class:"employee-info"},ta={class:"employee-name"},la={class:"schedule-meta"},aa={key:1,class:"confidence"},sa={class:"schedule-actions"},oa=["onClick"],na={key:1,class:"overstaff-warning"},ra={class:"ai-dialog-content"},ia={class:"week-display-info",style:{"margin-top":"8px",padding:"8px",background:"#f5f7fa","border-radius":"4px","font-size":"13px"}},da={style:{color:"#303133","font-weight":"500"}},ua={style:{color:"#666"}},ca={class:"strategy-desc"},pa={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ma={class:"employee-picker"},fa={class:"available-employees"},_a={class:"employee-list"},ga=["onClick"],va={class:"employee-details"},ya={class:"name"},ka={class:"priority"},wa={key:0,class:"reason-content"},ba={class:"confidence-score"},ha={class:"sync-dialog-content"},Sa={class:"source-week-preview",style:{"margin-bottom":"20px"}},Wa={style:{"max-height":"200px","overflow-y":"auto",border:"1px solid #ddd","border-radius":"4px",padding:"10px"}},xa={key:0,style:{color:"#999","text-align":"center",padding:"20px"}},Da={key:1},Aa={key:0,style:{"margin-bottom":"10px"}},$a={style:{"margin-top":"10px"}},Va={class:"strategy-desc",style:{"margin-top":"5px","font-size":"12px",color:"#666"}},Ia={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ea={style:{"font-size":"12px",color:"#666"}},Ta={class:"batch-delete-dialog-content"},Ca={key:0,style:{"margin-bottom":"10px"}},Oa={style:{"margin-top":"10px"}},Ma={class:"strategy-desc",style:{"margin-top":"5px","font-size":"12px",color:"#666"}},Ua={style:{display:"flex","justify-content":"space-between","align-items":"center"}},za={style:{"font-size":"12px",color:"#e6a23c"}},Na={__name:"index",setup(ce){const $e=async t=>{try{const e=await Ge.getWeekStartDate(),n=Math.floor((t-e)/(24*60*60*1e3));return n<0?0:Math.floor(n/7)+1}catch(e){console.error("Failed to calculate week number:",e);const n=new Date(t.getFullYear(),0,1),o=Math.floor((t-n)/(24*60*60*1e3));return Math.ceil(o/7)}},ae=D(!1),se=D(!1),V=D([]),X=D([]),P=D([]),W=D(new Date),U=D(new Date),k=D(""),x=D(!1),pe=D(!1),we=D(!1),Y=D(!1),me=D(!1),K=D(!1),fe=D(!1),oe=D("");D(null);const H=D("");Te(x,async t=>{t&&(I.weekOffset=0,await Je(0),console.log("AIå¯¹è¯æ¡†æ‰“å¼€ï¼Œåˆå§‹åŒ–å‘¨æ¬¡:",{currentWeek:W.value,currentWeekStart:U.value,weekOffset:I.weekOffset,aiFormWeekStart:I.weekStart,aiFormWeekDisplay:oe.value,weekOffsetDescription:H.value}))});const ne=D(null),Ve=D(null),_e=D(null),be=D(""),he=D(0),ge=D(!1),I=Ae({weekStart:new Date,weekOffset:0,strategy:"fair",requirements:""}),b=Ae({targetWeeks:[],targetAbsoluteWeeks:[],targetWeeksText:"",conflictMode:"skip"}),h=Ae({targetWeeks:[],targetAbsoluteWeeks:[],targetWeeksText:"",deleteMode:"cancel"}),p=G(()=>{const t=[],e=U.value;for(let n=0;n<7;n++){const o=new Date(e);o.setDate(e.getDate()+n),t.push({date:o,name:["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][o.getDay()]})}return t}),i=G(()=>P.value.reduce((t,e)=>t+e.requiredPeople*7,0)),J=G(()=>V.value.length>0),z=G(()=>{let t=0;return P.value.forEach(e=>{p.value.forEach(n=>{const o=Se(e.id,n.date).length,r=e.requiredPeople;o<r&&(t+=r-o)})}),t}),A=G(()=>z.value===0),C=D(1),re=async()=>{try{const t=await $e(W.value);C.value=t}catch(t){console.error("è®¡ç®—å‘¨æ¬¡å¤±è´¥:",t),C.value=1}},F=G(()=>X.value.filter(t=>t.status==="active")),q=G(()=>{const t=U.value,e=new Date(t);return e.setDate(t.getDate()+6),V.value.filter(n=>{const o=new Date(n.schedule_date);return o>=t&&o<=e}).sort((n,o)=>{const r=new Date(n.schedule_date)-new Date(o.schedule_date);return r!==0?r:(n.time_slot_id||0)-(o.time_slot_id||0)})});G(()=>{const t=[];for(let e=-12;e<=12;e++){if(e===0)continue;new Date(W.value).setDate(W.value.getDate()+e*7);const o=new Date(U.value);o.setDate(U.value.getDate()+e*7);const r=new Date(o);r.setDate(o.getDate()+6),t.push({offset:e,description:e>0?`ç¬¬${e}å‘¨å`:`ç¬¬${Math.abs(e)}å‘¨å‰`,dateRange:ve(),weekStart:o,weekEnd:r})}return t.sort((e,n)=>e.offset-n.offset)});const Me=G(()=>!b.targetAbsoluteWeeks||b.targetAbsoluteWeeks.length===0?[]:b.targetAbsoluteWeeks.map(t=>{let e,n;return t>1?(e=`ç¬¬${t}å‘¨`,n=`ï¼ˆæœªæ¥ç¬¬${t}å‘¨ï¼Œåç§»+${t-1}ï¼‰`):t<0?(e=`å‰${Math.abs(t)}å‘¨`,n=`ï¼ˆè¿‡å»ç¬¬${Math.abs(t)}å‘¨ï¼Œåç§»${t}ï¼‰`):(e="å½“å‰å‘¨",n=""),{absoluteWeek:t,description:e,relativeDescription:n}}).sort((t,e)=>t.absoluteWeek-e.absoluteWeek)),Ue=G(()=>!h.targetAbsoluteWeeks||h.targetAbsoluteWeeks.length===0?[]:h.targetAbsoluteWeeks.map(t=>{let e,n;return t>1?(e=`ç¬¬${t}å‘¨`,n=`ï¼ˆæœªæ¥ç¬¬${t}å‘¨ï¼Œåç§»+${t-1}ï¼‰`):t<0?(e=`å‰${Math.abs(t)}å‘¨`,n=`ï¼ˆè¿‡å»ç¬¬${Math.abs(t)}å‘¨ï¼Œåç§»${t}ï¼‰`):(e="å½“å‰å‘¨",n=""),{absoluteWeek:t,description:e,relativeDescription:n}}).sort((t,e)=>t.absoluteWeek-e.absoluteWeek)),Z=async t=>{try{return await Ge.calculateWeekStart(t)}catch(e){console.error("Failed to calculate week start, using default:",e);const n=new Date(t),o=n.getDay(),r=n.getDate()-o+(o===0?-6:1);return new Date(n.setDate(r))}},ie=async t=>{try{const e=await Z(t),n=new Date(e);n.setDate(e.getDate()+6),U.value=e,k.value=`${ee(e)} - ${ee(n)}`}catch(e){console.error("Failed to update week info:",e),k.value="å‘¨æœŸè®¡ç®—é”™è¯¯"}},ve=t=>k.value,ee=t=>t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}),ze=t=>{const e=new Date;return t.toDateString()===e.toDateString()},Se=(t,e)=>{const n=e.toISOString().split("T")[0];return V.value.filter(o=>o.time_slot_id===t&&o.schedule_date===n)},de=(t,e)=>{const n=P.value.find(r=>r.id===t),o=Se(t,e).length;return n.requiredPeople-o},Ie=async()=>{const t=new Date(W.value);t.setDate(t.getDate()-7),W.value=t,await ie(t),await re(),await Fe()},te=async()=>{const t=new Date(W.value);t.setDate(t.getDate()+7),W.value=t,await ie(t),await re(),await Fe()},Ne=(t,e)=>{ne.value=e.id,t.dataTransfer.setData("scheduleId",e.id)},je=()=>{ne.value=null},Re=async(t,e,n)=>{t.preventDefault();const o=t.dataTransfer.getData("scheduleId");if(o)try{const r=n.toISOString().split("T")[0];await Q.updateSchedule(o,{time_slot_id:e,schedule_date:r});const u=V.value.find(y=>y.id==o);u&&(u.time_slot_id=e,u.schedule_date=r,u.isAISuggestion=!1),v.success("æ’ç­å·²è°ƒæ•´")}catch(r){console.error("è°ƒæ•´æ’ç­å¤±è´¥:",r),v.error("è°ƒæ•´å¤±è´¥")}},Be=(t,e)=>{Ve.value=t,_e.value=e,pe.value=!0},m=async t=>{try{const e=_e.value.toISOString().split("T")[0],o=(await Z(_e.value)).toISOString().split("T")[0],r={employee_id:t.id,time_slot_id:Ve.value,week_start_date:o,schedule_date:e,notes:"æ‰‹åŠ¨åˆ†é…"},u=await Q.createSchedule(r);V.value.push(u.data),pe.value=!1,v.success("å‘˜å·¥å·²åˆ†é…")}catch(e){console.error("åˆ†é…å¤±è´¥:",e),v.error("åˆ†é…å¤±è´¥")}},ye=async t=>{try{await le.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ’ç­å—ï¼Ÿ","æç¤º"),await Q.deleteSchedule(t.id);const e=V.value.findIndex(n=>n.id===t.id);e>-1&&V.value.splice(e,1),v.success("æ’ç­å·²åˆ é™¤")}catch(e){e!=="cancel"&&(console.error("åˆ é™¤å¤±è´¥:",e),v.error("åˆ é™¤å¤±è´¥"))}},$=t=>{be.value=t.aiReason||"æš‚æ— æ¨èç†ç”±",he.value=t.aiConfidence||0,we.value=!0},vt=t=>t>=.8?"#67c23a":t>=.6?"#e6a23c":"#f56c6c",yt=t=>({fair:"å°½é‡è®©æ¯ä¸ªå‘˜å·¥çš„ç­æ¬¡æ•°é‡ç›¸ç­‰ï¼Œè€ƒè™‘å·¥ä½œé‡å¹³è¡¡",priority:"æ ¹æ®å‘˜å·¥ç©ºé—²æ—¶é—´ä¼˜å…ˆçº§å’Œå¯ç”¨æ€§è¿›è¡Œæ’ç­"})[t]||"",Je=async(t=0)=>{console.log("updateWeekOffsetDisplay è¢«è°ƒç”¨ï¼Œåç§»é‡:",t);try{const e=new Date(U.value),n=new Date(e);n.setDate(e.getDate()+t*7),console.log("åŸºå‡†å‘¨èµ·å§‹:",e),console.log("ç›®æ ‡å‘¨èµ·å§‹:",n);const o=new Date(n);o.setDate(n.getDate()+6),I.weekStart=n,oe.value=`${ee(n)} - ${ee(o)}`;const r={"-4":"å››å‘¨å‰","-3":"ä¸‰å‘¨å‰","-2":"ä¸¤å‘¨å‰","-1":"ä¸Šå‘¨",0:"æœ¬å‘¨ï¼ˆå½“å‰ï¼‰",1:"ä¸‹å‘¨",2:"ä¸¤å‘¨å",3:"ä¸‰å‘¨å",4:"å››å‘¨å",5:"äº”å‘¨å",6:"å…­å‘¨å",7:"ä¸ƒå‘¨å",8:"å…«å‘¨å"};H.value=r[t.toString()]||`ç¬¬${t>0?"+":""}${t}å‘¨`,console.log("æ›´æ–°æ˜¾ç¤º:",{weekStart:n,weekEnd:o,display:oe.value,description:H.value})}catch(e){console.error("æ›´æ–°å‘¨åç§»æ˜¾ç¤ºå¤±è´¥:",e),oe.value="å‘¨æœŸè®¡ç®—é”™è¯¯",H.value="è®¡ç®—é”™è¯¯"}},kt=async()=>{var t,e,n;if(!I.weekStart){v.warning("è¯·å…ˆé€‰æ‹©è¦æ’ç­çš„å‘¨æ¬¡");return}try{se.value=!0,v.info("æ­£åœ¨ç”ŸæˆAIæ’ç­ï¼Œè¯·ç¨å€™...");const o={weekStart:I.weekStart.toISOString().split("T")[0],weekCount:1,strategy:I.strategy,requirements:I.requirements},r=await Q.autoSchedule(o);if(console.log("å‰ç«¯æ”¶åˆ°AIæ’ç­å“åº”:",r),r.success){const u=r.data||[];console.log("AIæ’ç­æ•°æ®:",{responseData:r.data,aiSchedulesLength:u.length,firstSchedule:u[0]}),V.value=V.value.filter(_=>!_.isAISuggestion);const y=u.map(_=>({id:`ai-${Date.now()}-${Math.random()}`,employee_id:_.employee_id,employee_name:_.employee_name,time_slot_id:_.time_slot_id,time_slot_name:_.time_slot_name,schedule_date:_.schedule_date,week_start_date:_.week_start_date,status:_.status,assigned_method:_.assigned_method,ai_confidence:_.ai_confidence||.8,ai_reason:_.ai_reason||_.notes,notes:_.notes,isAISuggestion:!0,employee:{name:_.employee_name},timeSlot:{name:_.time_slot_name}}));V.value.push(...y),x.value=!1;try{console.log("å¼€å§‹ä¿å­˜AIæ’ç­åˆ°æ•°æ®åº“, æ•°æ®:",{schedules:u,schedulesCount:u.length,firstSchedule:u[0]});const _=await Q.applyAISchedule({schedules:u,overwriteExisting:!1});if(console.log("ä¿å­˜AIæ’ç­å“åº”:",_),_.success){await Fe();const E=r.summary;E?v.success(`AIæ’ç­å®Œæˆå¹¶å·²ä¿å­˜ï¼ä¸º${H.value}ç”Ÿæˆäº† ${E.totalSchedules} ä¸ªæ’ç­`+(E.failedWeeks>0?`ï¼Œå…¶ä¸­ ${E.failedWeeks} å‘¨ç”Ÿæˆå¤±è´¥`:"")+'ã€‚ç¨åå¯ä½¿ç”¨"åŒæ­¥åˆ°å…¶ä»–å‘¨"åŠŸèƒ½å¿«é€Ÿå¤åˆ¶åˆ°å…¶ä»–å‘¨æœŸã€‚'):v.success(`AIæ’ç­å·²ä¿å­˜ï¼ä¸º${H.value}ç”Ÿæˆ${u.length}ä¸ªæ’ç­ã€‚ç¨åå¯åŒæ­¥åˆ°å…¶ä»–å‘¨æœŸã€‚`)}else v.warning("AIæ’ç­ç”ŸæˆæˆåŠŸï¼Œä½†ä¿å­˜æ—¶å‘ç”Ÿé”™è¯¯ï¼š"+(_.message||"æœªçŸ¥é”™è¯¯"))}catch(_){console.error("ä¿å­˜AIæ’ç­å¤±è´¥:",_),v.warning("AIæ’ç­ç”ŸæˆæˆåŠŸï¼Œä½†ä¿å­˜å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åˆ·æ–°é¡µé¢æŸ¥çœ‹")}r.errors&&r.errors.length>0&&setTimeout(()=>{v.warning("éƒ¨åˆ†å‘¨æœŸæ’ç­ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥å‘˜å·¥ç©ºé—²æ—¶é—´è®¾ç½®")},1e3)}else v.error(r.message||"AIæ’ç­å¤±è´¥"),aiProgressError.value=r.message||"AIæ’ç­å¤±è´¥"}catch(o){console.error("AIæ’ç­å¤±è´¥:",o);let r;o.code==="ECONNABORTED"||(t=o.message)!=null&&t.includes("timeout")?r="AIæ’ç­è¯·æ±‚è¶…æ—¶ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ’ç­æ•°æ®å¤æ‚ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜":r=((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||o.message||"AIæ’ç­å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®",v.error(r),aiProgressError.value=r}finally{se.value=!1}},wt=async()=>{try{await le.confirm("ç¡®å®šè¦æ¸…ç©ºæœ¬å‘¨æ‰€æœ‰æ’ç­å—ï¼Ÿ","è­¦å‘Š",{type:"warning"});const t=await Z(W.value),e=new Date(t);e.setDate(t.getDate()+6);const n=V.value.filter(o=>{const r=new Date(o.schedule_date);return r>=t&&r<=e});for(const o of n)await Q.deleteSchedule(o.id);V.value=V.value.filter(o=>!n.includes(o)),v.success("å·²æ¸…ç©ºæœ¬å‘¨æ’ç­")}catch(t){t!=="cancel"&&(console.error("æ¸…ç©ºå¤±è´¥:",t),v.error("æ¸…ç©ºå¤±è´¥"))}},bt=async()=>{try{await le.confirm("ï¼ˆä½¿ç”¨å‰è¯·å…ˆæ£€æŸ¥è®¾ç½®é€šçŸ¥å¼€å…³ï¼‰ç¡®å®šè¦å‘æ‰€æœ‰å‘˜å·¥å‘é€æ’ç­é€šçŸ¥é‚®ä»¶å—ï¼Ÿ","å‘é€é€šçŸ¥");const t=U.value.toISOString().split("T")[0];await Q.sendNotifications({weekStart:t}),v.success("é€šçŸ¥é‚®ä»¶å·²å‘é€")}catch(t){t!=="cancel"&&(console.error("å‘é€é€šçŸ¥å¤±è´¥:",t),v.error("å‘é€é€šçŸ¥å¤±è´¥"))}},ht=async()=>{try{const t=await $e(W.value);await le.prompt(`å½“å‰æ˜¯ç¬¬${t}å‘¨ï¼Œè¯·è¾“å…¥è¦å¯¼å‡ºçš„å‘¨æ¬¡ï¼ˆä¾‹å¦‚ï¼šè¾“å…¥ ${t} è¡¨ç¤ºå½“å‰å‘¨ï¼Œè¾“å…¥ ${t+1} è¡¨ç¤ºä¸‹å‘¨ï¼‰`,"å¯¼å‡ºæ’ç­è¡¨",{inputValue:t.toString(),inputPlaceholder:"å‘¨æ¬¡æ•°å­—",inputValidator:e=>{if(!e)return"è¯·è¾“å…¥å‘¨æ¬¡";const n=parseInt(e);return isNaN(n)?"è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—":n<1||n>52?"å‘¨æ¬¡åº”åœ¨1-52ä¹‹é—´":!0},inputErrorMessage:"è¯·è¾“å…¥æœ‰æ•ˆçš„å‘¨æ¬¡"}).then(async({value:e})=>{try{const n=parseInt(e),o=await Ge.getWeekStartDate(),r=new Date(o);r.setDate(o.getDate()+(n-1)*7);const u=r.toISOString().split("T")[0];try{const _=`${{}.VITE_API_BASE_URL||"/api"}/ai-schedule/export/${u}`;console.log("å¯¼å‡ºURL:",_);const E=document.createElement("a");E.href=_,E.download=`æ’ç­è¡¨_ç¬¬${n}å‘¨_${u}.xlsx`,E.style.display="none",document.body.appendChild(E),E.click(),document.body.removeChild(E),v.success(`ç¬¬${n}å‘¨æ’ç­è¡¨å¯¼å‡ºå¼€å§‹`)}catch(y){console.error("åˆ›å»ºä¸‹è½½é“¾æ¥å¤±è´¥:",y),v.error("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}}catch(n){console.error("è®¡ç®—å‘¨æ¬¡æ—¥æœŸå¤±è´¥:",n),v.error("è®¡ç®—å‘¨æ¬¡å¯¹åº”æ—¥æœŸå¤±è´¥")}})}catch(t){t!=="cancel"&&(console.error("å¯¼å‡ºæ’ç­è¡¨å¤±è´¥:",t),v.error("å¯¼å‡ºæ’ç­è¡¨å¤±è´¥"))}},Xe=()=>{const t=b.targetWeeksText.trim();if(!t){b.targetWeeks=[],b.targetAbsoluteWeeks=[];return}try{const e=new Set,n=new Set,o=t.split(",").map(r=>r.trim()).filter(r=>r);for(const r of o)if(r.includes("-")){const u=r.lastIndexOf("-");let y,_;if(r.startsWith("-"))if(u===0){const w=parseInt(r);if(!isNaN(w)&&w>=-12&&w<=12&&w!==0){const O=w;e.add(O),n.add(w)}continue}else y=parseInt(r.substring(0,u)),_=parseInt(r.substring(u+1));else{const w=r.split("-");y=parseInt(w[0]),_=parseInt(w[1])}if(isNaN(y)||isNaN(_))continue;const E=Math.min(y,_),xe=Math.max(y,_);for(let w=E;w<=xe;w++)if(w>=-12&&w<=12&&w!==1){let O;w<0?O=w:O=w-1,O!==0&&(e.add(O),n.add(w))}}else{const u=parseInt(r);if(!isNaN(u)&&u>=-12&&u<=12&&u!==1){let y;u<0?y=u:y=u-1,y!==0&&(e.add(y),n.add(u))}}b.targetWeeks=Array.from(e).sort((r,u)=>r-u),b.targetAbsoluteWeeks=Array.from(n).sort((r,u)=>r-u)}catch(e){console.error("è§£æç›®æ ‡å‘¨æ¬¡å¤±è´¥:",e),b.targetWeeks=[],b.targetAbsoluteWeeks=[]}},Ye=(t,e)=>{const n=[];for(let o=t;o<=e;o++)o>=-12&&o<=12&&o!==1&&n.push(o);if(n.length>0){const o=n[0],r=n[n.length-1];b.targetWeeksText=o===r?`${o}`:`${o}-${r}`,Xe()}},St=()=>{b.targetWeeks=[],b.targetAbsoluteWeeks=[],b.targetWeeksText=""},Wt=async()=>{var e,n,o;if(!b.targetAbsoluteWeeks||b.targetAbsoluteWeeks.length===0){v.warning("è¯·é€‰æ‹©è¦åŒæ­¥åˆ°çš„ç›®æ ‡å‘¨");return}const t=q.value;if(t.length===0){v.warning("å½“å‰å‘¨æ²¡æœ‰æ’ç­æ•°æ®å¯åŒæ­¥");return}try{me.value=!0,await le.confirm(`ç¡®å®šè¦å°†å½“å‰å‘¨çš„${t.length}ä¸ªæ’ç­åŒæ­¥åˆ°${b.targetAbsoluteWeeks.length}ä¸ªç›®æ ‡å‘¨å—ï¼Ÿ`,"ç¡®è®¤åŒæ­¥");const r={sourceWeekStart:U.value.toISOString().split("T")[0],targetWeekOffsets:b.targetWeeks,conflictMode:b.conflictMode,schedules:t.map(y=>({employee_id:y.employee_id,time_slot_id:y.time_slot_id,schedule_date:y.schedule_date,ai_confidence:y.ai_confidence||null,ai_reason:y.ai_reason||null,notes:y.notes||null}))},u=await Q.syncSchedulesToWeeks(r);u.success?(v.success(`æˆåŠŸåŒæ­¥åˆ°${u.data.successCount}ä¸ªå‘¨ï¼Œå¤±è´¥${u.data.failedCount}ä¸ª`),Y.value=!1,b.targetWeeks=[],b.targetAbsoluteWeeks=[],b.targetWeeksText="",u.data.failedCount>0&&((e=u.data.errors)==null?void 0:e.length)>0&&setTimeout(()=>{const y=u.data.errors.slice(0,3).map(_=>_.message).join("ï¼›");v.warning(`éƒ¨åˆ†åŒæ­¥å¤±è´¥ï¼š${y}${u.data.errors.length>3?"...":""}`)},1e3)):v.error(u.message||"åŒæ­¥å¤±è´¥")}catch(r){r!=="cancel"&&(console.error("åŒæ­¥æ’ç­å¤±è´¥:",r),v.error(((o=(n=r.response)==null?void 0:n.data)==null?void 0:o.message)||"åŒæ­¥æ’ç­å¤±è´¥"))}finally{me.value=!1}},Ke=()=>{const t=h.targetWeeksText.trim();if(!t){h.targetWeeks=[],h.targetAbsoluteWeeks=[];return}try{const e=new Set,n=new Set,o=t.split(",").map(r=>r.trim()).filter(r=>r);for(const r of o)if(r.includes("-")){const u=r.lastIndexOf("-");let y,_;if(r.startsWith("-"))if(u===0){const w=parseInt(r);if(!isNaN(w)&&w>=-12&&w<=12&&w!==0){const O=w;e.add(O),n.add(w)}continue}else y=parseInt(r.substring(0,u)),_=parseInt(r.substring(u+1));else{const w=r.split("-");y=parseInt(w[0]),_=parseInt(w[1])}if(isNaN(y)||isNaN(_))continue;const E=Math.min(y,_),xe=Math.max(y,_);for(let w=E;w<=xe;w++)if(w>=-12&&w<=12&&w!==0){let O;w<0?O=w:O=w-1,e.add(O),n.add(w)}}else{const u=parseInt(r);if(!isNaN(u)&&u>=-12&&u<=12&&u!==0){let y;u<0?y=u:y=u-1,e.add(y),n.add(u)}}h.targetWeeks=Array.from(e).sort((r,u)=>r-u),h.targetAbsoluteWeeks=Array.from(n).sort((r,u)=>r-u)}catch(e){console.error("è§£ææ‰¹é‡åˆ é™¤ç›®æ ‡å‘¨æ¬¡å¤±è´¥:",e),h.targetWeeks=[],h.targetAbsoluteWeeks=[]}},Pe=t=>{h.targetWeeksText=t,Ke()},Ze=()=>{h.targetWeeks=[],h.targetAbsoluteWeeks=[],h.targetWeeksText=""},xt=async()=>{var t,e,n;if(!h.targetAbsoluteWeeks||h.targetAbsoluteWeeks.length===0){v.warning("è¯·é€‰æ‹©è¦åˆ é™¤çš„å‘¨æ¬¡èŒƒå›´");return}try{fe.value=!0;const o=h.deleteMode==="permanent"?"æ°¸ä¹…åˆ é™¤":"è½¯åˆ é™¤",r=h.targetAbsoluteWeeks.map(_=>_<0?`å‰${Math.abs(_)}å‘¨`:_===1?"å½“å‰å‘¨":`ç¬¬${_}å‘¨`).join("ã€");await le.confirm(`ç¡®å®šè¦${o}ä»¥ä¸‹å‘¨æ¬¡çš„æ‰€æœ‰æ’ç­è®°å½•å—ï¼Ÿ

å‘¨æ¬¡ï¼š${r}

âš ï¸ æ­¤æ“ä½œ${h.deleteMode==="permanent"?"æ— æ³•æ¢å¤":"ä¼šå°†æ’ç­çŠ¶æ€æ ‡è®°ä¸ºå·²å–æ¶ˆ"}`,"ç¡®è®¤åˆ é™¤",{type:"warning",dangerouslyUseHTMLString:!0});const u={weekOffsets:h.targetWeeks,deleteMode:h.deleteMode},y=await Q.batchDeleteSchedulesByWeeks(u);y.success?(v.success(`æ‰¹é‡åˆ é™¤å®Œæˆï¼š${o}äº†${y.data.deletedCount}ä¸ªæ’ç­è®°å½•`),K.value=!1,Ze(),await We(),y.data.failedCount>0&&((t=y.data.errors)==null?void 0:t.length)>0&&setTimeout(()=>{const _=y.data.errors.slice(0,3).map(E=>E.message).join("ï¼›");v.warning(`éƒ¨åˆ†åˆ é™¤å¤±è´¥ï¼š${_}${y.data.errors.length>3?"...":""}`)},1e3)):v.error(y.message||"æ‰¹é‡åˆ é™¤å¤±è´¥")}catch(o){o!=="cancel"&&(console.error("æ‰¹é‡åˆ é™¤æ’ç­å¤±è´¥:",o),v.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"æ‰¹é‡åˆ é™¤æ’ç­å¤±è´¥"))}finally{fe.value=!1}},Dt=async()=>{try{const t=await Ot.getEmployees();X.value=t.data||[]}catch(t){console.error("è·å–å‘˜å·¥åˆ—è¡¨å¤±è´¥:",t)}},At=async()=>{try{const t=await Mt.getTimeSlots();P.value=Array.isArray(t.data)?t.data:[]}catch(t){console.error("è·å–æ—¶é—´æ®µå¤±è´¥:",t),P.value=[]}},We=async()=>{try{ae.value=!0;const t=U.value.toISOString().split("T")[0],e=new Date(U.value);e.setDate(e.getDate()+6);const n={dateRange:[t,e.toISOString().split("T")[0]]},o=await Q.getSchedules(n);console.log("è·å–æ’ç­æ•°æ®å“åº”:",o);const r=o.data;V.value=Array.isArray(r.data)?r.data:Array.isArray(r)?r:[],console.log("è§£æåçš„æ’ç­æ•°æ®æ•°é‡:",V.value.length)}catch(t){console.error("è·å–æ’ç­æ•°æ®å¤±è´¥:",t),V.value=[]}finally{ae.value=!1}},Fe=async()=>{await We()};Te(W,async t=>{await ie(t),await re(),We()}),Te(Y,t=>{t&&(b.targetWeeks=[],b.targetAbsoluteWeeks=[],b.targetWeeksText="",b.conflictMode="skip")}),Te(K,t=>{t&&(h.targetWeeks=[],h.targetAbsoluteWeeks=[],h.targetWeeksText="",h.deleteMode="cancel")});const $t=t=>{v.success("æ‰¹é‡æ“ä½œå·²å¯åŠ¨")},Vt=t=>{v.success("æ‰¹é‡æ“ä½œå·²å®Œæˆ"),We()};return st(async()=>{await ie(W.value),await re(),Dt(),At(),We()}),(t,e)=>{const n=nt,o=rt,r=mt,u=_t,y=Ce("QuestionFilled"),_=il,E=Ce("Close"),xe=Ce("Plus"),w=Ce("Warning"),O=ol,It=ut,ue=it,De=nl,qe=dt,Le=ct,He=pt,ke=rl,Et=dl,Tt=ft,Ct=gt;return f(),S("div",Ml,[s("div",Ul,[e[33]||(e[33]=s("div",null,[s("h1",null,"AIæ™ºèƒ½æ’ç­"),s("p",null,"è°ƒç”¨AI-apiè‡ªåŠ¨ç”Ÿæˆæ’ç­æ–¹æ¡ˆ")],-1)),s("div",zl,[l(o,{onClick:e[0]||(e[0]=d=>ge.value=!0),type:"success"},{default:a(()=>[l(n,null,{default:a(()=>[l(N(Kt))]),_:1}),e[27]||(e[27]=c(" æ‰¹é‡æ’ç­ ",-1))]),_:1,__:[27]}),l(o,{onClick:ht,type:"info"},{default:a(()=>[l(n,null,{default:a(()=>[l(N(Zt))]),_:1}),e[28]||(e[28]=c(" å¯¼å‡ºæ’ç­è¡¨ ",-1))]),_:1,__:[28]}),l(o,{onClick:bt,type:"warning",disabled:!J.value},{default:a(()=>[l(n,null,{default:a(()=>[l(N(el))]),_:1}),e[29]||(e[29]=c(" é‚®ä»¶é€šçŸ¥ ",-1))]),_:1,__:[29]},8,["disabled"]),l(o,{onClick:e[1]||(e[1]=d=>Y.value=!0),type:"success",disabled:!q.value.length},{default:a(()=>[l(n,null,{default:a(()=>[l(N(tl))]),_:1}),e[30]||(e[30]=c(" åŒæ­¥åˆ°å…¶ä»–å‘¨ ",-1))]),_:1,__:[30]},8,["disabled"]),l(o,{onClick:e[2]||(e[2]=d=>K.value=!0),type:"danger"},{default:a(()=>[l(n,null,{default:a(()=>[l(N(ll))]),_:1}),e[31]||(e[31]=c(" æ‰¹é‡åˆ é™¤æ’ç­ ",-1))]),_:1,__:[31]}),l(o,{onClick:e[3]||(e[3]=d=>x.value=!0),type:"primary",size:"large"},{default:a(()=>[l(n,null,{default:a(()=>[l(N(Qe))]),_:1}),e[32]||(e[32]=c(" AIè‡ªåŠ¨æ’ç­ ",-1))]),_:1,__:[32]})])]),l(u,{class:"week-selector"},{default:a(()=>[s("div",Nl,[l(o,{onClick:Ie,icon:N(al)},{default:a(()=>e[34]||(e[34]=[c("ä¸Šä¸€å‘¨",-1)])),_:1,__:[34]},8,["icon"]),s("div",jl,[s("h2",null,g(ve(W.value)),1),s("div",Rl,[l(r,{type:"primary"},{default:a(()=>[c("ç¬¬"+g(C.value)+"å‘¨",1)]),_:1}),l(r,{type:"info"},{default:a(()=>[c("å…±"+g(i.value)+"ä¸ªç­æ¬¡",1)]),_:1}),l(r,{type:A.value?"success":"warning"},{default:a(()=>[c(g(A.value?"å…¨éƒ¨å·²å®‰æ’":`è¿˜æœ‰${z.value}ä¸ªç©ºç¼º`),1)]),_:1},8,["type"])])]),l(o,{onClick:te,icon:N(sl)},{default:a(()=>e[35]||(e[35]=[c("ä¸‹ä¸€å‘¨",-1)])),_:1,__:[35]},8,["icon"])])]),_:1}),ot((f(),L(u,{class:"schedule-calendar"},{header:a(()=>[s("div",Bl,[e[37]||(e[37]=s("span",null,"æ’ç­è¡¨",-1)),s("div",Pl,[l(o,{onClick:wt,type:"danger",size:"small",plain:""},{default:a(()=>e[36]||(e[36]=[c(" æ¸…ç©ºæœ¬å‘¨æ’ç­ ",-1)])),_:1,__:[36]})])])]),default:a(()=>[s("div",Fl,[s("div",ql,[e[38]||(e[38]=s("div",{class:"time-cell"},"æ—¶é—´æ®µ",-1)),(f(!0),S(j,null,R(p.value,d=>(f(),S("div",{key:d.date,class:tt(["day-cell",{today:ze(d.date)}])},[s("div",Ll,g(d.name),1),s("div",Hl,g(ee(d.date)),1)],2))),128))]),(f(!0),S(j,null,R(P.value,d=>(f(),S("div",{key:d.id,class:"time-row"},[s("div",Ql,[s("div",Gl,g(d.name),1),s("div",Jl,g(d.startTime)+" - "+g(d.endTime),1),s("div",Xl,"éœ€è¦"+g(d.requiredPeople)+"äºº",1)]),(f(!0),S(j,null,R(p.value,B=>(f(),S("div",{key:`${d.id}-${B.date}`,class:"schedule-cell",onDrop:T=>Re(T,d.id,B.date),onDragover:e[4]||(e[4]=Oe(()=>{},["prevent"])),onDragenter:e[5]||(e[5]=Oe(()=>{},["prevent"]))},[s("div",Kl,[(f(!0),S(j,null,R(Se(d.id,B.date),T=>{var et;return f(),S("div",{key:T.id,class:tt(["scheduled-employee",{"ai-suggested":T.isAISuggestion,"manually-assigned":!T.isAISuggestion,dragging:T.id===ne.value}]),draggable:"true",onDragstart:Ee=>Ne(Ee,T),onDragend:je,onClick:Ee=>t.showScheduleDetails(T)},[s("div",ea,[s("span",ta,g((et=T.employee)==null?void 0:et.name),1),s("div",la,[T.isAISuggestion?(f(),L(n,{key:0,class:"ai-icon"},{default:a(()=>[l(N(Qe))]),_:1})):M("",!0),T.aiConfidence?(f(),S("span",aa,g(Math.round(T.aiConfidence*100))+"% ",1)):M("",!0)])]),s("div",sa,[T.aiReason?(f(),L(_,{key:0,content:"AIæ¨èç†ç”±"},{default:a(()=>[l(o,{size:"small",type:"info",circle:"",onClick:Oe(Ee=>$(T),["stop"])},{default:a(()=>[l(n,null,{default:a(()=>[l(y)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):M("",!0),l(o,{size:"small",type:"danger",circle:"",onClick:Oe(Ee=>ye(T),["stop"])},{default:a(()=>[l(n,null,{default:a(()=>[l(E)]),_:1})]),_:2},1032,["onClick"])])],42,Zl)}),128)),de(d.id,B.date)>0?(f(),S("div",{key:0,class:"vacancy-slot",onClick:T=>Be(d.id,B.date)},[l(n,null,{default:a(()=>[l(xe)]),_:1}),s("span",null,"è¿˜éœ€"+g(de(d.id,B.date))+"äºº",1)],8,oa)):M("",!0),de(d.id,B.date)<0?(f(),S("div",na,[l(n,null,{default:a(()=>[l(w)]),_:1}),s("span",null,"è¶…é¢"+g(Math.abs(de(d.id,B.date)))+"äºº",1)])):M("",!0)])],40,Yl))),128))]))),128))])]),_:1})),[[Ct,ae.value]]),l(ke,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=d=>x.value=d),title:"AIæ™ºèƒ½æ’ç­",width:"600px"},{footer:a(()=>[s("div",pa,[e[44]||(e[44]=s("div",{style:{"font-size":"12px",color:"#999"}},' ğŸ’¡ æç¤ºï¼šç”Ÿæˆæ’ç­åå¯ä½¿ç”¨"åŒæ­¥åˆ°å…¶ä»–å‘¨"åŠŸèƒ½å¿«é€Ÿå¤åˆ¶ ',-1)),s("div",null,[l(o,{onClick:e[9]||(e[9]=d=>x.value=!1)},{default:a(()=>e[43]||(e[43]=[c("å–æ¶ˆ",-1)])),_:1,__:[43]}),l(o,{type:"primary",onClick:kt,loading:se.value},{default:a(()=>[c(g(se.value?"æ­£åœ¨ç”Ÿæˆ...":"ç”ŸæˆAIæ’ç­"),1)]),_:1},8,["loading"])])])]),default:a(()=>[s("div",ra,[l(O,{title:"AIæ’ç­è¯´æ˜",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:a(()=>e[39]||(e[39]=[s("ul",null,[s("li",null,"AIä¼šæ ¹æ®å‘˜å·¥ç©ºé—²æ—¶é—´ã€å†å²æ’ç­è®°å½•è¿›è¡Œæ™ºèƒ½åˆ†æ"),s("li",null,"è€ƒè™‘å‘˜å·¥åå¥½ã€å·¥ä½œé‡å¹³è¡¡ã€å…¬å¹³æ€§ç­‰å› ç´ "),s("li",null,"ç”Ÿæˆçš„æ’ç­æ–¹æ¡ˆå¯ä»¥æ‰‹åŠ¨è°ƒæ•´")],-1)])),_:1}),l(He,{model:I,"label-width":"120px"},{default:a(()=>[l(ue,{label:"ç›®æ ‡å‘¨æ¬¡"},{default:a(()=>[l(It,{modelValue:I.weekOffset,"onUpdate:modelValue":e[6]||(e[6]=d=>I.weekOffset=d),min:-4,max:8,placeholder:"0",style:{width:"200px"},onChange:Je},null,8,["modelValue"]),e[40]||(e[40]=s("span",{style:{"margin-left":"10px",color:"#666"}}," (ç›¸å¯¹å½“å‰å‘¨çš„åç§»ï¼Œ0=æœ¬å‘¨ï¼Œ1=ä¸‹å‘¨ï¼Œ-1=ä¸Šå‘¨) ",-1)),s("div",ia,[s("div",da,g(H.value),1),s("div",ua,g(oe.value),1)])]),_:1,__:[40]}),l(ue,{label:"æ’ç­ç­–ç•¥"},{default:a(()=>[l(qe,{modelValue:I.strategy,"onUpdate:modelValue":e[7]||(e[7]=d=>I.strategy=d)},{default:a(()=>[l(De,{label:"fair"},{default:a(()=>e[41]||(e[41]=[c("å…¬å¹³åˆ†é…",-1)])),_:1,__:[41]}),l(De,{label:"priority"},{default:a(()=>e[42]||(e[42]=[c("ä¼˜å…ˆçº§åˆ†é…",-1)])),_:1,__:[42]})]),_:1},8,["modelValue"]),s("div",ca,g(yt(I.strategy)),1)]),_:1}),l(ue,{label:"ç‰¹æ®Šè¦æ±‚"},{default:a(()=>[l(Le,{modelValue:I.requirements,"onUpdate:modelValue":e[8]||(e[8]=d=>I.requirements=d),type:"textarea",rows:3,placeholder:"ä¾‹å¦‚ï¼šå‘¨æœ«éœ€è¦ç»éªŒä¸°å¯Œçš„å‘˜å·¥ï¼Œé‡è¦æ—¶æ®µéœ€è¦åŒäººå€¼ç­ç­‰æ•´ä½“è¦æ±‚"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),l(ke,{modelValue:pe.value,"onUpdate:modelValue":e[11]||(e[11]=d=>pe.value=d),title:"é€‰æ‹©å‘˜å·¥",width:"500px"},{default:a(()=>[s("div",ma,[s("div",fa,[s("h3",null,"å¯ç”¨å‘˜å·¥ ("+g(F.value.length)+"äºº)",1),s("div",_a,[(f(!0),S(j,null,R(F.value,d=>(f(),S("div",{key:d.id,class:"employee-option",onClick:B=>m(d)},[l(Et,{size:40},{default:a(()=>[c(g(d.name.charAt(0)),1)]),_:2},1024),s("div",va,[s("div",ya,g(d.name),1),s("div",ka," ä¼˜å…ˆçº§: "+g("â˜…".repeat(d.priority||1)),1)]),l(o,{type:"primary",size:"small"},{default:a(()=>e[45]||(e[45]=[c("é€‰æ‹©",-1)])),_:1,__:[45]})],8,ga))),128))])])])]),_:1},8,["modelValue"]),l(ke,{modelValue:we.value,"onUpdate:modelValue":e[12]||(e[12]=d=>we.value=d),title:"AIæ¨èç†ç”±",width:"400px"},{default:a(()=>[be.value?(f(),S("div",wa,[l(n,null,{default:a(()=>[l(N(Qe))]),_:1}),s("p",null,g(be.value),1),s("div",ba,[e[46]||(e[46]=s("span",null,"æ¨èç½®ä¿¡åº¦ï¼š",-1)),l(Tt,{percentage:Math.round(he.value*100),color:vt(he.value)},null,8,["percentage","color"])])])):M("",!0)]),_:1},8,["modelValue"]),l(ke,{modelValue:ge.value,"onUpdate:modelValue":e[13]||(e[13]=d=>ge.value=d),title:"æ‰¹é‡æ’ç­æ“ä½œ",width:"800px","close-on-click-modal":!1},{default:a(()=>[l(Ol,{employees:X.value,"time-slots":P.value,onOperationStarted:$t,onOperationCompleted:Vt},null,8,["employees","time-slots"])]),_:1},8,["modelValue"]),l(ke,{modelValue:Y.value,"onUpdate:modelValue":e[19]||(e[19]=d=>Y.value=d),title:"åŒæ­¥æ’ç­åˆ°å…¶ä»–å‘¨",width:"700px"},{footer:a(()=>[s("div",Ia,[s("div",Ea," å·²é€‰æ‹© "+g(b.targetAbsoluteWeeks?b.targetAbsoluteWeeks.length:0)+" ä¸ªç›®æ ‡å‘¨ ",1),s("div",null,[l(o,{onClick:e[18]||(e[18]=d=>Y.value=!1)},{default:a(()=>e[55]||(e[55]=[c("å–æ¶ˆ",-1)])),_:1,__:[55]}),l(o,{type:"primary",onClick:Wt,loading:me.value,disabled:!b.targetAbsoluteWeeks||b.targetAbsoluteWeeks.length===0},{default:a(()=>[c(g(me.value?"åŒæ­¥ä¸­...":"å¼€å§‹åŒæ­¥"),1)]),_:1},8,["loading","disabled"])])])]),default:a(()=>[s("div",ha,[l(O,{title:"åŒæ­¥è¯´æ˜",type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:a(()=>e[47]||(e[47]=[s("ul",null,[s("li",null,"å°†å½“å‰å‘¨çš„æ’ç­æ¨¡å¼å®Œå…¨å¤åˆ¶åˆ°é€‰æ‹©çš„ç›®æ ‡å‘¨"),s("li",null,"åªå¤åˆ¶æ’ç­å®‰æ’ï¼Œä¸å¤åˆ¶å‘˜å·¥çš„è¯·å‡ç­‰ä¸ªäººä¿¡æ¯"),s("li",null,"å¦‚æœç›®æ ‡å‘¨å·²æœ‰æ’ç­ï¼Œå¯é€‰æ‹©è¦†ç›–æˆ–è·³è¿‡")],-1)])),_:1}),s("div",Sa,[s("h4",null,"å½“å‰å‘¨æ’ç­é¢„è§ˆ ("+g(ve(W.value))+")",1),s("div",Wa,[q.value.length===0?(f(),S("div",xa," å½“å‰å‘¨æš‚æ— æ’ç­æ•°æ® ")):(f(),S("div",Da,[(f(!0),S(j,null,R(q.value,d=>{var B,T;return f(),S("div",{key:d.id,style:{display:"flex","justify-content":"space-between",padding:"5px 0","border-bottom":"1px solid #f0f0f0"}},[s("span",null,g((B=d.employee)==null?void 0:B.name),1),s("span",null,g(ee(new Date(d.schedule_date)))+" "+g((T=d.timeSlot)==null?void 0:T.name),1)])}),128))]))])]),l(He,{model:b,"label-width":"100px"},{default:a(()=>[l(ue,{label:"ç›®æ ‡å‘¨æ¬¡"},{default:a(()=>[l(Le,{modelValue:b.targetWeeksText,"onUpdate:modelValue":e[14]||(e[14]=d=>b.targetWeeksText=d),placeholder:"ä¾‹å¦‚ï¼š2ï¼ˆç¬¬2å‘¨ï¼‰ã€3-6ï¼ˆç¬¬3-6å‘¨ï¼‰ã€-1ï¼ˆå‰1å‘¨ï¼‰",onInput:Xe,style:{"margin-bottom":"10px"}},null,8,["modelValue"]),e[52]||(e[52]=s("div",{style:{"font-size":"12px",color:"#666","margin-bottom":"10px"}},[s("div",{style:{"margin-bottom":"5px"}},"å¡«å†™è¯´æ˜ï¼ˆå‘¨æ¬¡åºå·ï¼Œå½“å‰å‘¨ä¸ºç¬¬1å‘¨ï¼‰ï¼š"),s("div",null,'â€¢ æ­£æ•°è¡¨ç¤ºæœªæ¥å‘¨æ¬¡ï¼šå¡«å†™ "2" è¡¨ç¤ºåŒæ­¥åˆ°ç¬¬2å‘¨ï¼ˆä¸‹å‘¨ï¼‰ï¼Œ"6" è¡¨ç¤ºç¬¬6å‘¨'),s("div",null,'â€¢ è´Ÿæ•°è¡¨ç¤ºè¿‡å»å‘¨æ¬¡ï¼šå¡«å†™ "-1" è¡¨ç¤ºåŒæ­¥åˆ°å‰1å‘¨ï¼Œ"-2" è¡¨ç¤ºå‰2å‘¨'),s("div",null,'â€¢ èŒƒå›´è¾“å…¥ï¼šå¡«å†™ "2-6" è¡¨ç¤ºåŒæ­¥åˆ°ç¬¬2å‘¨è‡³ç¬¬6å‘¨'),s("div",null,'â€¢ å¤šä¸ªé€‰æ‹©ï¼šå¡«å†™ "-2,-1,2,6" è¡¨ç¤ºé€‰æ‹©å¤šä¸ªå‘¨æ¬¡')],-1)),b.targetAbsoluteWeeks&&b.targetAbsoluteWeeks.length>0?(f(),S("div",Aa,[e[48]||(e[48]=s("div",{style:{"font-size":"12px",color:"#409eff","margin-bottom":"5px"}},"å·²é€‰æ‹©å‘¨æ¬¡ï¼š",-1)),(f(!0),S(j,null,R(Me.value,d=>(f(),L(r,{key:d.absoluteWeek,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:a(()=>[c(g(d.description)+" "+g(d.relativeDescription),1)]),_:2},1024))),128))])):M("",!0),s("div",$a,[l(o,{size:"small",onClick:e[15]||(e[15]=d=>Ye(2,5))},{default:a(()=>e[49]||(e[49]=[c("å¿«é€Ÿå¡«å†™ï¼šç¬¬2-5å‘¨",-1)])),_:1,__:[49]}),l(o,{size:"small",onClick:e[16]||(e[16]=d=>Ye(2,9))},{default:a(()=>e[50]||(e[50]=[c("å¿«é€Ÿå¡«å†™ï¼šç¬¬2-9å‘¨",-1)])),_:1,__:[50]}),l(o,{size:"small",onClick:St},{default:a(()=>e[51]||(e[51]=[c("æ¸…ç©º",-1)])),_:1,__:[51]})])]),_:1,__:[52]}),l(ue,{label:"å†²çªå¤„ç†"},{default:a(()=>[l(qe,{modelValue:b.conflictMode,"onUpdate:modelValue":e[17]||(e[17]=d=>b.conflictMode=d)},{default:a(()=>[l(De,{label:"skip"},{default:a(()=>e[53]||(e[53]=[c("è·³è¿‡å·²æœ‰æ’ç­",-1)])),_:1,__:[53]}),l(De,{label:"overwrite"},{default:a(()=>e[54]||(e[54]=[c("è¦†ç›–å·²æœ‰æ’ç­",-1)])),_:1,__:[54]})]),_:1},8,["modelValue"]),s("div",Va,g(b.conflictMode==="skip"?"é‡åˆ°å†²çªæ—¶ä¿ç•™ç›®æ ‡å‘¨çš„åŸæœ‰æ’ç­":"é‡åˆ°å†²çªæ—¶ç”¨å½“å‰å‘¨çš„æ’ç­è¦†ç›–ç›®æ ‡å‘¨"),1)]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),l(ke,{modelValue:K.value,"onUpdate:modelValue":e[26]||(e[26]=d=>K.value=d),title:"æ‰¹é‡åˆ é™¤æ’ç­",width:"700px"},{footer:a(()=>[s("div",Ua,[s("div",za," âš ï¸ å°†åˆ é™¤ "+g(h.targetAbsoluteWeeks?h.targetAbsoluteWeeks.length:0)+" ä¸ªå‘¨æ¬¡çš„æ‰€æœ‰æ’ç­ ",1),s("div",null,[l(o,{onClick:e[25]||(e[25]=d=>K.value=!1)},{default:a(()=>e[64]||(e[64]=[c("å–æ¶ˆ",-1)])),_:1,__:[64]}),l(o,{type:"danger",onClick:xt,loading:fe.value,disabled:!h.targetAbsoluteWeeks||h.targetAbsoluteWeeks.length===0},{default:a(()=>[c(g(fe.value?"åˆ é™¤ä¸­...":"ç¡®è®¤åˆ é™¤"),1)]),_:1},8,["loading","disabled"])])])]),default:a(()=>[s("div",Ta,[l(O,{title:"æ‰¹é‡åˆ é™¤è¯´æ˜",type:"warning",closable:!1,style:{"margin-bottom":"20px"}},{default:a(()=>e[56]||(e[56]=[s("ul",null,[s("li",null,[s("strong",null,"æ­¤æ“ä½œå°†åˆ é™¤æŒ‡å®šå‘¨æ¬¡èŒƒå›´å†…çš„æ‰€æœ‰æ’ç­è®°å½•")]),s("li",null,"ä¾‹å¦‚ï¼šåˆ é™¤ç¬¬1-8å‘¨ï¼Œå°†åˆ é™¤ç¬¬1å‘¨åˆ°ç¬¬8å‘¨çš„æ‰€æœ‰å€¼ç­å®‰æ’"),s("li",null,"åˆ é™¤åçš„æ’ç­è®°å½•å°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ"),s("li",null,"å»ºè®®åœ¨åˆ é™¤å‰å…ˆç¡®è®¤å‘¨æ¬¡èŒƒå›´æ˜¯å¦æ­£ç¡®")],-1)])),_:1}),l(He,{model:h,"label-width":"120px"},{default:a(()=>[l(ue,{label:"åˆ é™¤å‘¨æ¬¡èŒƒå›´"},{default:a(()=>[l(Le,{modelValue:h.targetWeeksText,"onUpdate:modelValue":e[20]||(e[20]=d=>h.targetWeeksText=d),placeholder:"ä¾‹å¦‚ï¼š1-8ï¼ˆåˆ é™¤ç¬¬1-8å‘¨ï¼‰ã€2,4,6ï¼ˆåˆ é™¤ç¬¬2ã€4ã€6å‘¨ï¼‰ã€-2--1ï¼ˆåˆ é™¤å‰2å‘¨åˆ°å‰1å‘¨ï¼‰",onInput:Ke,style:{"margin-bottom":"10px"}},null,8,["modelValue"]),e[62]||(e[62]=s("div",{style:{"font-size":"12px",color:"#666","margin-bottom":"10px"}},[s("div",{style:{"margin-bottom":"5px"}},"å¡«å†™è¯´æ˜ï¼ˆå‘¨æ¬¡åºå·ï¼Œå½“å‰å‘¨ä¸ºç¬¬1å‘¨ï¼‰ï¼š"),s("div",null,'â€¢ æ­£æ•°è¡¨ç¤ºæœªæ¥å‘¨æ¬¡ï¼šå¡«å†™ "2-8" è¡¨ç¤ºåˆ é™¤ç¬¬2å‘¨åˆ°ç¬¬8å‘¨'),s("div",null,'â€¢ è´Ÿæ•°è¡¨ç¤ºè¿‡å»å‘¨æ¬¡ï¼šå¡«å†™ "-4--1" è¡¨ç¤ºåˆ é™¤å‰4å‘¨åˆ°å‰1å‘¨'),s("div",null,'â€¢ æ··åˆè¾“å…¥ï¼šå¡«å†™ "-2,1,3-5" è¡¨ç¤ºåˆ é™¤å‰2å‘¨ã€ç¬¬1å‘¨ã€ç¬¬3-5å‘¨'),s("div",null,'â€¢ å•ä¸ªå‘¨æ¬¡ï¼šå¡«å†™ "6" è¡¨ç¤ºåªåˆ é™¤ç¬¬6å‘¨')],-1)),h.targetAbsoluteWeeks&&h.targetAbsoluteWeeks.length>0?(f(),S("div",Ca,[e[57]||(e[57]=s("div",{style:{"font-size":"12px",color:"#e6a23c","margin-bottom":"5px"}},"âš ï¸ å°†è¦åˆ é™¤çš„å‘¨æ¬¡ï¼š",-1)),(f(!0),S(j,null,R(Ue.value,d=>(f(),L(r,{key:d.absoluteWeek,size:"small",type:"danger",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:a(()=>[c(g(d.description)+" "+g(d.relativeDescription),1)]),_:2},1024))),128))])):M("",!0),s("div",Oa,[l(o,{size:"small",onClick:e[21]||(e[21]=d=>Pe("1-8"))},{default:a(()=>e[58]||(e[58]=[c("å¿«é€Ÿå¡«å†™ï¼šç¬¬1-8å‘¨",-1)])),_:1,__:[58]}),l(o,{size:"small",onClick:e[22]||(e[22]=d=>Pe("2-9"))},{default:a(()=>e[59]||(e[59]=[c("å¿«é€Ÿå¡«å†™ï¼šç¬¬2-9å‘¨",-1)])),_:1,__:[59]}),l(o,{size:"small",onClick:e[23]||(e[23]=d=>Pe("-4--1"))},{default:a(()=>e[60]||(e[60]=[c("å¿«é€Ÿå¡«å†™ï¼šå‰4å‘¨",-1)])),_:1,__:[60]}),l(o,{size:"small",onClick:Ze},{default:a(()=>e[61]||(e[61]=[c("æ¸…ç©º",-1)])),_:1,__:[61]})])]),_:1,__:[62]}),l(ue,{label:"åˆ é™¤æ¨¡å¼"},{default:a(()=>[l(qe,{modelValue:h.deleteMode,"onUpdate:modelValue":e[24]||(e[24]=d=>h.deleteMode=d)},{default:a(()=>[l(De,{label:"permanent"},{default:a(()=>e[63]||(e[63]=[c("æ°¸ä¹…åˆ é™¤",-1)])),_:1,__:[63]})]),_:1},8,["modelValue"]),s("div",Ma,g(h.deleteMode==="cancel"?" ":"å½»åº•åˆ é™¤æ’ç­è®°å½•ï¼Œæ— æ³•æ¢å¤"),1)]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}},ps=at(Na,[["__scopeId","data-v-58376d51"]]);export{ps as default};
