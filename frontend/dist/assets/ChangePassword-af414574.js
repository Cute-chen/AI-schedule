import{u as E,r as k}from"./index-bcd0f302.js";/* empty css                *//* empty css                     */import{_ as B}from"./_plugin-vue_export-helper-8da67cfc.js";/* empty css                 */import{aC as z,r as h,X as N,c as q,y as L,z as S,Q as a,I as t,A as o,V as I,u as p,C as m,M as P,O as M}from"./vendor-b2a91a46.js";import{l as w,E as f,k as T,W as U,X as R,p as A,_ as D,a2 as F}from"./elementPlus-9365ac08.js";import"./utils-88d415ea.js";const X={class:"change-password-container"},O={class:"password-tips"},Q={class:"form-actions"},W={__name:"ChangePassword",setup(Z){const _=z(),y=E(),c=h(),u=h(!1),r=N({currentPassword:"",newPassword:"",confirmPassword:""}),l=q(()=>({minLength:r.newPassword.length>=8,hasNumber:/\d/.test(r.newPassword),hasLetter:/[a-zA-Z]/.test(r.newPassword)})),x={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,message:"密码长度不能少于8位",trigger:"blur"},{validator:(n,e,s)=>{!l.value.hasNumber||!l.value.hasLetter?s(new Error("密码必须包含字母和数字")):s()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(n,e,s)=>{e!==r.newPassword?s(new Error("两次输入的密码不一致")):s()},trigger:"blur"}]},g=async()=>{var n,e;if(c.value)try{await c.value.validate(),u.value=!0;const s={currentPassword:r.currentPassword,newPassword:r.newPassword};await k.post("/auth/change-password",s),f.success("密码修改成功，请重新登录"),setTimeout(async()=>{await y.logout(),_.push("/login")},1500)}catch(s){console.error("修改密码失败:",s),(e=(n=s.response)==null?void 0:n.data)!=null&&e.message?f.error(s.response.data.message):f.error("密码修改失败，请检查当前密码是否正确")}finally{u.value=!1}},b=async()=>{try{await T.confirm("确定要取消修改密码吗？","提示",{confirmButtonText:"确定",cancelButtonText:"继续修改",type:"warning"}),_.back()}catch{}};return(n,e)=>{const s=U,i=R,v=A,V=D,C=F;return L(),S("div",X,[a(C,{class:"change-password-card"},{header:t(()=>e[3]||(e[3]=[o("div",{class:"card-header"},[o("h2",null,"🔐 修改密码"),o("p",null,"为了账户安全，请定期修改密码")],-1)])),default:t(()=>[a(V,{ref_key:"formRef",ref:c,model:r,rules:x,"label-width":"100px",size:"large",onSubmit:I(g,["prevent"])},{default:t(()=>[a(i,{label:"当前密码",prop:"currentPassword"},{default:t(()=>[a(s,{modelValue:r.currentPassword,"onUpdate:modelValue":e[0]||(e[0]=d=>r.currentPassword=d),type:"password",placeholder:"请输入当前密码","show-password":"","prefix-icon":p(w)},null,8,["modelValue","prefix-icon"])]),_:1}),a(i,{label:"新密码",prop:"newPassword"},{default:t(()=>[a(s,{modelValue:r.newPassword,"onUpdate:modelValue":e[1]||(e[1]=d=>r.newPassword=d),type:"password",placeholder:"请输入新密码","show-password":"","prefix-icon":p(w)},null,8,["modelValue","prefix-icon"]),o("div",O,[e[4]||(e[4]=o("p",null,"密码要求：",-1)),o("ul",null,[o("li",{class:m({valid:l.value.minLength})},"至少8个字符",2),o("li",{class:m({valid:l.value.hasNumber})},"包含数字",2),o("li",{class:m({valid:l.value.hasLetter})},"包含字母",2)])])]),_:1}),a(i,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[a(s,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=d=>r.confirmPassword=d),type:"password",placeholder:"请再次输入新密码","show-password":"","prefix-icon":p(w)},null,8,["modelValue","prefix-icon"])]),_:1}),a(i,null,{default:t(()=>[o("div",Q,[a(v,{onClick:b,size:"large"},{default:t(()=>e[5]||(e[5]=[P(" 取消 ",-1)])),_:1,__:[5]}),a(v,{type:"primary",loading:u.value,onClick:g,size:"large"},{default:t(()=>[P(M(u.value?"修改中...":"修改密码"),1)]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model"])]),_:1})])}}},se=B(W,[["__scopeId","data-v-44dcc487"]]);export{se as default};
